import './polyfills.server.mjs';
import{A as un,B as Ds,C as Ca,D as ks,E as Kf,F as Ns,G as zT,H as Ir,I as jT,J as Mc,K as GT,L as KT,M as $e,N as Et,O as Kt,P as Pc,Q as HT,R as $T,S as Os,T as WT,U as QT,V as YT,W as XT,X as JT,a as Is,b as MT,ba as Hf,c as kc,d as PT,e as Ai,ea as ZT,f as As,fa as ew,g as Cr,ga as Lc,h as br,ha as tw,i as Tt,ia as nw,j as LT,k as _a,l as FT,la as rw,m as BT,n as Nc,o as Oc,p as jf,pa as iw,q as xc,r as Ri,s as Gf,sa as $f,t as qT,u as Rs,v as cn,w as wt,x as ee,y as UT,z as VT}from"./chunk-SGIPORXP.mjs";import{a as sw,b as Wf,c as ow,d as ba,e as Qf,f as Fc,g as aw,h as lw,i as Yf,j as be,k as Di,l as Rn,m as Bc,n as Ia,o as cw,p as uw,q as Ar,r as Nt}from"./chunk-QOJAWCCK.mjs";import{a as Dc,b as Vf,c as le,f as w,h as xT,i as zf,j as g}from"./chunk-H6KHSOBK.mjs";var oe=w($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=$t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=$t.Propagate=$t.LogVerbosity=$t.Status=void 0;var KE=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(KE||($t.Status=KE={})),HE=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(HE||($t.LogVerbosity=HE={})),$E=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}($E||($t.Propagate=$E={}));$t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;$t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var tg=w((tz,_N)=>{_N.exports={name:"@grpc/grpc-js",version:"1.9.14",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Ne=w(Ct=>{"use strict";var ng,rg,ig,sg;Object.defineProperty(Ct,"__esModule",{value:!0});Ct.isTracerEnabled=Ct.trace=Ct.log=Ct.setLoggerVerbosity=Ct.setLogger=Ct.getLogger=void 0;var Nr=oe(),CN=le("process"),bN=tg().version,IN={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Fi=IN,zs=Nr.LogVerbosity.ERROR,AN=(rg=(ng=process.env.GRPC_NODE_VERBOSITY)!==null&&ng!==void 0?ng:process.env.GRPC_VERBOSITY)!==null&&rg!==void 0?rg:"";switch(AN.toUpperCase()){case"DEBUG":zs=Nr.LogVerbosity.DEBUG;break;case"INFO":zs=Nr.LogVerbosity.INFO;break;case"ERROR":zs=Nr.LogVerbosity.ERROR;break;case"NONE":zs=Nr.LogVerbosity.NONE;break;default:}var RN=()=>Fi;Ct.getLogger=RN;var DN=n=>{Fi=n};Ct.setLogger=DN;var kN=n=>{zs=n};Ct.setLoggerVerbosity=kN;var NN=(n,...e)=>{let t;if(n>=zs){switch(n){case Nr.LogVerbosity.DEBUG:t=Fi.debug;break;case Nr.LogVerbosity.INFO:t=Fi.info;break;case Nr.LogVerbosity.ERROR:t=Fi.error;break}t||(t=Fi.error),t&&t.bind(Fi)(...e)}};Ct.log=NN;var ON=(sg=(ig=process.env.GRPC_NODE_TRACE)!==null&&ig!==void 0?ig:process.env.GRPC_TRACE)!==null&&sg!==void 0?sg:"",og=new Set,WE=new Set;for(let n of ON.split(","))n.startsWith("-")?WE.add(n.substring(1)):og.add(n);var xN=og.has("all");function MN(n,e,t){QE(e)&&(0,Ct.log)(n,new Date().toISOString()+" | v"+bN+" "+CN.pid+" | "+e+" | "+t)}Ct.trace=MN;function QE(n){return!WE.has(n)&&(xN||og.has(n))}Ct.isTracerEnabled=QE});var vu=w(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});js.getErrorCode=js.getErrorMessage=void 0;function PN(n){return n instanceof Error?n.message:String(n)}js.getErrorMessage=PN;function LN(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}js.getErrorCode=LN});var bt=w(Tu=>{"use strict";Object.defineProperty(Tu,"__esModule",{value:!0});Tu.Metadata=void 0;var FN=Ne(),BN=oe(),qN=vu(),UN=/^[0-9a-z_.-]+$/,VN=/^[ -~]*$/;function zN(n){return UN.test(n)}function jN(n){return VN.test(n)}function XE(n){return n.endsWith("-bin")}function GN(n){return!n.startsWith("grpc-")}function Su(n){return n.toLowerCase()}function YE(n,e){if(!zN(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(XE(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!jN(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var ag=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Su(e),YE(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Su(e),YE(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=Su(e),this.internalRepr.delete(e)}get(e){return e=Su(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(KN);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{XE(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(GN(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,qN.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,FN.log)(BN.LogVerbosity.ERROR,o)}}return t}};Tu.Metadata=ag;var KN=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var dg=w(wu=>{"use strict";Object.defineProperty(wu,"__esModule",{value:!0});wu.CallCredentials=void 0;var hg=bt();function HN(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Gs=class n{static createFromMetadataGenerator(e){return new cg(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;HN(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new hg.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new ug}};wu.CallCredentials=Gs;var lg=class n extends Gs{constructor(e){super(),this.creds=e}generateMetadata(e){return g(this,null,function*(){let t=new hg.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},cg=class n extends Gs{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new lg([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},ug=class n extends Gs{generateMetadata(e){return Promise.resolve(new hg.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var pg=w(Ks=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});Ks.getDefaultRootsData=Ks.CIPHER_SUITES=void 0;var $N=le("fs");Ks.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var JE=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,fg=null;function WN(){return JE?(fg===null&&(fg=$N.readFileSync(JE)),fg):null}Ks.getDefaultRootsData=WN});var Cu=w(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});_u.ChannelCredentials=void 0;var QN=le("tls"),YN=dg(),ZE=pg();function gg(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Hs=class{constructor(e){this.callCredentials=e||YN.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(gg(e,"Root certificate"),gg(t,"Private key"),gg(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,QN.createSecureContext)({ca:(s=e??(0,ZE.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:ZE.CIPHER_SUITES});return new Eu(o,i??{})}static createFromSecureContext(e,t){return new Eu(e,t??{})}static createInsecure(){return new mg}};_u.ChannelCredentials=Hs;var mg=class n extends Hs{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Eu=class n extends Hs{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new yg(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},yg=class n extends Hs{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var xr=w(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.validateLoadBalancingConfig=dt.getFirstUsableConfig=dt.isLoadBalancerNameRegistered=dt.createLoadBalancer=dt.registerDefaultLoadBalancerType=dt.registerLoadBalancerType=dt.createChildChannelControlHelper=void 0;function XN(n,e){var t,r,i,s,o,a,l,c,u,h;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(h=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&h!==void 0?h:n.removeChannelzChild.bind(n)}}dt.createChildChannelControlHelper=XN;var Or={},vg=null;function JN(n,e,t){Or[n]={LoadBalancer:e,LoadBalancingConfig:t}}dt.registerLoadBalancerType=JN;function ZN(n){vg=n}dt.registerDefaultLoadBalancerType=ZN;function eO(n,e){let t=n.getLoadBalancerName();return t in Or?new Or[t].LoadBalancer(e):null}dt.createLoadBalancer=eO;function tO(n){return n in Or}dt.isLoadBalancerNameRegistered=tO;function nO(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Or)return t;return e&&vg?new Or[vg].LoadBalancingConfig:null}dt.getFirstUsableConfig=nO;function rO(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Or)return Or[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}dt.validateLoadBalancingConfig=rO});var Sg=w(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.extractAndSelectServiceConfig=Mr.validateServiceConfig=Mr.validateRetryThrottling=void 0;var iO=le("os"),bu=oe(),sO=xr(),Iu=/^\d+(\.\d{1,9})?s$/,oO="node";function aO(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function lO(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Iu.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Iu.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(bu.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(bu.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function cO(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Iu.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(bu.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(bu.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function uO(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(aO(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Iu.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=lO(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=cO(n.hedgingPolicy));return t}function e_(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Mr.validateRetryThrottling=e_;function t_(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,sO.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(uO(r));"retryThrottling"in n&&(e.retryThrottling=e_(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Mr.validateServiceConfig=t_;function hO(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:t_(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function dO(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=hO(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===iO.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===oO&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function fO(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return dO(i,e)}return null}Mr.extractAndSelectServiceConfig=fO});var Wt=w(Au=>{"use strict";Object.defineProperty(Au,"__esModule",{value:!0});Au.ConnectivityState=void 0;var n_=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(n_||(Au.ConnectivityState=n_={}))});var qt=w(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.uriToString=Pr.splitHostPort=Pr.parseUri=void 0;var pO=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function gO(n){let e=pO.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Pr.parseUri=gO;var r_=/^\d+$/;function mO(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return r_.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?r_.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Pr.splitHostPort=mO;function yO(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Pr.uriToString=yO});var On=w(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.mapUriDefaultScheme=Qt.getDefaultAuthority=Qt.createResolver=Qt.registerDefaultScheme=Qt.registerResolver=void 0;var wg=qt(),$s={},Tg=null;function vO(n,e){$s[n]=e}Qt.registerResolver=vO;function SO(n){Tg=n}Qt.registerDefaultScheme=SO;function TO(n,e,t){if(n.scheme!==void 0&&n.scheme in $s)return new $s[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,wg.uriToString)(n)}`)}Qt.createResolver=TO;function wO(n){if(n.scheme!==void 0&&n.scheme in $s)return $s[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,wg.uriToString)(n)}`)}Qt.getDefaultAuthority=wO;function EO(n){return n.scheme===void 0||!(n.scheme in $s)?Tg!==null?{scheme:Tg,authority:void 0,path:(0,wg.uriToString)(n)}:null:n}Qt.mapUriDefaultScheme=EO});var Fr=w(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.QueuePicker=Lr.UnavailablePicker=Lr.PickResultType=void 0;var _O=bt(),CO=oe(),Ru=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Ru||(Lr.PickResultType=Ru={})),Eg=class{constructor(e){this.status=Object.assign({code:CO.Status.UNAVAILABLE,details:"No connection established",metadata:new _O.Metadata},e)}pick(e){return{pickResultType:Ru.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Lr.UnavailablePicker=Eg;var _g=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Ru.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Lr.QueuePicker=_g});var Xa=w(Du=>{"use strict";Object.defineProperty(Du,"__esModule",{value:!0});Du.BackoffTimeout=void 0;var bO=1e3,IO=1.6,AO=12e4,RO=.2;function DO(n,e){return Math.random()*(e-n)+n}var Cg=class{constructor(e,t){this.callback=e,this.initialDelay=bO,this.multiplier=IO,this.maxDelay=AO,this.jitter=RO,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+DO(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Du.BackoffTimeout=Cg});var Nu=w(ku=>{"use strict";Object.defineProperty(ku,"__esModule",{value:!0});ku.ChildLoadBalancerHandler=void 0;var kO=xr(),NO=Wt(),OO="child_load_balancer_helper",bg=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===NO.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,kO.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return OO}};ku.ChildLoadBalancerHandler=bg});var s_=w(Ou=>{"use strict";Object.defineProperty(Ou,"__esModule",{value:!0});Ou.ResolvingLoadBalancer=void 0;var xO=xr(),MO=Sg(),xt=Wt(),PO=On(),Ws=Fr(),LO=Xa(),Ig=oe(),FO=bt(),BO=Ne(),qO=oe(),UO=qt(),VO=Nu(),zO="resolving_load_balancer";function i_(n){BO.trace(qO.LogVerbosity.DEBUG,zO,n)}var jO=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function GO(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function KO(n,e,t,r){for(let i of t)if(GO(n,e,i,r))return i;return null}function HO(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of jO){let u=KO(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:Ig.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Ig.Status.OK,dynamicFilterFactories:[]}}}var Ag=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=xt.ConnectivityState.IDLE,this.latestChildPicker=new Ws.QueuePicker(this),this.currentState=xt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,MO.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(xt.ConnectivityState.IDLE,new Ws.QueuePicker(this)),this.childLoadBalancer=new VO.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(i_("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,PO.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,h)=>{var d;this.backoffTimeout.stop(),this.backoffTimeout.reset();let p=null;l===null?c===null?(this.previousServiceConfig=null,p=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):p=this.previousServiceConfig:(p=l,this.previousServiceConfig=l);let y=(d=p?.loadBalancingConfig)!==null&&d!==void 0?d:[],S=(0,xO.getFirstUsableConfig)(y,!0);if(S===null){this.handleResolutionFailure({code:Ig.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new FO.Metadata});return}this.childLoadBalancer.updateAddressList(a,S,h);let T=p??this.defaultServiceConfig;this.onSuccessfulResolution(T,u??HO(T))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new LO.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===xt.ConnectivityState.IDLE&&this.updateState(xt.ConnectivityState.CONNECTING,new Ws.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){i_((0,UO.uriToString)(this.target)+" "+xt.ConnectivityState[this.currentState]+" -> "+xt.ConnectivityState[e]),e===xt.ConnectivityState.IDLE&&(t=new Ws.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===xt.ConnectivityState.IDLE&&(this.updateState(xt.ConnectivityState.TRANSIENT_FAILURE,new Ws.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===xt.ConnectivityState.IDLE||this.currentState===xt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=xt.ConnectivityState.IDLE,this.latestChildPicker=new Ws.QueuePicker(this),this.currentState=xt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};Ou.ResolvingLoadBalancer=Ag});var o_=w(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.channelOptionsEqual=Qs.recognizedOptions=void 0;Qs.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function $O(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}Qs.channelOptionsEqual=$O});var Mn=w(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.stringToSubchannelAddress=xn.subchannelAddressToString=xn.subchannelAddressEqual=xn.isTcpSubchannelAddress=void 0;var WO=le("net");function Ja(n){return"port"in n}xn.isTcpSubchannelAddress=Ja;function QO(n,e){return!n&&!e?!0:!n||!e?!1:Ja(n)?Ja(e)&&n.host===e.host&&n.port===e.port:!Ja(e)&&n.path===e.path}xn.subchannelAddressEqual=QO;function YO(n){return Ja(n)?n.host+":"+n.port:n.path}xn.subchannelAddressToString=YO;var XO=443;function JO(n,e){return(0,WO.isIP)(n)?{host:n,port:e??XO}:{path:n}}xn.stringToSubchannelAddress=JO});var xu=w(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.addAdminServicesToServer=Ys.registerAdminService=void 0;var a_=[];function ZO(n,e){a_.push({getServiceDefinition:n,getHandlers:e})}Ys.registerAdminService=ZO;function ex(n){for(let{getServiceDefinition:e,getHandlers:t}of a_)n.addService(e(),t())}Ys.addAdminServicesToServer=ex});var l_=w(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.ClientDuplexStreamImpl=Yt.ClientWritableStreamImpl=Yt.ClientReadableStreamImpl=Yt.ClientUnaryCallImpl=Yt.callErrorFromStatus=void 0;var tx=le("events"),Og=le("stream"),Za=oe();function nx(n,e){let t=`${n.code} ${Za.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}Yt.callErrorFromStatus=nx;var Rg=class extends tx.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Za.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Yt.ClientUnaryCallImpl=Rg;var Dg=class extends Og.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Za.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Yt.ClientReadableStreamImpl=Dg;var kg=class extends Og.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Za.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Yt.ClientWritableStreamImpl=kg;var Ng=class extends Og.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Za.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Yt.ClientDuplexStreamImpl=Ng});var c_=w(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});Xs.InterceptingListenerImpl=Xs.isInterceptingListener=void 0;function rx(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}Xs.isInterceptingListener=rx;var xg=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};Xs.InterceptingListenerImpl=xg});var Ug=w(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.getInterceptingCall=Xt.InterceptingCall=Xt.RequesterBuilder=Xt.ListenerBuilder=Xt.InterceptorConfigurationError=void 0;var ix=bt(),u_=c_(),h_=oe(),d_=vu(),tl=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};Xt.InterceptorConfigurationError=tl;var Pg=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};Xt.ListenerBuilder=Pg;var Lg=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};Xt.RequesterBuilder=Lg;var Mg={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},el={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},Fg=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:el.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:el.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:el.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:el.cancel}:this.requester=el}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,h)=>{var d,p,y;this.processingMetadata=!1;let S;if((0,u_.isInterceptingListener)(h))S=h;else{let T={onReceiveMetadata:(d=h.onReceiveMetadata)!==null&&d!==void 0?d:Mg.onReceiveMetadata,onReceiveMessage:(p=h.onReceiveMessage)!==null&&p!==void 0?p:Mg.onReceiveMessage,onReceiveStatus:(y=h.onReceiveStatus)!==null&&y!==void 0?y:Mg.onReceiveStatus};S=new u_.InterceptingListenerImpl(T,c)}this.nextCall.start(u,S),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};Xt.InterceptingCall=Fg;function sx(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var Mu=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(h_.Status.INTERNAL,`Request message serialization failure: ${(0,d_.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:h_.Status.INTERNAL,details:`Response message parsing error: ${(0,d_.getErrorMessage)(a)}`,metadata:new ix.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Bg=class extends Mu{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},qg=class extends Mu{};function ox(n,e,t){let r=sx(n,t.path,e);return t.responseStream?new qg(r,t):new Bg(r,t)}function ax(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new tl("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new tl("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>ox(r,a,e))(s)}Xt.getInterceptingCall=ax});var jg=w(Lu=>{"use strict";Object.defineProperty(Lu,"__esModule",{value:!0});Lu.Client=void 0;var Pn=l_(),lx=Gg(),cx=Wt(),Br=oe(),Js=bt(),Pu=Ug(),pn=Symbol(),Zs=Symbol(),eo=Symbol(),sr=Symbol();function Vg(n){return typeof n=="function"}function to(n){return n.stack.split(`
`).slice(1).join(`
`)}var zg=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[Zs]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[eo]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[Zs].length>0&&this[eo].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[sr]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[pn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[pn]=o(e,t,r)}else this[pn]=new lx.ChannelImplementation(e,t,r)}close(){this[pn].close()}getChannel(){return this[pn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[pn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===cx.ConnectivityState.READY)t();else try{this[pn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(Vg(e))return{metadata:new Js.Metadata,options:{},callback:e};if(Vg(t))return e instanceof Js.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Js.Metadata,options:e,callback:t};if(!(e instanceof Js.Metadata&&t instanceof Object&&Vg(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),h={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:u.metadata,call:new Pn.ClientUnaryCallImpl,channel:this[pn],methodDefinition:h,callOptions:u.options,callback:u.callback};this[sr]&&(d=this[sr](d));let p=d.call,y={clientInterceptors:this[Zs],clientInterceptorProviders:this[eo],callInterceptors:(l=d.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=d.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},S=(0,Pu.getInterceptingCall)(y,d.methodDefinition,d.callOptions,d.channel);p.call=S;let T=null,D=!1,E=new Error;return S.start(d.metadata,{onReceiveMetadata:k=>{p.emit("metadata",k)},onReceiveMessage(k){T!==null&&S.cancelWithStatus(Br.Status.INTERNAL,"Too many responses received"),T=k},onReceiveStatus(k){if(!D){if(D=!0,k.code===Br.Status.OK)if(T===null){let N=to(E);d.callback((0,Pn.callErrorFromStatus)({code:Br.Status.INTERNAL,details:"No message received",metadata:k.metadata},N))}else d.callback(null,T);else{let N=to(E);d.callback((0,Pn.callErrorFromStatus)(k,N))}E=null,p.emit("status",k)}}}),S.sendMessage(i),S.halfClose(),p}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},h={metadata:c.metadata,call:new Pn.ClientWritableStreamImpl(t),channel:this[pn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[sr]&&(h=this[sr](h));let d=h.call,p={clientInterceptors:this[Zs],clientInterceptorProviders:this[eo],callInterceptors:(a=h.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,Pu.getInterceptingCall)(p,h.methodDefinition,h.callOptions,h.channel);d.call=y;let S=null,T=!1,D=new Error;return y.start(h.metadata,{onReceiveMetadata:E=>{d.emit("metadata",E)},onReceiveMessage(E){S!==null&&y.cancelWithStatus(Br.Status.INTERNAL,"Too many responses received"),S=E},onReceiveStatus(E){if(!T){if(T=!0,E.code===Br.Status.OK)if(S===null){let k=to(D);h.callback((0,Pn.callErrorFromStatus)({code:Br.Status.INTERNAL,details:"No message received",metadata:E.metadata},k))}else h.callback(null,S);else{let k=to(D);h.callback((0,Pn.callErrorFromStatus)(E,k))}D=null,d.emit("status",E)}}}),d}checkMetadataAndOptions(e,t){let r,i;return e instanceof Js.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new Js.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},h={argument:i,metadata:c.metadata,call:new Pn.ClientReadableStreamImpl(r),channel:this[pn],methodDefinition:u,callOptions:c.options};this[sr]&&(h=this[sr](h));let d=h.call,p={clientInterceptors:this[Zs],clientInterceptorProviders:this[eo],callInterceptors:(a=h.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,Pu.getInterceptingCall)(p,h.methodDefinition,h.callOptions,h.channel);d.call=y;let S=!1,T=new Error;return y.start(h.metadata,{onReceiveMetadata(D){d.emit("metadata",D)},onReceiveMessage(D){d.push(D)},onReceiveStatus(D){if(!S){if(S=!0,d.push(null),D.code!==Br.Status.OK){let E=to(T);d.emit("error",(0,Pn.callErrorFromStatus)(D,E))}T=null,d.emit("status",D)}}}),y.sendMessage(i),y.halfClose(),d}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Pn.ClientDuplexStreamImpl(t,r),channel:this[pn],methodDefinition:c,callOptions:l.options};this[sr]&&(u=this[sr](u));let h=u.call,d={clientInterceptors:this[Zs],clientInterceptorProviders:this[eo],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},p=(0,Pu.getInterceptingCall)(d,u.methodDefinition,u.callOptions,u.channel);h.call=p;let y=!1,S=new Error;return p.start(u.metadata,{onReceiveMetadata(T){h.emit("metadata",T)},onReceiveMessage(T){h.push(T)},onReceiveStatus(T){if(!y){if(y=!0,h.push(null),T.code!==Br.Status.OK){let D=to(S);h.emit("error",(0,Pn.callErrorFromStatus)(T,D))}S=null,h.emit("status",T)}}}),h}};Lu.Client=zg});var Hg=w(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.loadPackageDefinition=no.makeClientConstructor=void 0;var nl=jg(),ux={unary:nl.Client.prototype.makeUnaryRequest,server_stream:nl.Client.prototype.makeServerStreamRequest,client_stream:nl.Client.prototype.makeClientStreamRequest,bidi:nl.Client.prototype.makeBidiStreamRequest};function Kg(n){return["__proto__","prototype","constructor"].includes(n)}function f_(n,e,t){t||(t={});class r extends nl.Client{}return Object.keys(n).forEach(i=>{if(Kg(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=hx(ux[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!Kg(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}no.makeClientConstructor=f_;function hx(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function dx(n){return"format"in n}function fx(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>Kg(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];dx(r)?o[s]=r:o[s]=f_(r,s,{})}return e}no.loadPackageDefinition=fx});var B_=w((Az,F_)=>{"use strict";var px=1/0,gx="[object Symbol]",mx=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,yx=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Bu="\\ud800-\\udfff",w_="\\u0300-\\u036f\\ufe20-\\ufe23",E_="\\u20d0-\\u20f0",__="\\u2700-\\u27bf",C_="a-z\\xdf-\\xf6\\xf8-\\xff",vx="\\xac\\xb1\\xd7\\xf7",Sx="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Tx="\\u2000-\\u206f",wx=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",b_="A-Z\\xc0-\\xd6\\xd8-\\xde",I_="\\ufe0e\\ufe0f",A_=vx+Sx+Tx+wx,Wg="['\u2019]",Ex="["+Bu+"]",p_="["+A_+"]",Fu="["+w_+E_+"]",R_="\\d+",_x="["+__+"]",D_="["+C_+"]",k_="[^"+Bu+A_+R_+__+C_+b_+"]",$g="\\ud83c[\\udffb-\\udfff]",Cx="(?:"+Fu+"|"+$g+")",N_="[^"+Bu+"]",Qg="(?:\\ud83c[\\udde6-\\uddff]){2}",Yg="[\\ud800-\\udbff][\\udc00-\\udfff]",ro="["+b_+"]",O_="\\u200d",g_="(?:"+D_+"|"+k_+")",bx="(?:"+ro+"|"+k_+")",m_="(?:"+Wg+"(?:d|ll|m|re|s|t|ve))?",y_="(?:"+Wg+"(?:D|LL|M|RE|S|T|VE))?",x_=Cx+"?",M_="["+I_+"]?",Ix="(?:"+O_+"(?:"+[N_,Qg,Yg].join("|")+")"+M_+x_+")*",P_=M_+x_+Ix,Ax="(?:"+[_x,Qg,Yg].join("|")+")"+P_,Rx="(?:"+[N_+Fu+"?",Fu,Qg,Yg,Ex].join("|")+")",Dx=RegExp(Wg,"g"),kx=RegExp(Fu,"g"),Nx=RegExp($g+"(?="+$g+")|"+Rx+P_,"g"),Ox=RegExp([ro+"?"+D_+"+"+m_+"(?="+[p_,ro,"$"].join("|")+")",bx+"+"+y_+"(?="+[p_,ro+g_,"$"].join("|")+")",ro+"?"+g_+"+"+m_,ro+"+"+y_,R_,Ax].join("|"),"g"),xx=RegExp("["+O_+Bu+w_+E_+I_+"]"),Mx=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Px={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},Lx=typeof global=="object"&&global&&global.Object===Object&&global,Fx=typeof self=="object"&&self&&self.Object===Object&&self,Bx=Lx||Fx||Function("return this")();function qx(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function Ux(n){return n.split("")}function Vx(n){return n.match(mx)||[]}function zx(n){return function(e){return n?.[e]}}var jx=zx(Px);function L_(n){return xx.test(n)}function Gx(n){return Mx.test(n)}function Kx(n){return L_(n)?Hx(n):Ux(n)}function Hx(n){return n.match(Nx)||[]}function $x(n){return n.match(Ox)||[]}var Wx=Object.prototype,Qx=Wx.toString,v_=Bx.Symbol,S_=v_?v_.prototype:void 0,T_=S_?S_.toString:void 0;function Yx(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function Xx(n){if(typeof n=="string")return n;if(nM(n))return T_?T_.call(n):"";var e=n+"";return e=="0"&&1/n==-px?"-0":e}function Jx(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:Yx(n,e,t)}function Zx(n){return function(e){e=qu(e);var t=L_(e)?Kx(e):void 0,r=t?t[0]:e.charAt(0),i=t?Jx(t,1).join(""):e.slice(1);return r[n]()+i}}function eM(n){return function(e){return qx(aM(sM(e).replace(Dx,"")),n,"")}}function tM(n){return!!n&&typeof n=="object"}function nM(n){return typeof n=="symbol"||tM(n)&&Qx.call(n)==gx}function qu(n){return n==null?"":Xx(n)}var rM=eM(function(n,e,t){return e=e.toLowerCase(),n+(t?iM(e):e)});function iM(n){return oM(qu(n).toLowerCase())}function sM(n){return n=qu(n),n&&n.replace(yx,jx).replace(kx,"")}var oM=Zx("toUpperCase");function aM(n,e,t){return n=qu(n),e=t?void 0:e,e===void 0?Gx(n)?$x(n):Vx(n):n.match(e)||[]}F_.exports=rM});var Xg=w((Rz,q_)=>{"use strict";q_.exports=lM;function lM(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var h=new Array(arguments.length-1),d=0;d<h.length;)h[d++]=arguments[d];a.apply(null,h)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var j_=w(z_=>{"use strict";var Uu=z_;Uu.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var io=new Array(64),V_=new Array(123);for(gn=0;gn<64;)V_[io[gn]=gn<26?gn+65:gn<52?gn+71:gn<62?gn-4:gn-59|43]=gn++;var gn;Uu.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=io[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=io[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=io[l|c>>6],s[o++]=io[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=io[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var U_="invalid encoding";Uu.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=V_[l])===void 0)throw Error(U_);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(U_);return r-i};Uu.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var K_=w((kz,G_)=>{"use strict";G_.exports=Vu;function Vu(){this._listeners={}}Vu.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};Vu.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};Vu.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var J_=w((Nz,X_)=>{"use strict";X_.exports=H_(H_);function H_(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,$_),n.writeFloatBE=e.bind(null,W_);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,Q_),n.readFloatBE=t.bind(null,Y_)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var h=Math.floor(Math.log(o)/Math.LN2);h===1024&&(h=1023),u=o*Math.pow(2,-h),r(u*4503599627370496>>>0,a,l+i),r((c<<31|h+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,$_,0,4),n.writeDoubleBE=e.bind(null,W_,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,h=c>>>20&2047,d=4294967296*(c&1048575)+l;return h===2047?d?NaN:u*(1/0):h===0?u*5e-324*d:u*Math.pow(2,h-1075)*(d+4503599627370496)}n.readDoubleLE=t.bind(null,Q_,0,4),n.readDoubleBE=t.bind(null,Y_,4,0)}(),n}function $_(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function W_(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function Q_(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function Y_(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var Jg=w((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var e1=w(Z_=>{"use strict";var Zg=Z_;Zg.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};Zg.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Zg.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var n1=w((xz,t1)=>{"use strict";t1.exports=cM;function cM(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var i1=w((Mz,r1)=>{"use strict";r1.exports=Xe;var rl=Ln();function Xe(n,e){this.lo=n>>>0,this.hi=e>>>0}var Bi=Xe.zero=new Xe(0,0);Bi.toNumber=function(){return 0};Bi.zzEncode=Bi.zzDecode=function(){return this};Bi.length=function(){return 1};var uM=Xe.zeroHash="\0\0\0\0\0\0\0\0";Xe.fromNumber=function(e){if(e===0)return Bi;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new Xe(r,i)};Xe.from=function(e){if(typeof e=="number")return Xe.fromNumber(e);if(rl.isString(e))if(rl.Long)e=rl.Long.fromString(e);else return Xe.fromNumber(parseInt(e,10));return e.low||e.high?new Xe(e.low>>>0,e.high>>>0):Bi};Xe.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};Xe.prototype.toLong=function(e){return rl.Long?new rl.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var qr=String.prototype.charCodeAt;Xe.fromHash=function(e){return e===uM?Bi:new Xe((qr.call(e,0)|qr.call(e,1)<<8|qr.call(e,2)<<16|qr.call(e,3)<<24)>>>0,(qr.call(e,4)|qr.call(e,5)<<8|qr.call(e,6)<<16|qr.call(e,7)<<24)>>>0)};Xe.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Xe.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Xe.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Xe.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Ln=w(em=>{"use strict";var V=em;V.asPromise=Xg();V.base64=j_();V.EventEmitter=K_();V.float=J_();V.inquire=Jg();V.utf8=e1();V.pool=n1();V.LongBits=i1();V.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);V.global=V.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||em;V.emptyArray=Object.freeze?Object.freeze([]):[];V.emptyObject=Object.freeze?Object.freeze({}):{};V.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};V.isString=function(e){return typeof e=="string"||e instanceof String};V.isObject=function(e){return e&&typeof e=="object"};V.isset=V.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};V.Buffer=function(){try{var n=V.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();V._Buffer_from=null;V._Buffer_allocUnsafe=null;V.newBuffer=function(e){return typeof e=="number"?V.Buffer?V._Buffer_allocUnsafe(e):new V.Array(e):V.Buffer?V._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};V.Array=typeof Uint8Array<"u"?Uint8Array:Array;V.Long=V.global.dcodeIO&&V.global.dcodeIO.Long||V.global.Long||V.inquire("long");V.key2Re=/^true|false|0|1$/;V.key32Re=/^-?(?:0|[1-9][0-9]*)$/;V.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;V.longToHash=function(e){return e?V.LongBits.from(e).toHash():V.LongBits.zeroHash};V.longFromHash=function(e,t){var r=V.LongBits.fromHash(e);return V.Long?V.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function s1(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}V.merge=s1;V.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function o1(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&s1(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}V.newError=o1;V.ProtocolError=o1("ProtocolError");V.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};V.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};V.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};V._configure=function(){var n=V.Buffer;if(!n){V._Buffer_from=V._Buffer_allocUnsafe=null;return}V._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},V._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var ju=w((Lz,u1)=>{"use strict";u1.exports=se;var Jt=Ln(),tm,zu=Jt.LongBits,a1=Jt.base64,l1=Jt.utf8;function il(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function rm(){}function hM(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function se(){this.len=0,this.head=new il(rm,0,0),this.tail=this.head,this.states=null}var c1=function(){return Jt.Buffer?function(){return(se.create=function(){return new tm})()}:function(){return new se}};se.create=c1();se.alloc=function(e){return new Jt.Array(e)};Jt.Array!==Array&&(se.alloc=Jt.pool(se.alloc,Jt.Array.prototype.subarray));se.prototype._push=function(e,t,r){return this.tail=this.tail.next=new il(e,t,r),this.len+=t,this};function im(n,e,t){e[t]=n&255}function dM(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function sm(n,e){this.len=n,this.next=void 0,this.val=e}sm.prototype=Object.create(il.prototype);sm.prototype.fn=dM;se.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new sm((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};se.prototype.int32=function(e){return e<0?this._push(om,10,zu.fromNumber(e)):this.uint32(e)};se.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function om(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}se.prototype.uint64=function(e){var t=zu.from(e);return this._push(om,t.length(),t)};se.prototype.int64=se.prototype.uint64;se.prototype.sint64=function(e){var t=zu.from(e).zzEncode();return this._push(om,t.length(),t)};se.prototype.bool=function(e){return this._push(im,1,e?1:0)};function nm(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}se.prototype.fixed32=function(e){return this._push(nm,4,e>>>0)};se.prototype.sfixed32=se.prototype.fixed32;se.prototype.fixed64=function(e){var t=zu.from(e);return this._push(nm,4,t.lo)._push(nm,4,t.hi)};se.prototype.sfixed64=se.prototype.fixed64;se.prototype.float=function(e){return this._push(Jt.float.writeFloatLE,4,e)};se.prototype.double=function(e){return this._push(Jt.float.writeDoubleLE,8,e)};var fM=Jt.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};se.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(im,1,0);if(Jt.isString(e)){var r=se.alloc(t=a1.length(e));a1.decode(e,r,0),e=r}return this.uint32(t)._push(fM,t,e)};se.prototype.string=function(e){var t=l1.length(e);return t?this.uint32(t)._push(l1.write,t,e):this._push(im,1,0)};se.prototype.fork=function(){return this.states=new hM(this),this.head=this.tail=new il(rm,0,0),this.len=0,this};se.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new il(rm,0,0),this.len=0),this};se.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};se.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};se._configure=function(n){tm=n,se.create=c1(),tm._configure()}});var f1=w((Fz,d1)=>{"use strict";d1.exports=Fn;var h1=ju();(Fn.prototype=Object.create(h1.prototype)).constructor=Fn;var Ur=Ln();function Fn(){h1.call(this)}Fn._configure=function(){Fn.alloc=Ur._Buffer_allocUnsafe,Fn.writeBytesBuffer=Ur.Buffer&&Ur.Buffer.prototype instanceof Uint8Array&&Ur.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Fn.prototype.bytes=function(e){Ur.isString(e)&&(e=Ur._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Fn.writeBytesBuffer,t,e),this};function pM(n,e,t){n.length<40?Ur.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Fn.prototype.string=function(e){var t=Ur.Buffer.byteLength(e);return this.uint32(t),t&&this._push(pM,t,e),this};Fn._configure()});var Ku=w((Bz,v1)=>{"use strict";v1.exports=Pe;var mn=Ln(),lm,m1=mn.LongBits,gM=mn.utf8;function yn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Pe(n){this.buf=n,this.pos=0,this.len=n.length}var p1=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Pe(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Pe(e);throw Error("illegal buffer")},y1=function(){return mn.Buffer?function(t){return(Pe.create=function(i){return mn.Buffer.isBuffer(i)?new lm(i):p1(i)})(t)}:p1};Pe.create=y1();Pe.prototype._slice=mn.Array.prototype.subarray||mn.Array.prototype.slice;Pe.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,yn(this,10);return e}}();Pe.prototype.int32=function(){return this.uint32()|0};Pe.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function am(){var n=new m1(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw yn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw yn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Pe.prototype.bool=function(){return this.uint32()!==0};function Gu(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Pe.prototype.fixed32=function(){if(this.pos+4>this.len)throw yn(this,4);return Gu(this.buf,this.pos+=4)};Pe.prototype.sfixed32=function(){if(this.pos+4>this.len)throw yn(this,4);return Gu(this.buf,this.pos+=4)|0};function g1(){if(this.pos+8>this.len)throw yn(this,8);return new m1(Gu(this.buf,this.pos+=4),Gu(this.buf,this.pos+=4))}Pe.prototype.float=function(){if(this.pos+4>this.len)throw yn(this,4);var e=mn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Pe.prototype.double=function(){if(this.pos+8>this.len)throw yn(this,4);var e=mn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Pe.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw yn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=mn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Pe.prototype.string=function(){var e=this.bytes();return gM.read(e,0,e.length)};Pe.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw yn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw yn(this);while(this.buf[this.pos++]&128);return this};Pe.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Pe._configure=function(n){lm=n,Pe.create=y1(),lm._configure();var e=mn.Long?"toLong":"toNumber";mn.merge(Pe.prototype,{int64:function(){return am.call(this)[e](!1)},uint64:function(){return am.call(this)[e](!0)},sint64:function(){return am.call(this).zzDecode()[e](!1)},fixed64:function(){return g1.call(this)[e](!0)},sfixed64:function(){return g1.call(this)[e](!1)}})}});var E1=w((qz,w1)=>{"use strict";w1.exports=qi;var T1=Ku();(qi.prototype=Object.create(T1.prototype)).constructor=qi;var S1=Ln();function qi(n){T1.call(this,n)}qi._configure=function(){S1.Buffer&&(qi.prototype._slice=S1.Buffer.prototype.slice)};qi.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};qi._configure()});var C1=w((Uz,_1)=>{"use strict";_1.exports=sl;var cm=Ln();(sl.prototype=Object.create(cm.EventEmitter.prototype)).constructor=sl;function sl(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");cm.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}sl.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return cm.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};sl.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var um=w(b1=>{"use strict";var mM=b1;mM.Service=C1()});var hm=w((zz,I1)=>{"use strict";I1.exports={}});var D1=w(R1=>{"use strict";var Mt=R1;Mt.build="minimal";Mt.Writer=ju();Mt.BufferWriter=f1();Mt.Reader=Ku();Mt.BufferReader=E1();Mt.util=Ln();Mt.rpc=um();Mt.roots=hm();Mt.configure=A1;function A1(){Mt.util._configure(),Mt.Writer._configure(Mt.BufferWriter),Mt.Reader._configure(Mt.BufferReader)}A1()});var N1=w((Gz,k1)=>{"use strict";k1.exports=dm;function dm(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(dm.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var h=new Array(arguments.length-1),d=0;d<h.length;)h[d]=arguments[++d];if(d=0,s=s.replace(/%([%dfijs])/g,function(y,S){var T=h[d++];switch(S){case"d":case"f":return String(Number(T));case"i":return String(Math.floor(T));case"j":return JSON.stringify(T);case"s":return String(T)}return"%"}),d!==h.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}dm.verbose=!1});var x1=w((Kz,O1)=>{"use strict";O1.exports=ol;var yM=Xg(),vM=Jg(),fm=vM("fs");function ol(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&fm&&fm.readFile?fm.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?ol.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):ol.xhr(n,e,t):yM(ol,this,n,e)}ol.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var L1=w(P1=>{"use strict";var gm=P1,M1=gm.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},pm=gm.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=M1(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};gm.resolve=function(e,t,r){return r||(t=pm(t)),M1(t)?t:(r||(e=pm(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?pm(e+"/"+t):t)}});var Ui=w(F1=>{"use strict";var al=F1,SM=Je(),TM=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function ll(n,e){var t=0,r={};for(e|=0;t<n.length;)r[TM[t+e]]=n[t++];return r}al.basic=ll([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);al.defaults=ll([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",SM.emptyArray,null]);al.long=ll([0,0,0,1,1],7);al.mapKey=ll([0,0,0,5,5,0,0,0,1,1,0,2],2);al.packed=ll([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Vr=w((Wz,U1)=>{"use strict";U1.exports=Zt;var Hu=Vi();((Zt.prototype=Object.create(Hu.prototype)).constructor=Zt).className="Field";var B1=vn(),q1=Ui(),ze=Je(),mm,wM=/^required|optional|repeated$/;Zt.fromJSON=function(e,t){return new Zt(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Zt(n,e,t,r,i,s,o){if(ze.isObject(r)?(o=i,s=r,r=i=void 0):ze.isObject(i)&&(o=s,s=i,i=void 0),Hu.call(this,n,s),!ze.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!ze.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!wM.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!ze.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=ze.Long?q1.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(Zt.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Zt.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Hu.prototype.setOption.call(this,e,t,r)};Zt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ze.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Zt.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=q1.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof mm?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof B1&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof B1))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=ze.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;ze.base64.test(this.typeDefault)?ze.base64.decode(this.typeDefault,e=ze.newBuffer(ze.base64.length(this.typeDefault)),0):ze.utf8.write(this.typeDefault,e=ze.newBuffer(ze.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=ze.emptyObject:this.repeated?this.defaultValue=ze.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof mm&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Hu.prototype.resolve.call(this)};Zt.d=function(e,t,r,i){return typeof t=="function"?t=ze.decorateType(t).name:t&&typeof t=="object"&&(t=ze.decorateEnum(t).name),function(o,a){ze.decorateType(o.constructor).add(new Zt(a,e,t,r,{default:i}))}};Zt._configure=function(e){mm=e}});var so=w((Qz,j1)=>{"use strict";j1.exports=en;var Wu=Vi();((en.prototype=Object.create(Wu.prototype)).constructor=en).className="OneOf";var V1=Vr(),$u=Je();function en(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Wu.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}en.fromJSON=function(e,t){return new en(e,t.oneof,t.options,t.comment)};en.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return $u.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function z1(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}en.prototype.add=function(e){if(!(e instanceof V1))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,z1(this),this};en.prototype.remove=function(e){if(!(e instanceof V1))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};en.prototype.onAdd=function(e){Wu.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}z1(this)};en.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Wu.prototype.onRemove.call(this,e)};en.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){$u.decorateType(i.constructor).add(new en(s,e)),Object.defineProperty(i,s,{get:$u.oneOfGetter(e),set:$u.oneOfSetter(e)})}}});var lo=w((Yz,$1)=>{"use strict";$1.exports=ae;var ym=Vi();((ae.prototype=Object.create(ym.prototype)).constructor=ae).className="Namespace";var G1=Vr(),Qu=Je(),EM=so(),oo,cl,ao;ae.fromJSON=function(e,t){return new ae(e,t.options).addJSON(t.nested)};function K1(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}ae.arrayToJSON=K1;ae.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};ae.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function ae(n,e){ym.call(this,n,e),this.nested=void 0,this._nestedArray=null}function H1(n){return n._nestedArray=null,n}Object.defineProperty(ae.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Qu.toArray(this.nested))}});ae.prototype.toJSON=function(e){return Qu.toObject(["options",this.options,"nested",K1(this.nestedArray,e)])};ae.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?oo.fromJSON:s.values!==void 0?ao.fromJSON:s.methods!==void 0?cl.fromJSON:s.id!==void 0?G1.fromJSON:ae.fromJSON)(r[i],s));return this};ae.prototype.get=function(e){return this.nested&&this.nested[e]||null};ae.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof ao)return this.nested[e].values;throw Error("no such enum: "+e)};ae.prototype.add=function(e){if(!(e instanceof G1&&e.extend!==void 0||e instanceof oo||e instanceof EM||e instanceof ao||e instanceof cl||e instanceof ae))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof ae&&e instanceof ae&&!(t instanceof oo||t instanceof cl)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),H1(this)};ae.prototype.remove=function(e){if(!(e instanceof ym))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),H1(this)};ae.prototype.define=function(e,t){if(Qu.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof ae))throw Error("path conflicts with non-namespace objects")}else r.add(r=new ae(i))}return t&&r.addJSON(t),r};ae.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof ae?e[t++].resolveAll():e[t++].resolve();return this.resolve()};ae.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Qu.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof ae&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof ae&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};ae.prototype.lookupType=function(e){var t=this.lookup(e,[oo]);if(!t)throw Error("no such type: "+e);return t};ae.prototype.lookupEnum=function(e){var t=this.lookup(e,[ao]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};ae.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[oo,ao]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};ae.prototype.lookupService=function(e){var t=this.lookup(e,[cl]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};ae._configure=function(n,e,t){oo=n,cl=e,ao=t}});var Yu=w((Xz,W1)=>{"use strict";W1.exports=or;var vm=Vr();((or.prototype=Object.create(vm.prototype)).constructor=or).className="MapField";var _M=Ui(),ul=Je();function or(n,e,t,r,i,s){if(vm.call(this,n,e,r,void 0,void 0,i,s),!ul.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}or.fromJSON=function(e,t){return new or(e,t.id,t.keyType,t.type,t.options,t.comment)};or.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ul.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};or.prototype.resolve=function(){if(this.resolved)return this;if(_M.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return vm.prototype.resolve.call(this)};or.d=function(e,t,r){return typeof r=="function"?r=ul.decorateType(r).name:r&&typeof r=="object"&&(r=ul.decorateEnum(r).name),function(s,o){ul.decorateType(s.constructor).add(new or(o,e,t,r))}}});var Xu=w((Jz,Q1)=>{"use strict";Q1.exports=zi;var Sm=Vi();((zi.prototype=Object.create(Sm.prototype)).constructor=zi).className="Method";var co=Je();function zi(n,e,t,r,i,s,o,a,l){if(co.isObject(i)?(o=i,i=s=void 0):co.isObject(s)&&(o=s,s=void 0),!(e===void 0||co.isString(e)))throw TypeError("type must be a string");if(!co.isString(t))throw TypeError("requestType must be a string");if(!co.isString(r))throw TypeError("responseType must be a string");Sm.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}zi.fromJSON=function(e,t){return new zi(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};zi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return co.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};zi.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),Sm.prototype.resolve.call(this))}});var Ju=w((Zz,X1)=>{"use strict";X1.exports=tn;var zr=lo();((tn.prototype=Object.create(zr.prototype)).constructor=tn).className="Service";var Tm=Xu(),hl=Je(),CM=um();function tn(n,e){zr.call(this,n,e),this.methods={},this._methodsArray=null}tn.fromJSON=function(e,t){var r=new tn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(Tm.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};tn.prototype.toJSON=function(e){var t=zr.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return hl.toObject(["options",t&&t.options||void 0,"methods",zr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(tn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=hl.toArray(this.methods))}});function Y1(n){return n._methodsArray=null,n}tn.prototype.get=function(e){return this.methods[e]||zr.prototype.get.call(this,e)};tn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return zr.prototype.resolve.call(this)};tn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Tm?(this.methods[e.name]=e,e.parent=this,Y1(this)):zr.prototype.add.call(this,e)};tn.prototype.remove=function(e){if(e instanceof Tm){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,Y1(this)}return zr.prototype.remove.call(this,e)};tn.prototype.create=function(e,t,r){for(var i=new CM.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=hl.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=hl.codegen(["r","c"],hl.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Zu=w((ej,J1)=>{"use strict";J1.exports=Bn;var bM=Ln();function Bn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Bn.create=function(e){return this.$type.create(e)};Bn.encode=function(e,t){return this.$type.encode(e,t)};Bn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Bn.decode=function(e){return this.$type.decode(e)};Bn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Bn.verify=function(e){return this.$type.verify(e)};Bn.fromObject=function(e){return this.$type.fromObject(e)};Bn.toObject=function(e,t){return this.$type.toObject(e,t)};Bn.prototype.toJSON=function(){return this.$type.toObject(this,bM.toJSONOptions)}});var wm=w((tj,eC)=>{"use strict";eC.exports=RM;var IM=vn(),ar=Ui(),Z1=Je();function AM(n){return"missing required '"+n.name+"'"}function RM(n){var e=Z1.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof IM?"int32":r.type,s="m"+Z1.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),ar.defaults[r.keyType]!==void 0?e("k=%j",ar.defaults[r.keyType]):e("k=null"),ar.defaults[i]!==void 0?e("value=%j",ar.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),ar.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),ar.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),ar.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),ar.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):ar.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",AM(o))}return e("return m")}});var Cm=w((nj,tC)=>{"use strict";tC.exports=NM;var DM=vn(),Em=Je();function nn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function _m(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof DM){n("switch(%s){",r)("default:")("return%j",nn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",nn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",nn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",nn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",nn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",nn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",nn(e,"buffer"));break}return n}function kM(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",nn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",nn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",nn(e,"boolean key"));break}return n}function NM(n){var e=Em.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+Em.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",nn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),kM(e,s,"k[i]"),_m(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",nn(s,"array"))("for(var i=0;i<%s.length;++i){",o),_m(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=Em.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}_m(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var Am=w(rC=>{"use strict";var nC=rC,dl=vn(),qn=Je();function bm(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof dl){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}nC.fromObject=function(e){var t=e.fieldsArray,r=qn.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=qn.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),bm(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),bm(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof dl||r("if(d%s!=null){",o),bm(r,s,i,o),s.resolvedType instanceof dl||r("}"))}return r("return m")};function Im(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof dl?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}nC.toObject=function(e){var t=e.fieldsArray.slice().sort(qn.compareFieldsById);if(!t.length)return qn.codegen()("return {}");for(var r=qn.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",qn.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",qn.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=qn.safeProp(l.name);if(l.resolvedType instanceof dl)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var h=!1;for(a=0;a<t.length;++a){var l=t[a],d=e._fieldsArray.indexOf(l),c=qn.safeProp(l.name);l.map?(h||(h=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),Im(r,l,d,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),Im(r,l,d,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),Im(r,l,d,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",qn.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var Rm=w(iC=>{"use strict";var OM=iC,xM=Zu();OM[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof xM){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var nh=w((sj,oC)=>{"use strict";oC.exports=ge;var Sn=lo();((ge.prototype=Object.create(Sn.prototype)).constructor=ge).className="Type";var MM=vn(),Nm=so(),eh=Vr(),PM=Yu(),LM=Ju(),Dm=Zu(),km=Ku(),FM=ju(),ft=Je(),BM=Om(),qM=wm(),UM=Cm(),sC=Am(),VM=Rm();function ge(n,e){Sn.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(ge.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=ft.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=ft.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=ge.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Dm||((n.prototype=new Dm).constructor=n,ft.merge(n.prototype,e)),n.$type=n.prototype.$type=this,ft.merge(n,Dm,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:ft.oneOfGetter(this._oneofsArray[t].oneof),set:ft.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});ge.generateConstructor=function(e){for(var t=ft.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",ft.safeProp(i.name)):i.repeated&&t("this%s=[]",ft.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function th(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}ge.fromJSON=function(e,t){var r=new ge(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?PM.fromJSON:eh.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(Nm.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?eh.fromJSON:o.fields!==void 0?ge.fromJSON:o.values!==void 0?MM.fromJSON:o.methods!==void 0?LM.fromJSON:Sn.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};ge.prototype.toJSON=function(e){var t=Sn.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return ft.toObject(["options",t&&t.options||void 0,"oneofs",Sn.arrayToJSON(this.oneofsArray,e),"fields",Sn.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};ge.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return Sn.prototype.resolveAll.call(this)};ge.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};ge.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof eh&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),th(this)}return e instanceof Nm?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),th(this)):Sn.prototype.add.call(this,e)};ge.prototype.remove=function(e){if(e instanceof eh&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),th(this)}if(e instanceof Nm){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),th(this)}return Sn.prototype.remove.call(this,e)};ge.prototype.isReservedId=function(e){return Sn.isReservedId(this.reserved,e)};ge.prototype.isReservedName=function(e){return Sn.isReservedName(this.reserved,e)};ge.prototype.create=function(e){return new this.ctor(e)};ge.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=BM(this)({Writer:FM,types:t,util:ft}),this.decode=qM(this)({Reader:km,types:t,util:ft}),this.verify=UM(this)({types:t,util:ft}),this.fromObject=sC.fromObject(this)({types:t,util:ft}),this.toObject=sC.toObject(this)({types:t,util:ft});var i=VM[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};ge.prototype.encode=function(e,t){return this.setup().encode(e,t)};ge.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};ge.prototype.decode=function(e,t){return this.setup().decode(e,t)};ge.prototype.decodeDelimited=function(e){return e instanceof km||(e=km.create(e)),this.decode(e,e.uint32())};ge.prototype.verify=function(e){return this.setup().verify(e)};ge.prototype.fromObject=function(e){return this.setup().fromObject(e)};ge.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};ge.d=function(e){return function(r){ft.decorateType(r,e)}}});var sh=w((oj,hC)=>{"use strict";hC.exports=Ut;var ih=lo();((Ut.prototype=Object.create(ih.prototype)).constructor=Ut).className="Root";var Mm=Vr(),lC=vn(),zM=so(),jr=Je(),cC,xm,fl;function Ut(n){ih.call(this,"",n),this.deferred=[],this.files=[]}Ut.fromJSON=function(e,t){return t||(t=new Ut),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};Ut.prototype.resolvePath=jr.path.resolve;Ut.prototype.fetch=jr.fetch;function uC(){}Ut.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return jr.asPromise(n,i,e,t);var s=r===uC;function o(p,y){if(r){if(s)throw p;var S=r;r=null,S(p,y)}}function a(p){var y=p.lastIndexOf("google/protobuf/");if(y>-1){var S=p.substring(y);if(S in fl)return S}return null}function l(p,y){try{if(jr.isString(y)&&y.charAt(0)==="{"&&(y=JSON.parse(y)),!jr.isString(y))i.setOptions(y.options).addJSON(y.nested);else{xm.filename=p;var S=xm(y,i,t),T,D=0;if(S.imports)for(;D<S.imports.length;++D)(T=a(S.imports[D])||i.resolvePath(p,S.imports[D]))&&c(T);if(S.weakImports)for(D=0;D<S.weakImports.length;++D)(T=a(S.weakImports[D])||i.resolvePath(p,S.weakImports[D]))&&c(T,!0)}}catch(E){o(E)}!s&&!u&&o(null,i)}function c(p,y){if(p=a(p)||p,!(i.files.indexOf(p)>-1)){if(i.files.push(p),p in fl){s?l(p,fl[p]):(++u,setTimeout(function(){--u,l(p,fl[p])}));return}if(s){var S;try{S=jr.fs.readFileSync(p).toString("utf8")}catch(T){y||o(T);return}l(p,S)}else++u,i.fetch(p,function(T,D){if(--u,!!r){if(T){y?u||o(null,i):o(T);return}l(p,D)}})}}var u=0;jr.isString(e)&&(e=[e]);for(var h=0,d;h<e.length;++h)(d=i.resolvePath("",e[h]))&&c(d);if(s)return i;u||o(null,i)};Ut.prototype.loadSync=function(e,t){if(!jr.isNode)throw Error("not supported");return this.load(e,t,uC)};Ut.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return ih.prototype.resolveAll.call(this)};var rh=/^[A-Z]/;function aC(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Mm(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}Ut.prototype._handleAdd=function(e){if(e instanceof Mm)e.extend!==void 0&&!e.extensionField&&(aC(this,e)||this.deferred.push(e));else if(e instanceof lC)rh.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof zM)){if(e instanceof cC)for(var t=0;t<this.deferred.length;)aC(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);rh.test(e.name)&&(e.parent[e.name]=e)}};Ut.prototype._handleRemove=function(e){if(e instanceof Mm){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof lC)rh.test(e.name)&&delete e.parent[e.name];else if(e instanceof ih){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);rh.test(e.name)&&delete e.parent[e.name]}};Ut._configure=function(n,e,t){cC=n,xm=e,fl=t}});var Je=w((aj,fC)=>{"use strict";var Le=fC.exports=Ln(),dC=hm(),Pm,Lm;Le.codegen=N1();Le.fetch=x1();Le.path=L1();Le.fs=Le.inquire("fs");Le.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};Le.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var jM=/\\/g,GM=/"/g;Le.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Le.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Le.isReserved(e)?'["'+e.replace(jM,"\\\\").replace(GM,'\\"')+'"]':"."+e};Le.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var KM=/_([a-z])/g;Le.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(KM,function(t,r){return r.toUpperCase()})};Le.compareFieldsById=function(e,t){return e.id-t.id};Le.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Le.decorateRoot.remove(e.$type),e.$type.name=t,Le.decorateRoot.add(e.$type)),e.$type;Pm||(Pm=nh());var r=new Pm(t||e.name);return Le.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var HM=0;Le.decorateEnum=function(e){if(e.$type)return e.$type;Lm||(Lm=vn());var t=new Lm("Enum"+HM++,e);return Le.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Le.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(Le,"decorateRoot",{get:function(){return dC.decorated||(dC.decorated=new(sh()))}})});var Vi=w((lj,pC)=>{"use strict";pC.exports=Vt;Vt.className="ReflectionObject";var oh=Je(),ah;function Vt(n,e){if(!oh.isString(n))throw TypeError("name must be a string");if(e&&!oh.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Vt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Vt.prototype.toJSON=function(){throw Error()};Vt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof ah&&t._handleAdd(this)};Vt.prototype.onRemove=function(e){var t=e.root;t instanceof ah&&t._handleRemove(this),this.parent=null,this.resolved=!1};Vt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof ah&&(this.resolved=!0),this)};Vt.prototype.getOption=function(e){if(this.options)return this.options[e]};Vt.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};Vt.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];oh.setProperty(o,r,t)}else s={},s[e]=oh.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};Vt.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Vt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Vt._configure=function(n){ah=n}});var vn=w((cj,yC)=>{"use strict";yC.exports=Un;var gC=Vi();((Un.prototype=Object.create(gC.prototype)).constructor=Un).className="Enum";var mC=lo(),lh=Je();function Un(n,e,t,r,i,s){if(gC.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Un.fromJSON=function(e,t){var r=new Un(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};Un.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return lh.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Un.prototype.add=function(e,t,r,i){if(!lh.isString(e))throw TypeError("name must be a string");if(!lh.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Un.prototype.remove=function(e){if(!lh.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Un.prototype.isReservedId=function(e){return mC.isReservedId(this.reserved,e)};Un.prototype.isReservedName=function(e){return mC.isReservedName(this.reserved,e)}});var Om=w((uj,SC)=>{"use strict";SC.exports=WM;var $M=vn(),Fm=Ui(),Bm=Je();function vC(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function WM(n){for(var e=Bm.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(Bm.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof $M?"int32":s.type,l=Fm.basic[a];r="m"+Bm.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Fm.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&Fm.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?vC(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?vC(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var wC=w((hj,TC)=>{"use strict";var te=TC.exports=D1();te.build="light";function QM(n,e,t){return typeof e=="function"?(t=e,e=new te.Root):e||(e=new te.Root),e.load(n,t)}te.load=QM;function YM(n,e){return e||(e=new te.Root),e.loadSync(n)}te.loadSync=YM;te.encoder=Om();te.decoder=wm();te.verifier=Cm();te.converter=Am();te.ReflectionObject=Vi();te.Namespace=lo();te.Root=sh();te.Enum=vn();te.Type=nh();te.Field=Vr();te.OneOf=so();te.MapField=Yu();te.Service=Ju();te.Method=Xu();te.Message=Zu();te.wrappers=Rm();te.types=Ui();te.util=Je();te.ReflectionObject._configure(te.Root);te.Namespace._configure(te.Type,te.Service,te.Enum);te.Root._configure(te.Type);te.Field._configure(te.Type)});var Um=w((dj,CC)=>{"use strict";CC.exports=_C;var qm=/[\s{}=;:[\],'"()<>]/g,XM=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,JM=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,ZM=/^ *[*/]+ */,eP=/^\s*\*?\/*/,tP=/\n/g,nP=/\s/,rP=/\\(.?)/g,iP={0:"\0",r:"\r",n:`
`,t:"	"};function EC(n){return n.replace(rP,function(e,t){switch(t){case"\\":case"":return t;default:return iP[t]||""}})}_C.unescape=EC;function _C(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(N){return Error("illegal "+N+" (line "+i+")")}function u(){var N=l==="'"?JM:XM;N.lastIndex=t-1;var q=N.exec(n);if(!q)throw c("string");return t=N.lastIndex,T(l),l=null,EC(q[1])}function h(N){return n.charAt(N)}function d(N,q,K){var X={type:n.charAt(N++),lineEmpty:!1,leading:K},He;e?He=2:He=3;var at=N-He,pe;do if(--at<0||(pe=n.charAt(at))===`
`){X.lineEmpty=!0;break}while(pe===" "||pe==="	");for(var C=n.substring(N,q).split(tP),Re=0;Re<C.length;++Re)C[Re]=C[Re].replace(e?eP:ZM,"").trim();X.text=C.join(`
`).trim(),o[i]=X,s=i}function p(N){var q=y(N),K=n.substring(N,q),X=/^\s*\/\//.test(K);return X}function y(N){for(var q=N;q<r&&h(q)!==`
`;)q++;return q}function S(){if(a.length>0)return a.shift();if(l)return u();var N,q,K,X,He,at=t===0;do{if(t===r)return null;for(N=!1;nP.test(K=h(t));)if(K===`
`&&(at=!0,++i),++t===r)return null;if(h(t)==="/"){if(++t===r)throw c("comment");if(h(t)==="/")if(e){if(X=t,He=!1,p(t-1)){He=!0;do if(t=y(t),t===r||(t++,!at))break;while(p(t))}else t=Math.min(r,y(t)+1);He&&(d(X,t,at),at=!0),i++,N=!0}else{for(He=h(X=t+1)==="/";h(++t)!==`
`;)if(t===r)return null;++t,He&&(d(X,t-1,at),at=!0),++i,N=!0}else if((K=h(t))==="*"){X=t+1,He=e||h(X)==="*";do{if(K===`
`&&++i,++t===r)throw c("comment");q=K,K=h(t)}while(q!=="*"||K!=="/");++t,He&&(d(X,t-2,at),at=!0),N=!0}else return"/"}}while(N);var pe=t;qm.lastIndex=0;var C=qm.test(h(pe++));if(!C)for(;pe<r&&!qm.test(h(pe));)++pe;var Re=n.substring(t,t=pe);return(Re==='"'||Re==="'")&&(l=Re),Re}function T(N){a.push(N)}function D(){if(!a.length){var N=S();if(N===null)return null;T(N)}return a[0]}function E(N,q){var K=D(),X=K===N;if(X)return S(),!0;if(!q)throw c("token '"+K+"', '"+N+"' expected");return!1}function k(N){var q=null,K;return N===void 0?(K=o[i-1],delete o[i-1],K&&(e||K.type==="*"||K.lineEmpty)&&(q=K.leading?K.text:null)):(s<N&&D(),K=o[N],delete o[N],K&&!K.lineEmpty&&(e||K.type==="/")&&(q=K.leading?null:K.text)),q}return Object.defineProperty({next:S,peek:D,push:T,skip:E,cmnt:k},"line",{get:function(){return i}})}});var kC=w((fj,DC)=>{"use strict";DC.exports=lr;lr.filename=null;lr.defaults={keepCase:!1};var sP=Um(),bC=sh(),IC=nh(),AC=Vr(),oP=Yu(),RC=so(),aP=vn(),lP=Ju(),cP=Xu(),Vm=Ui(),zm=Je(),uP=/^[1-9][0-9]*$/,hP=/^-?[1-9][0-9]*$/,dP=/^0[x][0-9a-fA-F]+$/,fP=/^-?0[x][0-9a-fA-F]+$/,pP=/^0[0-7]+$/,gP=/^-?0[0-7]+$/,mP=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Vn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,zn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,yP=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function lr(n,e,t){e instanceof bC||(t=e,e=new bC),t||(t=lr.defaults);var r=t.preferTrailingComment||!1,i=sP(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,h,d,p,y,S=!1,T=e,D=t.keepCase?function(I){return I}:zm.camelCase;function E(I,A,O){var G=lr.filename;return O||(lr.filename=null),Error("illegal "+(A||"token")+" '"+I+"' ("+(G?G+", ":"")+"line "+i.line+")")}function k(){var I=[],A;do{if((A=s())!=='"'&&A!=="'")throw E(A);I.push(s()),l(A),A=a()}while(A==='"'||A==="'");return I.join("")}function N(I){var A=s();switch(A){case"'":case'"':return o(A),k();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return K(A,!0)}catch{if(I&&zn.test(A))return A;throw E(A,"value")}}function q(I,A){var O,G;do A&&((O=a())==='"'||O==="'")?I.push(k()):I.push([G=X(s()),l("to",!0)?X(s()):G]);while(l(",",!0));l(";")}function K(I,A){var O=1;switch(I.charAt(0)==="-"&&(O=-1,I=I.substring(1)),I){case"inf":case"INF":case"Inf":return O*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(uP.test(I))return O*parseInt(I,10);if(dP.test(I))return O*parseInt(I,16);if(pP.test(I))return O*parseInt(I,8);if(mP.test(I))return O*parseFloat(I);throw E(I,"number",A)}function X(I,A){switch(I){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!A&&I.charAt(0)==="-")throw E(I,"id");if(hP.test(I))return parseInt(I,10);if(fP.test(I))return parseInt(I,16);if(gP.test(I))return parseInt(I,8);throw E(I,"id")}function He(){if(h!==void 0)throw E("package");if(h=s(),!zn.test(h))throw E(h,"name");T=T.define(h),l(";")}function at(){var I=a(),A;switch(I){case"weak":A=p||(p=[]),s();break;case"public":s();default:A=d||(d=[]);break}I=k(),l(";"),A.push(I)}function pe(){if(l("="),y=k(),S=y==="proto3",!S&&y!=="proto2")throw E(y,"syntax");l(";")}function C(I,A){switch(A){case"option":return ve(I,A),l(";"),!0;case"message":return b(I,A),!0;case"enum":return he(I,A),!0;case"service":return Ve(I,A),!0;case"extend":return bs(I,A),!0}return!1}function Re(I,A,O){var G=i.line;if(I&&(typeof I.comment!="string"&&(I.comment=c()),I.filename=lr.filename),l("{",!0)){for(var z;(z=s())!=="}";)A(z);l(";",!0)}else O&&O(),l(";"),I&&(typeof I.comment!="string"||r)&&(I.comment=c(G)||I.comment)}function b(I,A){if(!Vn.test(A=s()))throw E(A,"type name");var O=new IC(A);Re(O,function(z){if(!C(O,z))switch(z){case"map":ie(O,z);break;case"required":case"repeated":f(O,z);break;case"optional":S?f(O,"proto3_optional"):f(O,"optional");break;case"oneof":we(O,z);break;case"extensions":q(O.extensions||(O.extensions=[]));break;case"reserved":q(O.reserved||(O.reserved=[]),!0);break;default:if(!S||!zn.test(z))throw E(z);o(z),f(O,"optional");break}}),I.add(O)}function f(I,A,O){var G=s();if(G==="group"){L(I,A);return}for(;G.endsWith(".")||a().startsWith(".");)G+=s();if(!zn.test(G))throw E(G,"type");var z=s();if(!Vn.test(z))throw E(z,"name");z=D(z),l("=");var J=new AC(z,X(s()),G,A,O);if(Re(J,function(Ft){if(Ft==="option")ve(J,Ft),l(";");else throw E(Ft)},function(){lt(J)}),A==="proto3_optional"){var rt=new RC("_"+z);J.setOption("proto3_optional",!0),rt.add(J),I.add(rt)}else I.add(J);!S&&J.repeated&&(Vm.packed[G]!==void 0||Vm.basic[G]===void 0)&&J.setOption("packed",!1,!0)}function L(I,A){var O=s();if(!Vn.test(O))throw E(O,"name");var G=zm.lcFirst(O);O===G&&(O=zm.ucFirst(O)),l("=");var z=X(s()),J=new IC(O);J.group=!0;var rt=new AC(G,z,O,A);rt.filename=lr.filename,Re(J,function(Ft){switch(Ft){case"option":ve(J,Ft),l(";");break;case"required":case"repeated":f(J,Ft);break;case"optional":S?f(J,"proto3_optional"):f(J,"optional");break;case"message":b(J,Ft);break;case"enum":he(J,Ft);break;default:throw E(Ft)}}),I.add(J).add(rt)}function ie(I){l("<");var A=s();if(Vm.mapKey[A]===void 0)throw E(A,"type");l(",");var O=s();if(!zn.test(O))throw E(O,"type");l(">");var G=s();if(!Vn.test(G))throw E(G,"name");l("=");var z=new oP(D(G),X(s()),A,O);Re(z,function(rt){if(rt==="option")ve(z,rt),l(";");else throw E(rt)},function(){lt(z)}),I.add(z)}function we(I,A){if(!Vn.test(A=s()))throw E(A,"name");var O=new RC(D(A));Re(O,function(z){z==="option"?(ve(O,z),l(";")):(o(z),f(O,"optional"))}),I.add(O)}function he(I,A){if(!Vn.test(A=s()))throw E(A,"name");var O=new aP(A);Re(O,function(z){switch(z){case"option":ve(O,z),l(";");break;case"reserved":q(O.reserved||(O.reserved=[]),!0);break;default:Me(O,z)}}),I.add(O)}function Me(I,A){if(!Vn.test(A))throw E(A,"name");l("=");var O=X(s(),!0),G={options:void 0};G.setOption=function(z,J){this.options===void 0&&(this.options={}),this.options[z]=J},Re(G,function(J){if(J==="option")ve(G,J),l(";");else throw E(J)},function(){lt(G)}),I.add(A,O,G.comment,G.options)}function ve(I,A){var O=l("(",!0);if(!zn.test(A=s()))throw E(A,"name");var G=A,z=G,J;O&&(l(")"),G="("+G+")",z=G,A=a(),yP.test(A)&&(J=A.slice(1),G+=A,s())),l("=");var rt=vt(I,G);De(I,z,rt,J)}function vt(I,A){if(l("{",!0)){for(var O={};!l("}",!0);){if(!Vn.test(ct=s()))throw E(ct,"name");if(ct===null)throw E(ct,"end of input");var G,z=ct;if(l(":",!0),a()==="{")G=vt(I,A+"."+ct);else if(a()==="["){G=[];var J;if(l("[",!0)){do J=N(!0),G.push(J);while(l(",",!0));l("]"),typeof J<"u"&&Ue(I,A+"."+ct,J)}}else G=N(!0),Ue(I,A+"."+ct,G);var rt=O[z];rt&&(G=[].concat(rt).concat(G)),O[z]=G,l(",",!0),l(";",!0)}return O}var _r=N(!0);return Ue(I,A,_r),_r}function Ue(I,A,O){I.setOption&&I.setOption(A,O)}function De(I,A,O,G){I.setParsedOption&&I.setParsedOption(A,O,G)}function lt(I){if(l("[",!0)){do ve(I,"option");while(l(",",!0));l("]")}return I}function Ve(I,A){if(!Vn.test(A=s()))throw E(A,"service name");var O=new lP(A);Re(O,function(z){if(!C(O,z))if(z==="rpc")St(O,z);else throw E(z)}),I.add(O)}function St(I,A){var O=c(),G=A;if(!Vn.test(A=s()))throw E(A,"name");var z=A,J,rt,_r,Ft;if(l("("),l("stream",!0)&&(rt=!0),!zn.test(A=s())||(J=A,l(")"),l("returns"),l("("),l("stream",!0)&&(Ft=!0),!zn.test(A=s())))throw E(A);_r=A,l(")");var Rc=new cP(z,G,J,_r,rt,Ft);Rc.comment=O,Re(Rc,function(Uf){if(Uf==="option")ve(Rc,Uf),l(";");else throw E(Uf)}),I.add(Rc)}function bs(I,A){if(!zn.test(A=s()))throw E(A,"reference");var O=A;Re(null,function(z){switch(z){case"required":case"repeated":f(I,z,O);break;case"optional":S?f(I,"proto3_optional",O):f(I,"optional",O);break;default:if(!S||!zn.test(z))throw E(z);o(z),f(I,"optional",O);break}})}for(var ct;(ct=s())!==null;)switch(ct){case"package":if(!u)throw E(ct);He();break;case"import":if(!u)throw E(ct);at();break;case"syntax":if(!u)throw E(ct);pe();break;case"option":ve(T,ct),l(";");break;default:if(C(T,ct)){u=!1;continue}throw E(ct)}return lr.filename=null,{package:h,imports:d,weakImports:p,syntax:y,root:e}}});var xC=w((pj,OC)=>{"use strict";OC.exports=Tn;var vP=/\/|\./;function Tn(n,e){vP.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),Tn[n]=e}Tn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var NC;Tn("duration",{Duration:NC={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});Tn("timestamp",{Timestamp:NC});Tn("empty",{Empty:{fields:{}}});Tn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});Tn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});Tn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});Tn.get=function(e){return Tn[e]||null}});var PC=w((gj,MC)=>{"use strict";var Gr=MC.exports=wC();Gr.build="full";Gr.tokenize=Um();Gr.parse=kC();Gr.common=xC();Gr.Root._configure(Gr.Type,Gr.parse,Gr.common)});var ch=w((mj,LC)=>{"use strict";LC.exports=PC()});var jm=w((yj,SP)=>{SP.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var VC=w((Y,UC)=>{"use strict";var It=ch();UC.exports=Y=It.descriptor=It.Root.fromJSON(jm()).lookup(".google.protobuf");var FC=It.Namespace,pl=It.Root,cr=It.Enum,Kr=It.Type,Hr=It.Field,TP=It.MapField,uh=It.OneOf,gl=It.Service,hh=It.Method;pl.fromDescriptor=function(e){typeof e.length=="number"&&(e=Y.FileDescriptorSet.decode(e));var t=new pl;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(Kr.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(cr.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(Hr.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(gl.fromDescriptor(r.service[o]));var a=uo(r.options,Y.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};pl.prototype.toDescriptor=function(e){var t=Y.FileDescriptorSet.create();return BC(this,t.file,e),t};function BC(n,e,t){var r=Y.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof pl||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof Kr?r.messageType.push(s.toDescriptor(t)):s instanceof cr?r.enumType.push(s.toDescriptor()):s instanceof Hr?r.extension.push(s.toDescriptor(t)):s instanceof gl?r.service.push(s.toDescriptor()):s instanceof FC&&BC(s,e,t);r.options=ho(n.options,Y.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var wP=0;Kr.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=Y.DescriptorProto.decode(e));var r=new Kr(e.name.length?e.name:"Type"+wP++,uo(e.options,Y.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(uh.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=Hr.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(Hr.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(Kr.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(cr.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};Kr.prototype.toDescriptor=function(e){var t=Y.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof TP){var s=Gm(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=Gm(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&qC(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(Y.DescriptorProto.create({name:i.typeName,field:[Y.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),Y.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:Y.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof Hr?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Kr?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof cr&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(Y.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(Y.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=ho(this.options,Y.MessageOptions),t};var EP=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;Hr.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=Y.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=AP(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new Hr(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=uo(e.options,Y.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=EP.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return RP(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};Hr.prototype.toDescriptor=function(e){var t=Y.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=It.util.ucFirst(this.name),t.label=3;else{switch(t.type=Gm(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?qC(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=ho(this.options,Y.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=Y.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=Y.FieldOptions.create())).packed=!0),t};var _P=0;cr.fromDescriptor=function(e){typeof e.length=="number"&&(e=Y.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new cr(e.name&&e.name.length?e.name:"Enum"+_P++,t,uo(e.options,Y.EnumOptions))};cr.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(Y.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return Y.EnumDescriptorProto.create({name:this.name,value:e,options:ho(this.options,Y.EnumOptions)})};var CP=0;uh.fromDescriptor=function(e){return typeof e.length=="number"&&(e=Y.OneofDescriptorProto.decode(e)),new uh(e.name&&e.name.length?e.name:"oneof"+CP++)};uh.prototype.toDescriptor=function(){return Y.OneofDescriptorProto.create({name:this.name})};var bP=0;gl.fromDescriptor=function(e){typeof e.length=="number"&&(e=Y.ServiceDescriptorProto.decode(e));var t=new gl(e.name&&e.name.length?e.name:"Service"+bP++,uo(e.options,Y.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(hh.fromDescriptor(e.method[r]));return t};gl.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return Y.ServiceDescriptorProto.create({name:this.name,method:e,options:ho(this.options,Y.ServiceOptions)})};var IP=0;hh.fromDescriptor=function(e){return typeof e.length=="number"&&(e=Y.MethodDescriptorProto.decode(e)),new hh(e.name&&e.name.length?e.name:"Method"+IP++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,uo(e.options,Y.MethodOptions))};hh.prototype.toDescriptor=function(){return Y.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:ho(this.options,Y.MethodOptions)})};function AP(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function RP(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Gm(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof cr)return 14;if(e instanceof Kr)return e.group?10:11;throw Error("illegal type: "+n)}function uo(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof cr&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(DP(s),o));return t.length?It.util.toObject(t):void 0}}function ho(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=It.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(It.util.toObject(t)):void 0}}function qC(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof pl)&&e instanceof FC)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function DP(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var zC=w((vj,kP)=>{kP.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var jC=w((Sj,NP)=>{NP.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var GC=w((Tj,OP)=>{OP.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var WC=w($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.addCommonProtos=$r.loadProtosWithOptionsSync=$r.loadProtosWithOptions=void 0;var KC=le("fs"),HC=le("path"),fo=ch();function $C(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(HC.isAbsolute(i))return i;for(let s of e){let o=HC.join(s,i);try{return KC.accessSync(o,KC.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function xP(n,e){return g(this,null,function*(){let t=new fo.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));$C(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}$r.loadProtosWithOptions=xP;function MP(n,e){let t=new fo.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");$C(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}$r.loadProtosWithOptionsSync=MP;function PP(){let n=zC(),e=jm(),t=jC(),r=GC();fo.common("api",n.nested.google.nested.protobuf.nested),fo.common("descriptor",e.nested.google.nested.protobuf.nested),fo.common("source_context",t.nested.google.nested.protobuf.nested),fo.common("type",r.nested.google.nested.protobuf.nested)}$r.addCommonProtos=PP});var XC=w((YC,Km)=>{"use strict";var QC=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(b,f,L){this.low=b|0,this.high=f|0,this.unsigned=!!L}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(b){return(b&&b.__isLong__)===!0}function i(b){var f=Math.clz32(b&-b);return b?31-f:f}t.isLong=r;var s={},o={};function a(b,f){var L,ie,we;return f?(b>>>=0,(we=0<=b&&b<256)&&(ie=o[b],ie)?ie:(L=c(b,0,!0),we&&(o[b]=L),L)):(b|=0,(we=-128<=b&&b<128)&&(ie=s[b],ie)?ie:(L=c(b,b<0?-1:0,!1),we&&(s[b]=L),L))}t.fromInt=a;function l(b,f){if(isNaN(b))return f?N:k;if(f){if(b<0)return N;if(b>=T)return at}else{if(b<=-D)return pe;if(b+1>=D)return He}return b<0?l(-b,f).neg():c(b%S|0,b/S|0,f)}t.fromNumber=l;function c(b,f,L){return new t(b,f,L)}t.fromBits=c;var u=Math.pow;function h(b,f,L){if(b.length===0)throw Error("empty string");if(typeof f=="number"?(L=f,f=!1):f=!!f,b==="NaN"||b==="Infinity"||b==="+Infinity"||b==="-Infinity")return f?N:k;if(L=L||10,L<2||36<L)throw RangeError("radix");var ie;if((ie=b.indexOf("-"))>0)throw Error("interior hyphen");if(ie===0)return h(b.substring(1),f,L).neg();for(var we=l(u(L,8)),he=k,Me=0;Me<b.length;Me+=8){var ve=Math.min(8,b.length-Me),vt=parseInt(b.substring(Me,Me+ve),L);if(ve<8){var Ue=l(u(L,ve));he=he.mul(Ue).add(l(vt))}else he=he.mul(we),he=he.add(l(vt))}return he.unsigned=f,he}t.fromString=h;function d(b,f){return typeof b=="number"?l(b,f):typeof b=="string"?h(b,f):c(b.low,b.high,typeof f=="boolean"?f:b.unsigned)}t.fromValue=d;var p=65536,y=1<<24,S=p*p,T=S*S,D=T/2,E=a(y),k=a(0);t.ZERO=k;var N=a(0,!0);t.UZERO=N;var q=a(1);t.ONE=q;var K=a(1,!0);t.UONE=K;var X=a(-1);t.NEG_ONE=X;var He=c(-1,2147483647,!1);t.MAX_VALUE=He;var at=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=at;var pe=c(0,-2147483648,!1);t.MIN_VALUE=pe;var C=t.prototype;C.toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*S+(this.low>>>0):this.high*S+(this.low>>>0)},C.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(pe)){var L=l(f),ie=this.div(L),we=ie.mul(L).sub(this);return ie.toString(f)+we.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var he=l(u(f,6),this.unsigned),Me=this,ve="";;){var vt=Me.div(he),Ue=Me.sub(vt.mul(he)).toInt()>>>0,De=Ue.toString(f);if(Me=vt,Me.isZero())return De+ve;for(;De.length<6;)De="0"+De;ve=""+De+ve}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){if(this.isNegative())return this.eq(pe)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,L=31;L>0&&!(f&1<<L);L--);return this.high!=0?L+33:L+1},C.isZero=function(){return this.high===0&&this.low===0},C.eqz=C.isZero,C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return(this.low&1)===1},C.isEven=function(){return(this.low&1)===0},C.equals=function(f){return r(f)||(f=d(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},C.eq=C.equals,C.notEquals=function(f){return!this.eq(f)},C.neq=C.notEquals,C.ne=C.notEquals,C.lessThan=function(f){return this.comp(f)<0},C.lt=C.lessThan,C.lessThanOrEqual=function(f){return this.comp(f)<=0},C.lte=C.lessThanOrEqual,C.le=C.lessThanOrEqual,C.greaterThan=function(f){return this.comp(f)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(f){return this.comp(f)>=0},C.gte=C.greaterThanOrEqual,C.ge=C.greaterThanOrEqual,C.compare=function(f){if(r(f)||(f=d(f)),this.eq(f))return 0;var L=this.isNegative(),ie=f.isNegative();return L&&!ie?-1:!L&&ie?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(pe)?pe:this.not().add(q)},C.neg=C.negate,C.add=function(f){r(f)||(f=d(f));var L=this.high>>>16,ie=this.high&65535,we=this.low>>>16,he=this.low&65535,Me=f.high>>>16,ve=f.high&65535,vt=f.low>>>16,Ue=f.low&65535,De=0,lt=0,Ve=0,St=0;return St+=he+Ue,Ve+=St>>>16,St&=65535,Ve+=we+vt,lt+=Ve>>>16,Ve&=65535,lt+=ie+ve,De+=lt>>>16,lt&=65535,De+=L+Me,De&=65535,c(Ve<<16|St,De<<16|lt,this.unsigned)},C.subtract=function(f){return r(f)||(f=d(f)),this.add(f.neg())},C.sub=C.subtract,C.multiply=function(f){if(this.isZero())return this;if(r(f)||(f=d(f)),e){var L=e.mul(this.low,this.high,f.low,f.high);return c(L,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?N:k;if(this.eq(pe))return f.isOdd()?pe:k;if(f.eq(pe))return this.isOdd()?pe:k;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(E)&&f.lt(E))return l(this.toNumber()*f.toNumber(),this.unsigned);var ie=this.high>>>16,we=this.high&65535,he=this.low>>>16,Me=this.low&65535,ve=f.high>>>16,vt=f.high&65535,Ue=f.low>>>16,De=f.low&65535,lt=0,Ve=0,St=0,bs=0;return bs+=Me*De,St+=bs>>>16,bs&=65535,St+=he*De,Ve+=St>>>16,St&=65535,St+=Me*Ue,Ve+=St>>>16,St&=65535,Ve+=we*De,lt+=Ve>>>16,Ve&=65535,Ve+=he*Ue,lt+=Ve>>>16,Ve&=65535,Ve+=Me*vt,lt+=Ve>>>16,Ve&=65535,lt+=ie*De+we*Ue+he*vt+Me*ve,lt&=65535,c(St<<16|bs,lt<<16|Ve,this.unsigned)},C.mul=C.multiply,C.divide=function(f){if(r(f)||(f=d(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var L=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(L,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?N:k;var ie,we,he;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return N;if(f.gt(this.shru(1)))return K;he=N}else{if(this.eq(pe)){if(f.eq(q)||f.eq(X))return pe;if(f.eq(pe))return q;var Me=this.shr(1);return ie=Me.div(f).shl(1),ie.eq(k)?f.isNegative()?q:X:(we=this.sub(f.mul(ie)),he=ie.add(we.div(f)),he)}else if(f.eq(pe))return this.unsigned?N:k;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();he=k}for(we=this;we.gte(f);){ie=Math.max(1,Math.floor(we.toNumber()/f.toNumber()));for(var ve=Math.ceil(Math.log(ie)/Math.LN2),vt=ve<=48?1:u(2,ve-48),Ue=l(ie),De=Ue.mul(f);De.isNegative()||De.gt(we);)ie-=vt,Ue=l(ie,this.unsigned),De=Ue.mul(f);Ue.isZero()&&(Ue=q),he=he.add(Ue),we=we.sub(De)}return he},C.div=C.divide,C.modulo=function(f){if(r(f)||(f=d(f)),e){var L=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(L,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},C.mod=C.modulo,C.rem=C.modulo,C.not=function(){return c(~this.low,~this.high,this.unsigned)},C.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},C.clz=C.countLeadingZeros,C.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},C.ctz=C.countTrailingZeros,C.and=function(f){return r(f)||(f=d(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},C.or=function(f){return r(f)||(f=d(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},C.xor=function(f){return r(f)||(f=d(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},C.shiftLeft=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},C.shru=C.shiftRightUnsigned,C.shr_u=C.shiftRightUnsigned,C.rotateLeft=function(f){var L;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(L=32-f,c(this.low<<f|this.high>>>L,this.high<<f|this.low>>>L,this.unsigned)):(f-=32,L=32-f,c(this.high<<f|this.low>>>L,this.low<<f|this.high>>>L,this.unsigned))},C.rotl=C.rotateLeft,C.rotateRight=function(f){var L;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(L=32-f,c(this.high<<L|this.low>>>f,this.low<<L|this.high>>>f,this.unsigned)):(f-=32,L=32-f,c(this.low<<L|this.high>>>f,this.high<<L|this.low>>>f,this.unsigned))},C.rotr=C.rotateRight,C.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},C.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){var f=this.high,L=this.low;return[L&255,L>>>8&255,L>>>16&255,L>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},C.toBytesBE=function(){var f=this.high,L=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,L>>>24,L>>>16&255,L>>>8&255,L&255]},t.fromBytes=function(f,L,ie){return ie?t.fromBytesLE(f,L):t.fromBytesBE(f,L)},t.fromBytesLE=function(f,L){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,L)},t.fromBytesBE=function(f,L){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],L)};var Re=t;return n.default=Re,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return QC}):typeof Km=="object"&&typeof YC=="object"&&(Km.exports=QC)});var Qm=w(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.loadFileDescriptorSetFromObject=pt.loadFileDescriptorSetFromBuffer=pt.fromJSON=pt.loadSync=pt.load=pt.isAnyExtension=pt.Long=void 0;var LP=B_(),jn=ch(),$m=VC(),Wm=WC(),FP=XC();pt.Long=FP;function BP(n){return"@type"in n&&typeof n["@type"]=="string"}pt.isAnyExtension=BP;var eb={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function qP(n,e){return n===""?e:n+"."+e}function UP(n){return n instanceof jn.Service||n instanceof jn.Type||n instanceof jn.Enum}function VP(n){return n instanceof jn.Namespace||n instanceof jn.Root}function tb(n,e){let t=qP(e,n.name);return UP(n)?[[t,n]]:VP(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>tb(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function JC(n,e){return function(r){return n.toObject(n.decode(r),e)}}function ZC(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function zP(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:ZC(i),requestDeserialize:JC(i,t),responseSerialize:ZC(s),responseDeserialize:JC(s,t),originalName:LP(n.name),requestType:Hm(i,r),responseType:Hm(s,r)}}function jP(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=zP(s,e,t,r);return i}function Hm(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,eb),fileDescriptorProtos:e}}function GP(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,eb),fileDescriptorProtos:e}}function KP(n,e,t,r){if(n instanceof jn.Service)return jP(n,e,t,r);if(n instanceof jn.Type)return Hm(n,r);if(n instanceof jn.Enum)return GP(n,r);throw new Error("Type mismatch in reflection object handling")}function dh(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from($m.FileDescriptorProto.encode(s).finish()));for(let[s,o]of tb(n,""))t[s]=KP(o,s,e,i);return t}function nb(n,e){e=e||{};let t=jn.Root.fromDescriptor(n);return t.resolveAll(),dh(t,e)}function HP(n,e){return(0,Wm.loadProtosWithOptions)(n,e).then(t=>dh(t,e))}pt.load=HP;function $P(n,e){let t=(0,Wm.loadProtosWithOptionsSync)(n,e);return dh(t,e)}pt.loadSync=$P;function WP(n,e){e=e||{};let t=jn.Root.fromJSON(n);return t.resolveAll(),dh(t,e)}pt.fromJSON=WP;function QP(n,e){let t=$m.FileDescriptorSet.decode(n);return nb(t,e)}pt.loadFileDescriptorSetFromBuffer=QP;function YP(n,e){let t=$m.FileDescriptorSet.fromObject(n);return nb(t,e)}pt.loadFileDescriptorSetFromObject=YP;(0,Wm.addCommonProtos)()});var ji=w(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.setup=Ee.getChannelzServiceDefinition=Ee.getChannelzHandlers=Ee.unregisterChannelzRef=Ee.registerChannelzSocket=Ee.registerChannelzServer=Ee.registerChannelzSubchannel=Ee.registerChannelzChannel=Ee.ChannelzCallTracker=Ee.ChannelzChildrenTracker=Ee.ChannelzTrace=void 0;var rb=le("net"),ml=Wt(),vl=oe(),XP=Mn(),JP=xu(),ZP=Hg();function Ym(n){return{channel_id:n.id,name:n.name}}function ey(n){return{subchannel_id:n.id,name:n.name}}function e3(n){return{server_id:n.id}}function ph(n){return{socket_id:n.id,name:n.name}}var ib=32,Xm=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=ib*2&&(this.events=this.events.slice(ib)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:ur(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:ur(e.timestamp),channel_ref:e.childChannel?Ym(e.childChannel):null,subchannel_ref:e.childSubchannel?ey(e.childSubchannel):null}))}}};Ee.ChannelzTrace=Xm;var Jm=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Ee.ChannelzChildrenTracker=Jm;var Zm=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Ee.ChannelzCallTracker=Zm;var t3=1;function gh(){return t3++}var yl=[],ty=[],Wr=[],ny=[];function n3(n,e,t){let r=gh(),i={id:r,name:n,kind:"channel"};return t&&(yl[r]={ref:i,getInfo:e}),i}Ee.registerChannelzChannel=n3;function r3(n,e,t){let r=gh(),i={id:r,name:n,kind:"subchannel"};return t&&(ty[r]={ref:i,getInfo:e}),i}Ee.registerChannelzSubchannel=r3;function i3(n,e){let t=gh(),r={id:t,kind:"server"};return e&&(Wr[t]={ref:r,getInfo:n}),r}Ee.registerChannelzServer=i3;function s3(n,e,t){let r=gh(),i={id:r,name:n,kind:"socket"};return t&&(ny[r]={ref:i,getInfo:e}),i}Ee.registerChannelzSocket=s3;function o3(n){switch(n.kind){case"channel":delete yl[n.id];return;case"subchannel":delete ty[n.id];return;case"server":delete Wr[n.id];return;case"socket":delete ny[n.id];return}}Ee.unregisterChannelzRef=o3;function a3(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function sb(n){if(n==="")return[];let e=n.split(":").map(r=>a3(r));return[].concat(...e)}function l3(n){if((0,rb.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,rb.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(sb(e)),s=Buffer.from(sb(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function ab(n){switch(n){case ml.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case ml.ConnectivityState.IDLE:return{state:"IDLE"};case ml.ConnectivityState.READY:return{state:"READY"};case ml.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case ml.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function ur(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function lb(n){let e=n.getInfo();return{ref:Ym(n.ref),data:{target:e.target,state:ab(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:ur(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>Ym(t)),subchannel_ref:e.children.subchannels.map(t=>ey(t))}}function c3(n,e){let t=Number.parseInt(n.request.channel_id),r=yl[t];if(r===void 0){e({code:vl.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:lb(r)})}function u3(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<yl.length;i++){let s=yl[i];if(s!==void 0&&(r.push(lb(s)),r.length>=t))break}e(null,{channel:r,end:i>=Wr.length})}function cb(n){let e=n.getInfo();return{ref:e3(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:ur(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>ph(t))}}function h3(n,e){let t=Number.parseInt(n.request.server_id),r=Wr[t];if(r===void 0){e({code:vl.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:cb(r)})}function d3(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<Wr.length;i++){let s=Wr[i];if(s!==void 0&&(r.push(cb(s)),r.length>=t))break}e(null,{server:r,end:i>=Wr.length})}function f3(n,e){let t=Number.parseInt(n.request.subchannel_id),r=ty[t];if(r===void 0){e({code:vl.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:ey(r.ref),data:{target:i.target,state:ab(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:ur(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>ph(o))};e(null,{subchannel:s})}function ob(n){var e;return(0,XP.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=l3(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function p3(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=ny[a];if(l===void 0){e({code:vl.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,h={ref:ph(l.ref),local:c.localAddress?ob(c.localAddress):null,remote:c.remoteAddress?ob(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:ur(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:ur(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:ur(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:ur(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:h})}function g3(n,e){let t=Number.parseInt(n.request.server_id),r=Wr[t];if(r===void 0){e({code:vl.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,h)=>u.id-h.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(ph(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function ub(){return{GetChannel:c3,GetTopChannels:u3,GetServer:h3,GetServers:d3,GetSubchannel:f3,GetSocket:p3,GetServerSockets:g3}}Ee.getChannelzHandlers=ub;var fh=null;function hb(){if(fh)return fh;let n=Qm().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return fh=(0,ZP.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,fh}Ee.getChannelzServiceDefinition=hb;function m3(){(0,JP.registerAdminService)(hb,ub)}Ee.setup=m3});var db=w(yh=>{"use strict";Object.defineProperty(yh,"__esModule",{value:!0});yh.Subchannel=void 0;var me=Wt(),y3=Xa(),ry=Ne(),mh=oe(),v3=qt(),S3=Mn(),po=ji(),T3="subchannel",w3=~(1<<31),iy=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=me.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new po.ChannelzCallTracker,this.childrenTracker=new po.ChannelzChildrenTracker,this.streamTracker=new po.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new y3.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,S3.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new po.ChannelzTrace,this.channelzRef=(0,po.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){ry.trace(mh.LogVerbosity.DEBUG,T3,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){ry.trace(mh.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([me.ConnectivityState.TRANSIENT_FAILURE],me.ConnectivityState.CONNECTING):this.transitionToState([me.ConnectivityState.TRANSIENT_FAILURE],me.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,w3);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([me.ConnectivityState.CONNECTING],me.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([me.ConnectivityState.READY],me.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,ry.log(mh.LogVerbosity.ERROR,`Connection to ${(0,v3.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([me.ConnectivityState.CONNECTING],me.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(me.ConnectivityState[this.connectivityState]+" -> "+me.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+me.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case me.ConnectivityState.READY:this.stopBackoff();break;case me.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case me.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case me.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,po.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([me.ConnectivityState.CONNECTING,me.ConnectivityState.READY],me.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===mh.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([me.ConnectivityState.IDLE],me.ConnectivityState.CONNECTING)||this.connectivityState===me.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([me.ConnectivityState.TRANSIENT_FAILURE],me.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};yh.Subchannel=iy});var ly=w(Xr=>{"use strict";Object.defineProperty(Xr,"__esModule",{value:!0});Xr.setup=Xr.DEFAULT_PORT=void 0;var fb=On(),gb=le("dns"),mb=le("util"),E3=Sg(),sy=oe(),oy=bt(),_3=Ne(),C3=oe(),Qr=qt(),pb=le("net"),b3=Xa(),I3="dns_resolver";function Yr(n){_3.trace(C3.LogVerbosity.DEBUG,I3,n)}Xr.DEFAULT_PORT=443;var A3=3e4,R3=mb.promisify(gb.resolveTxt),D3=mb.promisify(gb.lookup);function k3(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var ay=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,Yr("Resolver constructed for target "+(0,Qr.uriToString)(e));let a=(0,Qr.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,pb.isIPv4)(a.host)||(0,pb.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:Xr.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:Xr.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:sy.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,Qr.uriToString)(this.target)}`,metadata:new oy.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new b3.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:A3,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(Yr("Returning IP address for target "+(0,Qr.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)Yr("Failed to parse DNS address "+(0,Qr.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:sy.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,Qr.uriToString)(this.target)}`,metadata:new oy.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;Yr("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=D3(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=k3(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(Yr("Resolved addresses for target "+(0,Qr.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(Yr("Resolution error for target "+(0,Qr.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=R3(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,E3.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:sy.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new oy.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?Yr('resolution update delayed by "min time between resolutions" rate limit'):Yr("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function N3(){(0,fb.registerResolver)("dns",ay),(0,fb.registerDefaultScheme)("dns")}Xr.setup=N3});var cy=w(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.getProxiedConnection=yo.mapProxyName=void 0;var Sl=Ne(),go=oe(),O3=On(),x3=le("http"),M3=le("tls"),P3=Ne(),yb=Mn(),mo=qt(),L3=le("url"),F3=ly(),B3="proxy";function Jr(n){P3.trace(go.LogVerbosity.DEBUG,B3,n)}function q3(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new L3.URL(n)}catch{return(0,Sl.log)(go.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,Sl.log)(go.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,Sl.log)(go.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),Jr("Proxy server "+o.address+" set by environment variable "+e),o}function U3(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(Jr("No proxy server list set by environment variable "+e),n.split(",")):[]}function V3(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=q3();if(!i.address)return r;let s=(0,mo.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of U3())if(l===o)return Jr("Not using proxy for target in no_proxy list: "+(0,mo.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,mo.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}yo.mapProxyName=V3;function z3(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,mo.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,mo.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:F3.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,yb.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,yb.subchannelAddressToString)(n);return Jr("Using proxy "+u+" to connect to "+l.path),new Promise((h,d)=>{let p=x3.request(l);p.once("connect",(y,S,T)=>{var D;if(p.removeAllListeners(),S.removeAllListeners(),y.statusCode===200)if(Jr("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let E=(0,O3.getDefaultAuthority)(s),k=(0,mo.splitHostPort)(E),N=(D=k?.host)!==null&&D!==void 0?D:E,q=M3.connect(Object.assign({host:N,servername:N,socket:S},t),()=>{Jr("Successfully established a TLS connection to "+l.path+" through proxy "+u),h({socket:q,realTarget:s})});q.on("error",K=>{Jr("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+K.message),d()})}else Jr("Successfully established a plaintext connection to "+l.path+" through proxy "+u),h({socket:S,realTarget:s});else(0,Sl.log)(go.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+y.statusCode),d()}),p.once("error",y=>{p.removeAllListeners(),(0,Sl.log)(go.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+y.message),d()}),p.end()})}yo.getProxiedConnection=z3});var hy=w(vh=>{"use strict";Object.defineProperty(vh,"__esModule",{value:!0});vh.StreamDecoder=void 0;var hr=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(hr||{}),uy=class{constructor(){this.readState=hr.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case hr.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=hr.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case hr.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=hr.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=hr.NO_DATA,i.push(s)}break;case hr.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=hr.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};vh.StreamDecoder=uy});var vb=w(Sh=>{"use strict";Object.defineProperty(Sh,"__esModule",{value:!0});Sh.Http2SubchannelCall=void 0;var dr=le("http2"),j3=le("os"),de=oe(),Zr=bt(),G3=hy(),K3=Ne(),H3=oe(),$3="subchannel_call";function W3(n){for(let[e,t]of Object.entries(j3.constants.errno))if(t===n)return e;return"Unknown system error "+n}var dy=class{constructor(e,t,r,i,s){this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.decoder=new G3.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=de.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(o,a)=>{let l="";for(let c of Object.keys(o))l+="		"+c+": "+o[c]+`
`;switch(this.trace(`Received server headers:
`+l),o[":status"]){case 400:this.mappedStatusCode=de.Status.INTERNAL;break;case 401:this.mappedStatusCode=de.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=de.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=de.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=de.Status.UNAVAILABLE;break;default:this.mappedStatusCode=de.Status.UNKNOWN}if(a&dr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(o);else{let c;try{c=Zr.Metadata.fromHttp2Headers(o)}catch(u){this.endCall({code:de.Status.UNKNOWN,details:u.message,metadata:new Zr.Metadata});return}this.listener.onReceiveMetadata(c)}}),e.on("trailers",o=>{this.handleTrailers(o)}),e.on("data",o=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+o.length);let a=this.decoder.write(o);for(let l of a)this.trace("parsed message of length "+l.length),this.callEventTracker.addMessageReceived(),this.tryPush(l)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var o;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((o=this.finalStatus)===null||o===void 0?void 0:o.code)===de.Status.OK)return;let a,l="";switch(e.rstCode){case dr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;a=de.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`;break;case dr.constants.NGHTTP2_REFUSED_STREAM:a=de.Status.UNAVAILABLE,l="Stream refused by server";break;case dr.constants.NGHTTP2_CANCEL:a=de.Status.CANCELLED,l="Call cancelled";break;case dr.constants.NGHTTP2_ENHANCE_YOUR_CALM:a=de.Status.RESOURCE_EXHAUSTED,l="Bandwidth exhausted or memory limit exceeded";break;case dr.constants.NGHTTP2_INADEQUATE_SECURITY:a=de.Status.PERMISSION_DENIED,l="Protocol not secure enough";break;case dr.constants.NGHTTP2_INTERNAL_ERROR:a=de.Status.INTERNAL,this.internalError===null?l=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(a=de.Status.UNAVAILABLE,l=this.internalError.message):l=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:a=de.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:a,details:l,metadata:new Zr.Metadata,rstCode:e.rstCode})})}),e.on("error",o=>{o.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+o.message+" code="+o.code+" errno="+W3(o.errno)+" syscall="+o.syscall),this.internalError=o),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:de.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Zr.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){K3.trace(H3.LogVerbosity.DEBUG,$3,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===de.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==de.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=Zr.Metadata.fromHttp2Headers(e)}catch{r=new Zr.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===de.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in de.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===de.Status.OK?t=dr.constants.NGHTTP2_NO_ERROR:t=dr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Zr.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==de.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=de.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=de.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:de.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new Zr.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Sh.Http2SubchannelCall=dy});var fy=w(Th=>{"use strict";Object.defineProperty(Th,"__esModule",{value:!0});Th.getNextCallNumber=void 0;var Q3=0;function Y3(){return Q3++}Th.getNextCallNumber=Y3});var wb=w(Eh=>{"use strict";Object.defineProperty(Eh,"__esModule",{value:!0});Eh.Http2SubchannelConnector=void 0;var vy=le("http2"),Sb=le("tls"),py=ji(),Tl=oe(),X3=cy(),So=Ne(),Tb=On(),wh=Mn(),vo=qt(),J3=le("net"),Z3=vb(),e4=fy(),gy="transport",t4="transport_flowctrl",n4=tg().version,{HTTP2_HEADER_AUTHORITY:r4,HTTP2_HEADER_CONTENT_TYPE:i4,HTTP2_HEADER_METHOD:s4,HTTP2_HEADER_PATH:o4,HTTP2_HEADER_TE:a4,HTTP2_HEADER_USER_AGENT:l4}=vy.constants,c4=2e4,u4=Buffer.from("too_many_pings","ascii"),my=class{constructor(e,t,r,i){this.session=e,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=c4,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new py.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,wh.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,py.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${n4}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===vy.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(u4)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),So.isTracerEnabled(gy)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,wh.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,wh.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),h=c.getCertificate(),d=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:h&&"raw"in h?h.raw:null,remoteCertificate:d&&"raw"in d?d.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){So.trace(Tl.LogVerbosity.DEBUG,gy,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){So.trace(Tl.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){So.trace(Tl.LogVerbosity.DEBUG,t4,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){So.trace(Tl.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[r4]=t,o[l4]=this.userAgent,o[i4]="application/grpc",o[s4]="POST",o[o4]=r,o[a4]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var h;(h=s.onCallEnd)===null||h===void 0||h.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var h;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(h=s.onStreamEnd)===null||h===void 0||h.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var h;(h=s.onCallEnd)===null||h===void 0||h.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var h;(h=s.onStreamEnd)===null||h===void 0||h.call(s,u)}},c=new Z3.Http2SubchannelCall(a,l,i,this,(0,e4.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,py.unregisterChannelzRef)(this.channelzRef)}},yy=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){So.trace(Tl.LogVerbosity.DEBUG,gy,(0,vo.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,vo.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,vo.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,wh.subchannelAddressToString)(e)));let h=(0,Tb.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),d=t._getConnectionOptions()||{};d.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?d.maxSessionMemory=r["grpc-node.max_session_memory"]:d.maxSessionMemory=Number.MAX_SAFE_INTEGER;let p="http://";if("secureContext"in d){if(p="https://",r["grpc.ssl_target_name_override"]){let T=r["grpc.ssl_target_name_override"];d.checkServerIdentity=(D,E)=>(0,Sb.checkServerIdentity)(T,E),d.servername=T}else{let T=(c=(l=(0,vo.splitHostPort)(h))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";d.servername=T}i.socket&&(d.createConnection=(T,D)=>i.socket)}else d.createConnection=(T,D)=>i.socket?i.socket:J3.connect(e);d=Object.assign(Object.assign(Object.assign({},d),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let y=vy.connect(p+h,d);this.session=y;let S="Failed to connect";y.unref(),y.once("connect",()=>{y.removeAllListeners(),s(new my(y,e,r,u)),this.session=null}),y.once("close",()=>{this.session=null,setImmediate(()=>{o(`${S} (${new Date().toISOString()})`)})}),y.once("error",T=>{S=T.message,this.trace("connection failed with error "+S)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,Sb.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,Tb.getDefaultAuthority)((i=(0,vo.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,vo.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,X3.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Eh.Http2SubchannelConnector=yy});var Eb=w(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.getSubchannelPool=To.SubchannelPool=void 0;var h4=o_(),d4=db(),f4=Mn(),p4=qt(),g4=wb(),m4=1e4,wl=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},m4),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,p4.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,f4.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,h4.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new d4.Subchannel(e,t,r,i,new g4.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};To.SubchannelPool=wl;var y4=new wl;function v4(n){return n?y4:new wl}To.getSubchannelPool=v4});var Ty=w(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.FilterStackFactory=wo.FilterStack=void 0;var _h=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};wo.FilterStack=_h;var Sy=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new _h(this.factories.map(e=>e.createFilter()))}};wo.FilterStackFactory=Sy});var wy=w(Ch=>{"use strict";Object.defineProperty(Ch,"__esModule",{value:!0});Ch.CompressionAlgorithms=void 0;var _b=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(_b||(Ch.CompressionAlgorithms=_b={}))});var Ih=w(bh=>{"use strict";Object.defineProperty(bh,"__esModule",{value:!0});bh.BaseFilter=void 0;var Ey=class{sendMetadata(e){return g(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return g(this,null,function*(){return e})}receiveMessage(e){return g(this,null,function*(){return e})}receiveTrailers(e){return e}};bh.BaseFilter=Ey});var Ib=w(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.CompressionFilterFactory=_o.CompressionFilter=void 0;var Ah=le("zlib"),bb=wy(),S4=oe(),T4=Ih(),w4=Ne(),E4=n=>typeof n=="number"&&typeof bb.CompressionAlgorithms[n]=="string",Eo=class{writeMessage(e,t){return g(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return g(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Gi=class extends Eo{compressMessage(e){return g(this,null,function*(){return e})}writeMessage(e,t){return g(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},_y=class extends Eo{compressMessage(e){return new Promise((t,r)=>{Ah.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{Ah.inflate(e,(i,s)=>{i?r(i):t(s)})})}},Cy=class extends Eo{compressMessage(e){return new Promise((t,r)=>{Ah.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{Ah.unzip(e,(i,s)=>{i?r(i):t(s)})})}},by=class extends Eo{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function Cb(n){switch(n){case"identity":return new Gi;case"deflate":return new _y;case"gzip":return new Cy;default:return new by(n)}}var Rh=class extends T4.BaseFilter{constructor(e,t){var r;super(),this.sharedFilterConfig=t,this.sendCompression=new Gi,this.receiveCompression=new Gi,this.currentCompressionAlgorithm="identity";let i=e["grpc.default_compression_algorithm"];if(i!==void 0)if(E4(i)){let s=bb.CompressionAlgorithms[i],o=(r=t.serverSupportedEncodingHeader)===null||r===void 0?void 0:r.split(",");(!o||o.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=Cb(this.currentCompressionAlgorithm))}else w4.log(S4.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${i}`)}sendMetadata(e){return g(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=Cb(i))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Gi,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return g(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Gi?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return g(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};_o.CompressionFilter=Rh;var Iy=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Rh(this.options,this.sharedFilterConfig)}};_o.CompressionFilterFactory=Iy});var Rb=w(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});Co.MaxMessageSizeFilterFactory=Co.MaxMessageSizeFilter=void 0;var _4=Ih(),Dh=oe(),Ab=bt(),kh=class extends _4.BaseFilter{constructor(e){super(),this.maxSendMessageSize=Dh.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Dh.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}sendMessage(e){return g(this,null,function*(){if(this.maxSendMessageSize===-1)return e;{let t=yield e;if(t.message.length>this.maxSendMessageSize)throw{code:Dh.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new Ab.Metadata};return t}})}receiveMessage(e){return g(this,null,function*(){if(this.maxReceiveMessageSize===-1)return e;{let t=yield e;if(t.length>this.maxReceiveMessageSize)throw{code:Dh.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new Ab.Metadata};return t}})}};Co.MaxMessageSizeFilter=kh;var Ay=class{constructor(e){this.options=e}createFilter(){return new kh(this.options)}};Co.MaxMessageSizeFilterFactory=Ay});var Nh=w(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.deadlineToString=Gn.getRelativeTimeout=Gn.getDeadlineTimeoutString=Gn.minDeadline=void 0;function C4(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}Gn.minDeadline=C4;var b4=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function I4(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of b4){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}Gn.getDeadlineTimeoutString=I4;var A4=2147483647;function R4(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>A4?1/0:r}Gn.getRelativeTimeout=R4;function D4(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Gn.deadlineToString=D4});var xh=w(Oh=>{"use strict";Object.defineProperty(Oh,"__esModule",{value:!0});Oh.restrictControlPlaneStatusCode=void 0;var Kn=oe(),k4=[Kn.Status.OK,Kn.Status.INVALID_ARGUMENT,Kn.Status.NOT_FOUND,Kn.Status.ALREADY_EXISTS,Kn.Status.FAILED_PRECONDITION,Kn.Status.ABORTED,Kn.Status.OUT_OF_RANGE,Kn.Status.DATA_LOSS];function N4(n,e){return k4.includes(n)?{code:Kn.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Kn.Status[n]} ${e}`}:{code:n,details:e}}Oh.restrictControlPlaneStatusCode=N4});var kb=w(Lh=>{"use strict";Object.defineProperty(Lh,"__esModule",{value:!0});Lh.LoadBalancingCall=void 0;var Db=Wt(),Mh=oe(),O4=Nh(),Ph=bt(),El=Fr(),x4=qt(),M4=Ne(),Ry=xh(),P4=le("http2"),L4="load_balancing_call",Dy=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),h="";u.length>=2&&(h=u[1]);let d=(c=(l=(0,x4.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){M4.trace(Mh.LogVerbosity.DEBUG,L4,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+El.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case El.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let h=this.metadata.clone();if(h.merge(a),h.get("authorization").length>1&&this.outputStatus({code:Mh.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new Ph.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==Db.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+Db.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&h.set("grpc-timeout",(0,O4.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(h,this.host,this.methodName,{onReceiveMetadata:d=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(d)},onReceiveMessage:d=>{this.trace("Received message"),this.listener.onReceiveMessage(d)},onReceiveStatus:d=>{this.trace("Received status"),d.rstCode===P4.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(d,"REFUSED"):this.outputStatus(d,"PROCESSED")}})}catch(d){this.trace("Failed to start call on picked subchannel "+i+" with error "+d.message),this.outputStatus({code:Mh.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+d.message,metadata:new Ph.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,Ry.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:Mh.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new Ph.Metadata},"PROCESSED")});break;case El.PickResultType.DROP:let{code:s,details:o}=(0,Ry.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case El.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,Ry.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case El.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Ph.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Lh.LoadBalancingCall=Dy});var Ob=w(Bh=>{"use strict";Object.defineProperty(Bh,"__esModule",{value:!0});Bh.ResolvingCall=void 0;var bo=oe(),Fh=Nh(),Nb=bt(),F4=Ne(),B4=xh(),q4="resolving_call",ky=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&bo.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(bo.Status.CANCELLED,"Cancelled by parent call")}),r.flags&bo.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,Fh.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){F4.trace(bo.LogVerbosity.DEBUG,q4,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Fh.deadlineToString)(this.deadline));let e=(0,Fh.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(bo.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==bo.Status.OK){let{code:r,details:i}=(0,B4.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new Nb.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Fh.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Nb.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Bh.ResolvingCall=ky});var xb=w(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.RetryingCall=ei.MessageBufferTracker=ei.RetryThrottler=void 0;var qh=oe(),U4=bt(),V4=Ne(),z4="retrying_call",Oy=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};ei.RetryThrottler=Oy;var xy=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};ei.MessageBufferTracker=xy;var Ny="grpc-previous-rpc-attempts",My=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){V4.trace(qh.LogVerbosity.DEBUG,z4,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new U4.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(qh.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===qh.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===qh.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Ny,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(Ny,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(Ny,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};ei.RetryingCall=My});var Vh=w(Uh=>{"use strict";Object.defineProperty(Uh,"__esModule",{value:!0});Uh.BaseSubchannelWrapper=void 0;var Py=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Uh.BaseSubchannelWrapper=Py});var Lb=w(Gh=>{"use strict";Object.defineProperty(Gh,"__esModule",{value:!0});Gh.InternalChannel=void 0;var j4=Cu(),G4=s_(),K4=Eb(),Mb=Fr(),_l=oe(),H4=Ty(),$4=Ib(),Pb=On(),Ly=Ne(),W4=Rb(),Q4=cy(),zh=qt(),Hn=Wt(),Cl=ji(),Y4=kb(),X4=Nh(),J4=Ob(),Fy=fy(),Z4=xh(),By=xb(),eL=Vh(),tL=2147483647,nL=1e3,rL=30*60*1e3,jh=new Map,iL=1<<24,sL=1<<20,qy=class extends eL.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Uy=class{constructor(e,t,r){var i,s,o,a,l,c,u,h;if(this.credentials=t,this.options=r,this.connectivityState=Hn.ConnectivityState.IDLE,this.currentPicker=new Mb.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Cl.ChannelzCallTracker,this.childrenTracker=new Cl.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof j4.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let d=(0,zh.parseUri)(e);if(d===null)throw new Error(`Could not parse target name "${e}"`);let p=(0,Pb.mapUriDefaultScheme)(d);if(p===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},tL),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Cl.ChannelzTrace,this.channelzRef=(0,Cl.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,Pb.getDefaultAuthority)(p);let y=(0,Q4.mapProxyName)(p,r);this.target=y.target,this.options=Object.assign({},this.options,y.extraOptions),this.subchannelPool=(0,K4.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new By.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:iL,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:sL),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:rL,nL);let S={createSubchannel:(D,E)=>{let k=this.subchannelPool.getOrCreateSubchannel(this.target,D,Object.assign({},this.options,E),this.credentials);k.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",k.getChannelzRef());let N=new qy(k,this);return this.wrappedSubchannels.add(N),N},updateState:(D,E)=>{this.currentPicker=E;let k=this.pickQueue.slice();this.pickQueue=[],k.length>0&&this.callRefTimerUnref();for(let N of k)N.doPick();this.updateState(D)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:D=>{this.channelzEnabled&&this.childrenTracker.refChild(D)},removeChannelzChild:D=>{this.channelzEnabled&&this.childrenTracker.unrefChild(D)}};this.resolvingLoadBalancer=new G4.ResolvingLoadBalancer(this.target,S,r,(D,E)=>{D.retryThrottling?jh.set(this.getTarget(),new By.RetryThrottler(D.retryThrottling.maxTokens,D.retryThrottling.tokenRatio,jh.get(this.getTarget()))):jh.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=E,this.currentResolutionError=null,process.nextTick(()=>{let k=this.configSelectionQueue;this.configSelectionQueue=[],k.length>0&&this.callRefTimerUnref();for(let N of k)N.getConfig()})},D=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+D.code+' and details "'+D.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,Z4.restrictControlPlaneStatusCode)(D.code,D.details)),{metadata:D.metadata}));let E=this.configSelectionQueue;this.configSelectionQueue=[],E.length>0&&this.callRefTimerUnref();for(let k of E)k.reportResolverError(D)}),this.filterStackFactory=new H4.FilterStackFactory([new W4.MaxMessageSizeFilterFactory(this.options),new $4.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let T=new Error;(0,Ly.trace)(_l.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((h=T.stack)===null||h===void 0?void 0:h.substring(T.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Ly.trace)(t??_l.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,zh.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Ly.trace)(_l.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,zh.uriToString)(this.target)+" "+Hn.ConnectivityState[this.connectivityState]+" -> "+Hn.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Hn.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==Hn.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Hn.ConnectivityState.IDLE),this.currentPicker=new Mb.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==Hn.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===_l.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,Fy.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new Y4.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,Fy.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new By.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,jh.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,Fy.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,X4.deadlineToString)(t));let a={deadline:t,flags:s??_l.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new J4.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Hn.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Cl.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,zh.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===Hn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Hn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};Gh.InternalChannel=Uy});var Gg=w(Kh=>{"use strict";Object.defineProperty(Kh,"__esModule",{value:!0});Kh.ChannelImplementation=void 0;var oL=Cu(),aL=Lb(),Vy=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof oL.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new aL.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Kh.ChannelImplementation=Vy});var Hb=w(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.Http2ServerCallStream=rn.ServerDuplexStreamImpl=rn.ServerWritableStreamImpl=rn.ServerReadableStreamImpl=rn.ServerUnaryCallImpl=void 0;var Vb=le("events"),Io=le("http2"),Gy=le("stream"),zb=le("zlib"),jb=le("util"),_e=oe(),Ky=bt(),lL=hy(),Gb=Ne(),Il=vu(),Kb="server_call",cL=(0,jb.promisify)(zb.unzip),uL=(0,jb.promisify)(zb.inflate);function bl(n){Gb.trace(_e.LogVerbosity.DEBUG,Kb,n)}var hL="grpc-accept-encoding",dL="grpc-encoding",Fb="grpc-message",Bb="grpc-status",qb="grpc-timeout",fL=/(\d{1,8})\s*([HMSmun])/,pL={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},gL={[hL]:"identity,deflate,gzip",[dL]:"identity"},Ub={[Io.constants.HTTP2_HEADER_STATUS]:Io.constants.HTTP_STATUS_OK,[Io.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},mL={waitForTrailers:!0},zy=class extends Vb.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};rn.ServerUnaryCallImpl=zy;var Hh=class extends Gy.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};rn.ServerReadableStreamImpl=Hh;var Al=class extends Gy.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Ky.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,Il.getErrorMessage)(i),code:_e.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:_e.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};rn.ServerWritableStreamImpl=Al;var Ao=class extends Gy.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Ky.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};rn.ServerDuplexStreamImpl=Ao;Ao.prototype._read=Hh.prototype._read;Ao.prototype._write=Al.prototype._write;Ao.prototype._final=Al.prototype._final;var jy=class extends Vb.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=_e.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=_e.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;bl("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:_e.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return t==="deflate"?uL(e.subarray(5)):t==="gzip"?cL(e.subarray(5)):t==="identity"?e.subarray(5):Promise.reject({code:_e.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},Ub),gL),t);this.stream.respond(r,mL)}receiveMetadata(e){let t=Ky.Metadata.fromHttp2Headers(e);Gb.isTracerEnabled(Kb)&&bl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(qb);if(r.length>0){let i=r[0].toString().match(fL);if(i===null){let a=new Error("Invalid deadline");return a.code=_e.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*pL[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(yL,s,this),t.remove(qb)}return t.remove(Io.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Io.constants.HTTP2_HEADER_TE),t.remove(Io.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(h){if(s+=h.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:_e.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(h)}function u(h){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),h!==void 0){r({code:_e.Status.INTERNAL,details:h.message});return}if(s===0){r({code:_e.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let d=Buffer.concat(a,s),y=d.readUInt8(0)===1?e:"identity",S=o.getDecompressedMessage(d,y);if(Buffer.isBuffer(S)){t(o.deserializeMessageWithInternalError(S));return}S.then(T=>t(o.deserializeMessageWithInternalError(T)),T=>r(T.code?T:{code:_e.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return g(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Il.getErrorMessage)(t),code:_e.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return g(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:_e.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,Il.getErrorMessage)(s),code:_e.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===_e.Status.OK),!this.checkCancelled())if(bl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+_e.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[Bb]:e.code,[Fb]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[Bb]:e.code,[Fb]:encodeURI(e.details)},Ub),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:_e.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:_e.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new lL.StreamDecoder,i=!1,s=!1,o=!1,a=()=>g(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>g(this,null,function*(){let c=r.write(l);s=!0,this.stream.pause();for(let u of c){if(this.maxReceiveMessageSize!==-1&&u.length>this.maxReceiveMessageSize){this.sendError({code:_e.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${u.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let d=u.readUInt8(0)===1?t:"identity",p=yield this.getDecompressedMessage(u,d);if(!p)return;yield this.pushOrBufferMessage(e,p)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>g(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return g(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return g(this,null,function*(){if(t===null){bl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}bl("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,Il.getErrorCode)(r);(i===null||i<_e.Status.OK||i>_e.Status.UNAUTHENTICATED)&&(i=_e.Status.INTERNAL),e.emit("error",{details:(0,Il.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};rn.Http2ServerCallStream=jy;function yL(n){let e=new Error("Deadline exceeded");e.code=_e.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Wy=w($h=>{"use strict";Object.defineProperty($h,"__esModule",{value:!0});$h.ServerCredentials=void 0;var $b=pg(),Rl=class{static createInsecure(){return new Hy}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new $y({ca:e||(0,$b.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:$b.CIPHER_SUITES})}};$h.ServerCredentials=Rl;var Hy=class extends Rl{_isSecure(){return!1}_getSettings(){return null}},$y=class extends Rl{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var Yb=w(Yh=>{"use strict";Object.defineProperty(Yh,"__esModule",{value:!0});Yh.Server=void 0;var ti=le("http2"),fr=oe(),Ki=Hb(),vL=Wy(),Wb=On(),Wh=Ne(),wn=Mn(),SL=qt(),Pt=ji(),Qh=~(1<<31),TL=~(1<<31),wL=2e4,{HTTP2_HEADER_PATH:Qb}=ti.constants,EL="server";function _L(){}function Qy(n){return{code:fr.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function CL(n,e){let t=Qy(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var Yy=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Pt.ChannelzTrace,this.callTracker=new Pt.ChannelzCallTracker,this.listenerChildrenTracker=new Pt.ChannelzChildrenTracker,this.sessionChildrenTracker=new Pt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Pt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:Qh,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:Qh,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:TL,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:wL,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,wn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,wn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let h=o,d=h.getCipher(),p=h.getCertificate(),y=h.getPeerCertificate();c={cipherSuiteStandardName:(t=d.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:d.standardName?null:d.name,localCertificate:p&&"raw"in p?p.raw:null,remoteCertificate:y&&"raw"in y?y.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Wh.trace(fr.LogVerbosity.DEBUG,EL,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=CL(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof vL.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,SL.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,Wb.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(p,y)=>{process.nextTick(()=>r(p,y))},l=()=>{let p;if(t._isSecure()){let y=Object.assign(o,t._getSettings());y.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,p=ti.createSecureServer(y),p.on("secureConnection",S=>{S.on("error",T=>{this.trace("An incoming TLS connection closed with error: "+T.message)})})}else p=ti.createServer(o);return p.setTimeout(0,_L),this._setupHandlers(p),p},c=(p,y,S)=>p.length===0?Promise.resolve({port:y,count:S}):Promise.all(p.map(T=>{this.trace("Attempting to bind "+(0,wn.subchannelAddressToString)(T));let D;(0,wn.isTcpSubchannelAddress)(T)?D={host:T.host,port:y}:D=T;let E=l();return new Promise((k,N)=>{let q=K=>{this.trace("Failed to bind "+(0,wn.subchannelAddressToString)(T)+" with error "+K.message),k(K)};E.once("error",q),E.listen(D,()=>{if(this.shutdown){E.close(),k(new Error("bindAsync failed because server is shutdown"));return}let K=E.address(),X;typeof K=="string"?X={path:K}:X={host:K.address,port:K.port};let He=(0,Pt.registerChannelzSocket)((0,wn.subchannelAddressToString)(X),()=>({localAddress:X,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(He),this.http2ServerList.push({server:E,channelzRef:He}),this.trace("Successfully bound "+(0,wn.subchannelAddressToString)(X)),k("port"in X?X.port:y),E.removeListener("error",q)})})})).then(T=>{let D=0;for(let E of T)if(typeof E=="number"&&(D+=1,E!==y))throw new Error("Invalid state: multiple port numbers added from single address");return{port:y,count:D+S}}),u=p=>{if(p.length===0)return Promise.resolve({port:0,count:0});let y=p[0],S=l();return new Promise((T,D)=>{let E=k=>{this.trace("Failed to bind "+(0,wn.subchannelAddressToString)(y)+" with error "+k.message),T(u(p.slice(1)))};S.once("error",E),S.listen(y,()=>{if(this.shutdown){S.close(),T({port:0,count:0});return}let k=S.address(),N={host:k.address,port:k.port},q=(0,Pt.registerChannelzSocket)((0,wn.subchannelAddressToString)(N),()=>({localAddress:N,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(q),this.http2ServerList.push({server:S,channelzRef:q}),this.trace("Successfully bound "+(0,wn.subchannelAddressToString)(N)),T(c(p.slice(1),k.port,1)),S.removeListener("error",E)})})},h={onSuccessfulResolution:(p,y,S)=>{if(h.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),p.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let T;(0,wn.isTcpSubchannelAddress)(p[0])?p[0].port===0?T=u(p):T=c(p,p[0].port,0):T=c(p,1,0),T.then(D=>{if(D.count===0){let E=`No address added out of total ${p.length} resolved`;Wh.log(fr.LogVerbosity.ERROR,E),a(new Error(E),0)}else D.count<p.length&&Wh.log(fr.LogVerbosity.INFO,`WARNING Only ${D.count} addresses added out of total ${p.length} resolved`),a(null,D.port)},D=>{let E=`No address added out of total ${p.length} resolved`;Wh.log(fr.LogVerbosity.ERROR,E),a(new Error(E),0)})},onError:p=>{a(new Error(p.details),0)}};(0,Wb.createResolver)(s,h,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Pt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(ti.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Pt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Pt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Pt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[ti.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[ti.constants.HTTP2_HEADER_STATUS]:ti.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new Ki.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=fr.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[Qb],s=this._retrieveHandler(i);if(!s){this._respondWithError(Qy(i),e,r);return}let o=new Ki.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===fr.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:fr.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[Qb],i=this._retrieveHandler(r);if(!i){this._respondWithError(Qy(r),e,null);return}let s=new Ki.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:fr.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")bL(e,t,s,o);else if(a==="clientStream")IL(e,t,s,o);else if(a==="serverStream")AL(e,t,s,o);else if(a==="bidi")RL(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let h=(0,Pt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),d={ref:h,streamTracker:new Pt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,d);let p=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+p),this.sessionChildrenTracker.refChild(h));let y=null,S=null,T=!1;if(this.maxConnectionAgeMs!==Qh){let E=this.maxConnectionAgeMs/10,k=Math.random()*E*2-E;y=(l=(a=setTimeout(()=>{var N,q;T=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+p);try{s.goaway(ti.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Qh&&(S=(q=(N=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||q===void 0?void 0:q.call(N))},this.maxConnectionAgeMs+k)).unref)===null||l===void 0?void 0:l.call(a)}let D=(u=(c=setInterval(()=>{var E,k;let N=(k=(E=setTimeout(()=>{T=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+p),s.close()},this.keepaliveTimeoutMs)).unref)===null||k===void 0?void 0:k.call(E);try{s.ping((q,K,X)=>{clearTimeout(N)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(T||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+p),this.sessionChildrenTracker.unrefChild(h),(0,Pt.unregisterChannelzRef)(h)),y&&clearTimeout(y),S&&clearTimeout(S),D&&clearTimeout(D),this.sessions.delete(s)})})}};Yh.Server=Yy;function bL(n,e,t,r){return g(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Ki.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function IL(n,e,t,r){let i=new Ki.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function AL(n,e,t,r){return g(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Ki.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function RL(n,e,t,r){let i=new Ki.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var Xb=w(Xh=>{"use strict";Object.defineProperty(Xh,"__esModule",{value:!0});Xh.StatusBuilder=void 0;var Xy=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Xh.StatusBuilder=Xy});var Jy=w(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.isDuration=ni.durationToMs=ni.msToDuration=void 0;function DL(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}ni.msToDuration=DL;function kL(n){return n.seconds*1e3+n.nanos/1e6|0}ni.durationToMs=kL;function NL(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}ni.isDuration=NL});var ov=w(ri=>{"use strict";var Zy;Object.defineProperty(ri,"__esModule",{value:!0});ri.setup=ri.OutlierDetectionLoadBalancer=ri.OutlierDetectionLoadBalancingConfig=void 0;var Zh=Wt(),Zb=oe(),Hi=Jy(),eI=av(),tI=xr(),OL=Nu(),xL=Fr(),Jb=Mn(),ML=Vh(),PL=Ne(),LL="outlier_detection";function Ze(n){PL.trace(Zb.LogVerbosity.DEBUG,LL,n)}var sv="outlier_detection",FL=((Zy=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&Zy!==void 0?Zy:"true")==="true",BL={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},qL={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Ro(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function ev(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,Hi.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Jh(n,e,t){let r=t?`${t}.${e}`:e;if(Ro(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var Dl=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},BL),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},qL),o):null}getLoadBalancerName(){return sv}toJsonObject(){return{interval:(0,Hi.msToDuration)(this.intervalMs),base_ejection_time:(0,Hi.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,Hi.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(ev(e,"interval"),ev(e,"base_ejection_time"),ev(e,"max_ejection_time"),Jh(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Ro(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Jh(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Ro(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Ro(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Jh(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Jh(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Ro(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Ro(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,Hi.durationToMs)(e.interval):null,e.base_ejection_time?(0,Hi.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,Hi.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(tI.validateLoadBalancingConfig))}};ri.OutlierDetectionLoadBalancingConfig=Dl;var nv=class extends ML.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Zh.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Zh.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Zh.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function tv(){return{success:0,failure:0}}var rv=class{constructor(){this.activeBucket=tv(),this.inactiveBucket=tv()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=tv()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},iv=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===xL.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===Zb.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},ed=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new OL.ChildLoadBalancerHandler((0,eI.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,Jb.subchannelAddressToString)(t)),o=new nv(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Zh.ConnectivityState.READY?e.updateState(t,new iv(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;Ze("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[h,d]of this.addressMap){let p=d.counter.getLastSuccesses(),y=d.counter.getLastFailures();Ze("Stats for "+h+": successes="+p+" failures="+y+" targetRequestVolume="+r),p+y>=r&&(i+=1,s.push(p/(p+y)))}if(Ze("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((h,d)=>h+d)/s.length,a=0;for(let h of s){let d=h-o;a+=d*d}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);Ze("stdev="+c+" ejectionThreshold="+u);for(let[h,d]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let p=d.counter.getLastSuccesses(),y=d.counter.getLastFailures();if(p+y<r)continue;let S=p/(p+y);if(Ze("Checking candidate "+h+" successRate="+S),S<u){let T=Math.random()*100;Ze("Candidate "+h+" randomNumber="+T+" enforcement_percentage="+t.enforcement_percentage),T<t.enforcement_percentage&&(Ze("Ejecting candidate "+h),this.eject(d,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;Ze("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(Ze("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;Ze("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(Ze("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(Ze("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(Ze("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof Dl))return;let i=new Set;for(let o of e)i.add((0,Jb.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(Ze("Adding map entry for "+o),this.addressMap.set(o,{counter:new rv,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(Ze("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,tI.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){Ze("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else Ze("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{Ze("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return sv}};ri.OutlierDetectionLoadBalancer=ed;function UL(){FL&&(0,eI.registerLoadBalancerType)(sv,ed,Dl)}ri.setup=UL});var av=w($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.OutlierDetectionLoadBalancingConfig=$.BaseSubchannelWrapper=$.registerAdminService=$.FilterStackFactory=$.BaseFilter=$.PickResultType=$.QueuePicker=$.UnavailablePicker=$.ChildLoadBalancerHandler=$.subchannelAddressToString=$.validateLoadBalancingConfig=$.getFirstUsableConfig=$.registerLoadBalancerType=$.createChildChannelControlHelper=$.BackoffTimeout=$.durationToMs=$.uriToString=$.createResolver=$.registerResolver=$.log=$.trace=void 0;var nI=Ne();Object.defineProperty($,"trace",{enumerable:!0,get:function(){return nI.trace}});Object.defineProperty($,"log",{enumerable:!0,get:function(){return nI.log}});var rI=On();Object.defineProperty($,"registerResolver",{enumerable:!0,get:function(){return rI.registerResolver}});Object.defineProperty($,"createResolver",{enumerable:!0,get:function(){return rI.createResolver}});var VL=qt();Object.defineProperty($,"uriToString",{enumerable:!0,get:function(){return VL.uriToString}});var zL=Jy();Object.defineProperty($,"durationToMs",{enumerable:!0,get:function(){return zL.durationToMs}});var jL=Xa();Object.defineProperty($,"BackoffTimeout",{enumerable:!0,get:function(){return jL.BackoffTimeout}});var td=xr();Object.defineProperty($,"createChildChannelControlHelper",{enumerable:!0,get:function(){return td.createChildChannelControlHelper}});Object.defineProperty($,"registerLoadBalancerType",{enumerable:!0,get:function(){return td.registerLoadBalancerType}});Object.defineProperty($,"getFirstUsableConfig",{enumerable:!0,get:function(){return td.getFirstUsableConfig}});Object.defineProperty($,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return td.validateLoadBalancingConfig}});var GL=Mn();Object.defineProperty($,"subchannelAddressToString",{enumerable:!0,get:function(){return GL.subchannelAddressToString}});var KL=Nu();Object.defineProperty($,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return KL.ChildLoadBalancerHandler}});var lv=Fr();Object.defineProperty($,"UnavailablePicker",{enumerable:!0,get:function(){return lv.UnavailablePicker}});Object.defineProperty($,"QueuePicker",{enumerable:!0,get:function(){return lv.QueuePicker}});Object.defineProperty($,"PickResultType",{enumerable:!0,get:function(){return lv.PickResultType}});var HL=Ih();Object.defineProperty($,"BaseFilter",{enumerable:!0,get:function(){return HL.BaseFilter}});var $L=Ty();Object.defineProperty($,"FilterStackFactory",{enumerable:!0,get:function(){return $L.FilterStackFactory}});var WL=xu();Object.defineProperty($,"registerAdminService",{enumerable:!0,get:function(){return WL.registerAdminService}});var QL=Vh();Object.defineProperty($,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return QL.BaseSubchannelWrapper}});var YL=ov();Object.defineProperty($,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return YL.OutlierDetectionLoadBalancingConfig}})});var iI=w(nd=>{"use strict";Object.defineProperty(nd,"__esModule",{value:!0});nd.setup=void 0;var XL=On(),cv=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function JL(){(0,XL.registerResolver)("unix",cv)}nd.setup=JL});var cI=w(sd=>{"use strict";Object.defineProperty(sd,"__esModule",{value:!0});sd.setup=void 0;var sI=le("net"),rd=oe(),uv=bt(),oI=On(),aI=qt(),ZL=Ne(),eF="ip_resolver";function lI(n){ZL.trace(rd.LogVerbosity.DEBUG,eF,n)}var hv="ipv4",dv="ipv6",tF=443,id=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,lI("Resolver constructed for target "+(0,aI.uriToString)(e));let s=[];if(!(e.scheme===hv||e.scheme===dv)){this.error={code:rd.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new uv.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,aI.splitHostPort)(a);if(l===null){this.error={code:rd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new uv.Metadata};return}if(e.scheme===hv&&!(0,sI.isIPv4)(l.host)||e.scheme===dv&&!(0,sI.isIPv6)(l.host)){this.error={code:rd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new uv.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:tF})}this.addresses=s,lI("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function nF(){(0,oI.registerResolver)(hv,id),(0,oI.registerResolver)(dv,id)}sd.setup=nF});var dI=w($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.setup=$n.PickFirstLoadBalancer=$n.shuffled=$n.PickFirstLoadBalancingConfig=void 0;var uI=xr(),gt=Wt(),od=Fr(),rF=Ne(),iF=oe(),sF="pick_first";function fv(n){rF.trace(iF.LogVerbosity.DEBUG,sF,n)}var kl="pick_first",oF=250,Nl=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return kl}toJsonObject(){return{[kl]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};$n.PickFirstLoadBalancingConfig=Nl;var pv=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:od.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function hI(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}$n.shuffled=hI;var ad=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=gt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(gt.ConnectivityState.READY,new pv(this.currentPick)):this.children.length===0?this.updateState(gt.ConnectivityState.IDLE,new od.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(gt.ConnectivityState.TRANSIENT_FAILURE,new od.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(gt.ConnectivityState.CONNECTING,new od.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==gt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===gt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===gt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===gt.ConnectivityState.IDLE||i===gt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===gt.ConnectivityState.IDLE&&(fv("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},oF)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(fv("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){fv(gt.ConnectivityState[this.currentState]+" -> "+gt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===gt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===gt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Nl&&(t.getShuffleAddressList()&&(e=hI(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===gt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return kl}};$n.PickFirstLoadBalancer=ad;function aF(){(0,uI.registerLoadBalancerType)(kl,ad,Nl),(0,uI.registerDefaultLoadBalancerType)(kl)}$n.setup=aF});var pI=w(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});Do.setup=Do.RoundRobinLoadBalancer=void 0;var lF=xr(),mt=Wt(),ld=Fr(),cF=Mn(),uF=Ne(),hF=oe(),dF="round_robin";function fI(n){uF.trace(hF.LogVerbosity.DEBUG,dF,n)}var cd="round_robin",gv=class n{getLoadBalancerName(){return cd}constructor(){}toJsonObject(){return{[cd]:{}}}static createFromJson(e){return new n}},mv=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:ld.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},ud=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=mt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===mt.ConnectivityState.TRANSIENT_FAILURE||i===mt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(mt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===mt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(mt.ConnectivityState.READY,new mv(e,t))}else this.countSubchannelsWithState(mt.ConnectivityState.CONNECTING)>0?this.updateState(mt.ConnectivityState.CONNECTING,new ld.QueuePicker(this)):this.countSubchannelsWithState(mt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(mt.ConnectivityState.TRANSIENT_FAILURE,new ld.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(mt.ConnectivityState.IDLE,new ld.QueuePicker(this))}updateState(e,t){fI(mt.ConnectivityState[this.currentState]+" -> "+mt.ConnectivityState[e]),e===mt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),fI("Connect to address list "+e.map(r=>(0,cF.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===mt.ConnectivityState.IDLE||i===mt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return cd}};Do.RoundRobinLoadBalancer=ud;function fF(){(0,lF.registerLoadBalancerType)(cd,ud,gv)}Do.setup=fF});var vI=w(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.experimental=B.addAdminServicesToServer=B.getChannelzHandlers=B.getChannelzServiceDefinition=B.InterceptorConfigurationError=B.InterceptingCall=B.RequesterBuilder=B.ListenerBuilder=B.StatusBuilder=B.getClientChannel=B.ServerCredentials=B.Server=B.setLogVerbosity=B.setLogger=B.load=B.loadObject=B.CallCredentials=B.ChannelCredentials=B.waitForClientReady=B.closeClient=B.Channel=B.makeGenericClientConstructor=B.makeClientConstructor=B.loadPackageDefinition=B.Client=B.compressionAlgorithms=B.propagate=B.connectivityState=B.status=B.logVerbosity=B.Metadata=B.credentials=void 0;var hd=dg();Object.defineProperty(B,"CallCredentials",{enumerable:!0,get:function(){return hd.CallCredentials}});var pF=Gg();Object.defineProperty(B,"Channel",{enumerable:!0,get:function(){return pF.ChannelImplementation}});var gF=wy();Object.defineProperty(B,"compressionAlgorithms",{enumerable:!0,get:function(){return gF.CompressionAlgorithms}});var mF=Wt();Object.defineProperty(B,"connectivityState",{enumerable:!0,get:function(){return mF.ConnectivityState}});var dd=Cu();Object.defineProperty(B,"ChannelCredentials",{enumerable:!0,get:function(){return dd.ChannelCredentials}});var gI=jg();Object.defineProperty(B,"Client",{enumerable:!0,get:function(){return gI.Client}});var yv=oe();Object.defineProperty(B,"logVerbosity",{enumerable:!0,get:function(){return yv.LogVerbosity}});Object.defineProperty(B,"status",{enumerable:!0,get:function(){return yv.Status}});Object.defineProperty(B,"propagate",{enumerable:!0,get:function(){return yv.Propagate}});var mI=Ne(),vv=Hg();Object.defineProperty(B,"loadPackageDefinition",{enumerable:!0,get:function(){return vv.loadPackageDefinition}});Object.defineProperty(B,"makeClientConstructor",{enumerable:!0,get:function(){return vv.makeClientConstructor}});Object.defineProperty(B,"makeGenericClientConstructor",{enumerable:!0,get:function(){return vv.makeClientConstructor}});var yF=bt();Object.defineProperty(B,"Metadata",{enumerable:!0,get:function(){return yF.Metadata}});var vF=Yb();Object.defineProperty(B,"Server",{enumerable:!0,get:function(){return vF.Server}});var SF=Wy();Object.defineProperty(B,"ServerCredentials",{enumerable:!0,get:function(){return SF.ServerCredentials}});var TF=Xb();Object.defineProperty(B,"StatusBuilder",{enumerable:!0,get:function(){return TF.StatusBuilder}});B.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:dd.ChannelCredentials.createInsecure,createSsl:dd.ChannelCredentials.createSsl,createFromSecureContext:dd.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:hd.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:hd.CallCredentials.createFromGoogleCredential,createEmpty:hd.CallCredentials.createEmpty};var wF=n=>n.close();B.closeClient=wF;var EF=(n,e,t)=>n.waitForReady(e,t);B.waitForClientReady=EF;var _F=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};B.loadObject=_F;var CF=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};B.load=CF;var bF=n=>{mI.setLogger(n)};B.setLogger=bF;var IF=n=>{mI.setLoggerVerbosity(n)};B.setLogVerbosity=IF;var AF=n=>gI.Client.prototype.getChannel.call(n);B.getClientChannel=AF;var fd=Ug();Object.defineProperty(B,"ListenerBuilder",{enumerable:!0,get:function(){return fd.ListenerBuilder}});Object.defineProperty(B,"RequesterBuilder",{enumerable:!0,get:function(){return fd.RequesterBuilder}});Object.defineProperty(B,"InterceptingCall",{enumerable:!0,get:function(){return fd.InterceptingCall}});Object.defineProperty(B,"InterceptorConfigurationError",{enumerable:!0,get:function(){return fd.InterceptorConfigurationError}});var yI=ji();Object.defineProperty(B,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return yI.getChannelzServiceDefinition}});Object.defineProperty(B,"getChannelzHandlers",{enumerable:!0,get:function(){return yI.getChannelzHandlers}});var RF=xu();Object.defineProperty(B,"addAdminServicesToServer",{enumerable:!0,get:function(){return RF.addAdminServicesToServer}});var DF=av();B.experimental=DF;var kF=ly(),NF=iI(),OF=cI(),xF=dI(),MF=pI(),PF=ov(),LF=ji();kF.setup(),NF.setup(),OF.setup(),xF.setup(),MF.setup(),PF.setup(),LF.setup()});var BD=[],hw=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=un({type:e}),e.\u0275inj=cn({imports:[$f.forRoot(BD),$f]});let n=e;return n})();var qD="firebase",UD="10.10.0";Ar(qD,UD,"app");var xs=new XT("ANGULARFIRE2_VERSION");var VD=(n,e)=>{let t=e?[e]:uw(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Ni=class{constructor(){return VD(zD)}},zD="app-check";function Xf(){}var qc=class{zone;delegate;constructor(e,t=PT){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Jf=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Xf,{},Xf,Xf)),t.pipe(qT({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Uc=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new qc(Zone.current)),this.insideAngular=t.run(()=>new qc(Zone.current,kc)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(ee(Ir))};static \u0275prov=Rs({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function jD(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Ot(n){return GD(jD())(n)}function GD(n){return function(t){return t=t.lift(new Jf(n.ngZone)),t.pipe(As(n.outsideAngular),Ai(n.insideAngular))}}var $D=new Map,WD={activated:!1,tokenObservers:[]},QD={initialized:!1,enabled:!1};function hn(n){return $D.get(n)||Object.assign({},WD)}function yw(){return QD}var YD="https://content-firebaseappcheck.googleapis.com/v1";var XD="exchangeDebugToken",fw={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},sV=24*60*60*1e3;var ep=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return g(this,null,function*(){this.stop();try{this.pending=new Wf,this.pending.promise.catch(t=>{}),yield JD(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Wf,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function JD(n){return new Promise(e=>{setTimeout(e,n)})}var ZD={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Rr=new lw("appCheck","AppCheck",ZD);function vw(n){if(!hn(n).activated)throw Rr.create("use-before-activation",{appName:n.name})}function Sw(r,i){return g(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(s["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(p){throw Rr.create("fetch-network-error",{originalErrorMessage:p?.message})}if(l.status!==200)throw Rr.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(p){throw Rr.create("fetch-parse-error",{originalErrorMessage:p?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Rr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(u[1])*1e3,d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function Tw(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${YD}/projects/${t}/apps/${r}:${XD}?key=${i}`,body:{debug_token:e}}}var ek="firebase-app-check-database",tk=1,tp="firebase-app-check-store";var Vc=null;function nk(){return Vc||(Vc=new Promise((n,e)=>{try{let t=indexedDB.open(ek,tk);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Rr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(tp,{keyPath:"compositeKey"})}}}catch(t){e(Rr.create("storage-open",{originalErrorMessage:t?.message}))}}),Vc)}function rk(n,e){return ik(sk(n),e)}function ik(n,e){return g(this,null,function*(){let r=(yield nk()).transaction(tp,"readwrite"),s=r.objectStore(tp).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(Rr.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function sk(n){return`${n.options.appId}-${n.name}`}var np=new Bc("@firebase/app-check");function Zf(n,e){return Fc()?rk(n,e).catch(t=>{np.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function ww(){return yw().enabled}function Ew(){return g(this,null,function*(){let n=yw();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var ok={error:"UNKNOWN_ERROR"};function ak(n){return sw.encodeString(JSON.stringify(n),!1)}function rp(n,e=!1){return g(this,null,function*(){let t=n.app;vw(t);let r=hn(t),i=r.token,s;if(i&&!Aa(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(Aa(l)?i=l:yield Zf(t,void 0))}if(!e&&i&&Aa(i))return{token:i.token};let o=!1;if(ww()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Sw(Tw(t,yield Ew()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield Zf(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield hn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?np.warn(l.message):np.error(l),s=l}let a;return i?s?Aa(i)?a={token:i.token,internalError:s}:a=gw(s):(a={token:i.token},r.token=i,yield Zf(t,i)):a=gw(s),o&&hk(t,a),a})}function lk(n){return g(this,null,function*(){let e=n.app;vw(e);let{provider:t}=hn(e);if(ww()){let r=yield Ew(),{token:i}=yield Sw(Tw(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function ck(n,e,t,r){let{app:i}=n,s=hn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Aa(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),pw(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>pw(n))}function _w(n,e){let t=hn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function pw(n){let{app:e}=n,t=hn(e),r=t.tokenRefresher;r||(r=uk(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function uk(n){let{app:e}=n;return new ep(()=>g(this,null,function*(){let t=hn(e),r;if(t.token?r=yield rp(n,!0):r=yield rp(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=hn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},fw.RETRIAL_MIN_WAIT,fw.RETRIAL_MAX_WAIT)}function hk(n,e){let t=hn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Aa(n){return n.expireTimeMillis-Date.now()>0}function gw(n){return{token:ak(ok),error:n}}var ip=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=hn(this.app);for(let t of e)_w(this.app,t.next);return Promise.resolve()}};function dk(n,e){return new ip(n,e)}function fk(n){return{getToken:e=>rp(n,e),getLimitedUseToken:()=>lk(n),addTokenListener:e=>ck(n,"INTERNAL",e),removeTokenListener:e=>_w(n.app,e)}}var pk="@firebase/app-check",gk="0.8.3";var mk="app-check",mw="app-check-internal";function yk(){Ia(new Di(mk,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return dk(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(mw).initialize()})),Ia(new Di(mw,n=>{let e=n.getProvider("app-check").getImmediate();return fk(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Ar(pk,gk)}yk();var vk=["localhost","0.0.0.0","127.0.0.1"],yV=typeof window<"u"&&vk.includes(window.location.hostname);var Sk="firebase",Tk="10.10.0";Nt.registerVersion(Sk,Tk,"app-compat");var wk=["ngOnDestroy"],Iw=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(wk.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let h=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,h),h})})})});var zc=class{constructor(e){return e}},Ms=new wt("angularfire2.app.options"),Ps=new wt("angularfire2.app.name");function Ra(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Nt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Nt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;Ek("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new zc(o)}var Ek=(n,...e)=>{Hf()&&typeof console<"u"&&console[n](...e)},_k={provide:zc,useFactory:Ra,deps:[Ms,Ir,[new UT,Ps]]},Aw=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Ms,useValue:t},{provide:Ps,useValue:r}]}}constructor(t){Nt.registerVersion("angularfire",xs.full,"core"),Nt.registerVersion("angularfire",xs.full,"app-compat"),Nt.registerVersion("angular",JT.full,t.toString())}static \u0275fac=function(r){return new(r||n)(ee(ks))};static \u0275mod=un({type:n});static \u0275inj=cn({providers:[_k]})}return n})();function jc(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return Ck(i,o)||(bw("error",`${e} was already initialized on the ${t} Firebase App with different settings.${bk?" You may need to reload as Firebase is not HMR aware.":""}`),bw("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function Ck(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var bk=typeof module<"u"&&!!module.hot,bw=(n,...e)=>{Hf()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var sp=new wt("angularfire2.auth.use-emulator"),op=new wt("angularfire2.auth.settings"),ap=new wt("angularfire2.auth.tenant-id"),lp=new wt("angularfire2.auth.langugage-code"),cp=new wt("angularfire2.auth.use-device-language"),up=new wt("angularfire.auth.persistence"),hp=(n,e,t,r,i,s,o,a)=>jc(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),Rw=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,h,d,p){let y=new MT,S=br(void 0).pipe(Ai(o.outsideAngular),Ri(()=>s.runOutsideAngular(()=>import("./chunk-MQ25CVIS.mjs"))),Tt(()=>Ra(t,s,r)),Tt(T=>hp(T,s,a,c,u,h,l,d)),jf({bufferSize:1,refCount:!1}));if(Lc(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=br(null);else{S.pipe(BT()).subscribe();let T=S.pipe(Ri(k=>k.getRedirectResult().then(N=>N,()=>null)),Ot,jf({bufferSize:1,refCount:!1})),D=S.pipe(Ri(k=>new Is(N=>({unsubscribe:s.runOutsideAngular(()=>k.onAuthStateChanged(q=>N.next(q),q=>N.error(q),()=>N.complete()))})))),E=S.pipe(Ri(k=>new Is(N=>({unsubscribe:s.runOutsideAngular(()=>k.onIdTokenChanged(q=>N.next(q),q=>N.error(q),()=>N.complete()))}))));this.authState=T.pipe(Gf(D),As(o.outsideAngular),Ai(o.insideAngular)),this.user=T.pipe(Gf(E),As(o.outsideAngular),Ai(o.insideAngular)),this.idToken=this.user.pipe(Ri(k=>k?Cr(k.getIdToken()):br(null))),this.idTokenResult=this.user.pipe(Ri(k=>k?Cr(k.getIdTokenResult()):br(null))),this.credential=LT(T,y,this.authState.pipe(_a(k=>!k))).pipe(Tt(k=>k?.user?k:null),As(o.outsideAngular),Ai(o.insideAngular))}return Iw(this,S,s,{spy:{apply:(T,D,E)=>{(T.startsWith("signIn")||T.startsWith("createUser"))&&E.then(k=>y.next(k))}}})}static \u0275fac=function(r){return new(r||n)(ee(Ms),ee(Ps,8),ee(ks),ee(Ir),ee(Uc),ee(sp,8),ee(op,8),ee(ap,8),ee(lp,8),ee(cp,8),ee(up,8),ee(Ni,8))};static \u0275prov=Rs({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();import{inspect as FF,TextEncoder as BF,TextDecoder as qF}from"util";import{randomBytes as UF}from"crypto";var Ak=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fn={},P,xp=xp||{},H=Ak||self;function ru(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function za(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function Rk(n){return Object.prototype.hasOwnProperty.call(n,dp)&&n[dp]||(n[dp]=++Dk)}var dp="closure_uid_"+(1e9*Math.random()>>>0),Dk=0;function kk(n,e,t){return n.call.apply(n.bind,arguments)}function Nk(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function ut(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?ut=kk:ut=Nk,ut.apply(null,arguments)}function Gc(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Ye(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Dr(){this.s=this.s,this.o=this.o}var Ok=0;Dr.prototype.s=!1;Dr.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),Ok!=0)&&Rk(this)};Dr.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Vw=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Mp(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Dw(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(ru(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function ht(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ht.prototype.h=function(){this.defaultPrevented=!0};var xk=function(){if(!H.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};H.addEventListener("test",t,e),H.removeEventListener("test",t,e)}catch{}return n}();function Ma(n){return/^[\s\xa0]*$/.test(n)}function iu(){var n=H.navigator;return n&&(n=n.userAgent)?n:""}function Dn(n){return iu().indexOf(n)!=-1}function Pp(n){return Pp[" "](n),n}Pp[" "]=function(){};function Mk(n,e){var t=EN;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var Pk=Dn("Opera"),qs=Dn("Trident")||Dn("MSIE"),zw=Dn("Edge"),yp=zw||qs,jw=Dn("Gecko")&&!(iu().toLowerCase().indexOf("webkit")!=-1&&!Dn("Edge"))&&!(Dn("Trident")||Dn("MSIE"))&&!Dn("Edge"),Lk=iu().toLowerCase().indexOf("webkit")!=-1&&!Dn("Edge");function Gw(){var n=H.document;return n?n.documentMode:void 0}var vp;e:{if(Kc="",Hc=function(){var n=iu();if(jw)return/rv:([^\);]+)(\)|;)/.exec(n);if(zw)return/Edge\/([\d\.]+)/.exec(n);if(qs)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(Lk)return/WebKit\/(\S+)/.exec(n);if(Pk)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Hc&&(Kc=Hc?Hc[1]:""),qs&&($c=Gw(),$c!=null&&$c>parseFloat(Kc))){vp=String($c);break e}vp=Kc}var Kc,Hc,$c,Sp;H.document&&qs?(fp=Gw(),Sp=fp||parseInt(vp,10)||void 0):Sp=void 0;var fp,Fk=Sp;function Pa(n,e){if(ht.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(jw){e:{try{Pp(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:Bk[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Pa.$.h.call(this)}}Ye(Pa,ht);var Bk={2:"touch",3:"pen",4:"mouse"};Pa.prototype.h=function(){Pa.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var ja="closure_listenable_"+(1e6*Math.random()|0),qk=0;function Uk(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++qk,this.fa=this.ia=!1}function su(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Lp(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function Vk(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function Kw(n){let e={};for(let t in n)e[t]=n[t];return e}var kw="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Hw(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<kw.length;s++)t=kw[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function ou(n){this.src=n,this.g={},this.h=0}ou.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=wp(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new Uk(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function Tp(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=Vw(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(su(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function wp(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var Fp="closure_lm_"+(1e6*Math.random()|0),pp={};function $w(n,e,t,r,i){if(r&&r.once)return Qw(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)$w(n,e[s],t,r,i);return null}return t=Up(t),n&&n[ja]?n.O(e,t,za(r)?!!r.capture:!!r,i):Ww(n,e,t,!1,r,i)}function Ww(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=za(i)?!!i.capture:!!i,a=qp(n);if(a||(n[Fp]=a=new ou(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=zk(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)xk||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Xw(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function zk(){function n(t){return e.call(n.src,n.listener,t)}let e=jk;return n}function Qw(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Qw(n,e[s],t,r,i);return null}return t=Up(t),n&&n[ja]?n.P(e,t,za(r)?!!r.capture:!!r,i):Ww(n,e,t,!0,r,i)}function Yw(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Yw(n,e[s],t,r,i);else r=za(r)?!!r.capture:!!r,t=Up(t),n&&n[ja]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=wp(s,t,r,i),-1<t&&(su(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=qp(n))&&(e=n.g[e.toString()],n=-1,e&&(n=wp(e,t,r,i)),(t=-1<n?e[n]:null)&&Bp(t))}function Bp(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[ja])Tp(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Xw(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=qp(e))?(Tp(t,n),t.h==0&&(t.src=null,e[Fp]=null)):su(n)}}}function Xw(n){return n in pp?pp[n]:pp[n]="on"+n}function jk(n,e){if(n.fa)n=!0;else{e=new Pa(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Bp(n),n=t.call(r,e)}return n}function qp(n){return n=n[Fp],n instanceof ou?n:null}var gp="__closure_events_fn_"+(1e9*Math.random()>>>0);function Up(n){return typeof n=="function"?n:(n[gp]||(n[gp]=function(e){return n.handleEvent(e)}),n[gp])}function Qe(){Dr.call(this),this.i=new ou(this),this.S=this,this.J=null}Ye(Qe,Dr);Qe.prototype[ja]=!0;Qe.prototype.removeEventListener=function(n,e,t,r){Yw(this,n,e,t,r)};function st(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new ht(e,n);else if(e instanceof ht)e.target=e.target||n;else{var i=e;e=new ht(r,n),Hw(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=Wc(o,r,!0,e)&&i}if(o=e.g=n,i=Wc(o,r,!0,e)&&i,i=Wc(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=Wc(o,r,!1,e)&&i}Qe.prototype.N=function(){if(Qe.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)su(t[r]);delete n.g[e],n.h--}}this.J=null};Qe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};Qe.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function Wc(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,l=o.la||o.src;o.ia&&Tp(n.i,o),i=a.call(l,r)!==!1&&i}}return i&&!r.defaultPrevented}var Vp=H.JSON.stringify,Ep=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function Gk(){var n=zp;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var _p=class{constructor(){this.h=this.g=null}add(e,t){let r=Jw.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Jw=new Ep(()=>new Cp,n=>n.reset()),Cp=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function Kk(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Hk(n){H.setTimeout(()=>{throw n},0)}var La,Fa=!1,zp=new _p,Zw=()=>{let n=H.Promise.resolve(void 0);La=()=>{n.then($k)}},$k=()=>{for(var n;n=Gk();){try{n.h.call(n.g)}catch(t){Hk(t)}var e=Jw;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Fa=!1};function au(n,e){Qe.call(this),this.h=n||1,this.g=e||H,this.j=ut(this.qb,this),this.l=Date.now()}Ye(au,Qe);P=au.prototype;P.ga=!1;P.T=null;P.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),st(this,"tick"),this.ga&&(jp(this),this.start()))}};P.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function jp(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}P.N=function(){au.$.N.call(this),jp(this),delete this.g};function Gp(n,e,t){if(typeof n=="function")t&&(n=ut(n,t));else if(n&&typeof n.handleEvent=="function")n=ut(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:H.setTimeout(n,e||0)}function eE(n){n.g=Gp(()=>{n.g=null,n.i&&(n.i=!1,eE(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var bp=class extends Dr{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:eE(this)}N(){super.N(),this.g&&(H.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Ba(n){Dr.call(this),this.h=n,this.g={}}Ye(Ba,Dr);var Nw=[];function tE(n,e,t,r){Array.isArray(t)||(t&&(Nw[0]=t.toString()),t=Nw);for(var i=0;i<t.length;i++){var s=$w(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function nE(n){Lp(n.g,function(e,t){this.g.hasOwnProperty(t)&&Bp(e)},n),n.g={}}Ba.prototype.N=function(){Ba.$.N.call(this),nE(this)};Ba.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function lu(){this.g=!0}lu.prototype.Ea=function(){this.g=!1};function Wk(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function Qk(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function Fs(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+Xk(n,t)+(r?" "+r:"")})}function Yk(n,e){n.info(function(){return"TIMEOUT: "+e})}lu.prototype.info=function(){};function Xk(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Vp(t)}catch{return e}}var Pi={},Ow=null;function cu(){return Ow=Ow||new Qe}Pi.Ta="serverreachability";function rE(n){ht.call(this,Pi.Ta,n)}Ye(rE,ht);function qa(n){let e=cu();st(e,new rE(e))}Pi.STAT_EVENT="statevent";function iE(n,e){ht.call(this,Pi.STAT_EVENT,n),this.stat=e}Ye(iE,ht);function _t(n){let e=cu();st(e,new iE(e,n))}Pi.Ua="timingevent";function sE(n,e){ht.call(this,Pi.Ua,n),this.size=e}Ye(sE,ht);function Ga(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return H.setTimeout(function(){n()},e)}var uu={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},oE={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Kp(){}Kp.prototype.h=null;function xw(n){return n.h||(n.h=n.i())}function aE(){}var Ka={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Hp(){ht.call(this,"d")}Ye(Hp,ht);function $p(){ht.call(this,"c")}Ye($p,ht);var Ip;function hu(){}Ye(hu,Kp);hu.prototype.g=function(){return new XMLHttpRequest};hu.prototype.i=function(){return{}};Ip=new hu;function Ha(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Ba(this),this.P=Jk,n=yp?125:void 0,this.V=new au(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new lE}function lE(){this.i=null,this.g="",this.h=!1}var Jk=45e3,cE={},Ap={};P=Ha.prototype;P.setTimeout=function(n){this.P=n};function Rp(n,e,t){n.L=1,n.A=fu(ir(e)),n.u=t,n.S=!0,uE(n,null)}function uE(n,e){n.G=Date.now(),$a(n),n.B=ir(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),vE(t.i,"t",r),n.o=0,t=n.l.J,n.h=new lE,n.g=qE(n.l,t?e:null,!n.u),0<n.O&&(n.M=new bp(ut(n.Pa,n,n.g),n.O)),tE(n.U,n.g,"readystatechange",n.nb),e=n.I?Kw(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),qa(),Wk(n.j,n.v,n.B,n.m,n.W,n.u)}P.nb=function(n){n=n.target;let e=this.M;e&&kn(n)==3?e.l():this.Pa(n)};P.Pa=function(n){try{if(n==this.g)e:{let u=kn(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>u)&&(u!=3||yp||this.g&&(this.h.h||this.g.ja()||Fw(this.g)))){this.J||u!=4||e==7||(e==8||0>=h?qa(3):qa(2)),du(this);var t=this.g.da();this.ca=t;t:if(hE(this)){var r=Fw(this.g);n="";var i=r.length,s=kn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Oi(this),xa(this);var o="";break t}this.h.i=new H.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,Qk(this.j,this.v,this.B,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ma(a)){var c=a;break t}}c=null}if(t=c)Fs(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Dp(this,t);else{this.i=!1,this.s=3,_t(12),Oi(this),xa(this);break e}}this.S?(dE(this,u,o),yp&&this.i&&u==3&&(tE(this.U,this.V,"tick",this.mb),this.V.start())):(Fs(this.j,this.m,o,null),Dp(this,o)),u==4&&Oi(this),this.i&&!this.J&&(u==4?PE(this.l,this):(this.i=!1,$a(this)))}else SN(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,_t(12)):(this.s=0,_t(13)),Oi(this),xa(this)}}}catch{}finally{}};function hE(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function dE(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=Zk(n,t),i==Ap){e==4&&(n.s=4,_t(14),r=!1),Fs(n.j,n.m,null,"[Incomplete Response]");break}else if(i==cE){n.s=4,_t(15),Fs(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else Fs(n.j,n.m,i,null),Dp(n,i);hE(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,_t(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Zp(e),e.M=!0,_t(11))):(Fs(n.j,n.m,t,"[Invalid Chunked Response]"),Oi(n),xa(n))}P.mb=function(){if(this.g){var n=kn(this.g),e=this.g.ja();this.o<e.length&&(du(this),dE(this,n,e),this.i&&n!=4&&$a(this))}};function Zk(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?Ap:(t=Number(e.substring(t,r)),isNaN(t)?cE:(r+=1,r+t>e.length?Ap:(e=e.slice(r,r+t),n.o=r+t,e)))}P.cancel=function(){this.J=!0,Oi(this)};function $a(n){n.Y=Date.now()+n.P,fE(n,n.P)}function fE(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Ga(ut(n.lb,n),e)}function du(n){n.C&&(H.clearTimeout(n.C),n.C=null)}P.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(Yk(this.j,this.B),this.L!=2&&(qa(),_t(17)),Oi(this),this.s=2,xa(this)):fE(this,this.Y-n)};function xa(n){n.l.H==0||n.J||PE(n.l,n)}function Oi(n){du(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,jp(n.V),nE(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Dp(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||kp(t.i,n))){if(!n.K&&kp(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Zc(t),mu(t);else break e;Jp(t),_t(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=Ga(ut(t.ib,t),6e3));if(1>=wE(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else xi(t,11)}else if((n.K||t.g==n)&&Zc(t),!Ma(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let u=c[3];u!=null&&(t.ra=u,t.l.info("VER="+t.ra));let h=c[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let p=n.g;if(p){let y=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var s=r.i;s.g||y.indexOf("spdy")==-1&&y.indexOf("quic")==-1&&y.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Wp(s,s.h),s.h=null))}if(r.F){let S=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.Da=S,Se(r.I,r.F,S))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=BE(r,r.J?r.pa:null,r.Y),o.K){EE(r.i,o);var a=o,l=r.L;l&&a.setTimeout(l),a.C&&(du(a),$a(a)),r.g=o}else xE(r);0<t.j.length&&yu(t)}else c[0]!="stop"&&c[0]!="close"||xi(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?xi(t,7):Xp(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}qa(4)}catch{}}function eN(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(ru(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function tN(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(ru(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function pE(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(ru(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=tN(n),r=eN(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var gE=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function nN(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Mi(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Mi){this.h=n.h,Xc(this,n.j),this.s=n.s,this.g=n.g,Jc(this,n.m),this.l=n.l;var e=n.i,t=new Ua;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Mw(this,t),this.o=n.o}else n&&(e=String(n).match(gE))?(this.h=!1,Xc(this,e[1]||"",!0),this.s=Na(e[2]||""),this.g=Na(e[3]||"",!0),Jc(this,e[4]),this.l=Na(e[5]||"",!0),Mw(this,e[6]||"",!0),this.o=Na(e[7]||"")):(this.h=!1,this.i=new Ua(null,this.h))}Mi.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Oa(e,Pw,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Oa(e,Pw,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Oa(t,t.charAt(0)=="/"?sN:iN,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Oa(t,aN)),n.join("")};function ir(n){return new Mi(n)}function Xc(n,e,t){n.j=t?Na(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Jc(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Mw(n,e,t){e instanceof Ua?(n.i=e,lN(n.i,n.h)):(t||(e=Oa(e,oN)),n.i=new Ua(e,n.h))}function Se(n,e,t){n.i.set(e,t)}function fu(n){return Se(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Na(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Oa(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,rN),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function rN(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Pw=/[#\/\?@]/g,iN=/[#\?:]/g,sN=/[#\?]/g,oN=/[#\?@]/g,aN=/#/g;function Ua(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function kr(n){n.g||(n.g=new Map,n.h=0,n.i&&nN(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}P=Ua.prototype;P.add=function(n,e){kr(this),this.i=null,n=Us(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function mE(n,e){kr(n),e=Us(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function yE(n,e){return kr(n),e=Us(n,e),n.g.has(e)}P.forEach=function(n,e){kr(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};P.ta=function(){kr(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};P.Z=function(n){kr(this);let e=[];if(typeof n=="string")yE(this,n)&&(e=e.concat(this.g.get(Us(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};P.set=function(n,e){return kr(this),this.i=null,n=Us(this,n),yE(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};P.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function vE(n,e,t){mE(n,e),0<t.length&&(n.i=null,n.g.set(Us(n,e),Mp(t)),n.h+=t.length)}P.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function Us(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function lN(n,e){e&&!n.j&&(kr(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(mE(this,r),vE(this,i,t))},n)),n.j=e}var cN=class{constructor(n,e){this.g=n,this.map=e}};function SE(n){this.l=n||uN,H.PerformanceNavigationTiming?(n=H.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(H.g&&H.g.Ka&&H.g.Ka()&&H.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var uN=10;function TE(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function wE(n){return n.h?1:n.g?n.g.size:0}function kp(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Wp(n,e){n.g?n.g.add(e):n.h=e}function EE(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}SE.prototype.cancel=function(){if(this.i=_E(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function _E(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return Mp(n.i)}var hN=class{stringify(n){return H.JSON.stringify(n,void 0)}parse(n){return H.JSON.parse(n,void 0)}};function dN(){this.g=new hN}function fN(n,e,t){let r=t||"";try{pE(n,function(i,s){let o=i;za(i)&&(o=Vp(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function pN(n,e){let t=new lu;if(H.Image){let r=new Image;r.onload=Gc(Qc,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Gc(Qc,t,r,"TestLoadImage: error",!1,e),r.onabort=Gc(Qc,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Gc(Qc,t,r,"TestLoadImage: timeout",!1,e),H.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function Qc(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Wa(n){this.l=n.ec||null,this.j=n.ob||!1}Ye(Wa,Kp);Wa.prototype.g=function(){return new pu(this.l,this.j)};Wa.prototype.i=function(n){return function(){return n}}({});function pu(n,e){Qe.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Qp,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ye(pu,Qe);var Qp=0;P=pu.prototype;P.open=function(n,e){if(this.readyState!=Qp)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Va(this)};P.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||H).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};P.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Qa(this)),this.readyState=Qp};P.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Va(this)),this.g&&(this.readyState=3,Va(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof H.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;CE(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function CE(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}P.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Qa(this):Va(this),this.readyState==3&&CE(this)}};P.Za=function(n){this.g&&(this.response=this.responseText=n,Qa(this))};P.Ya=function(n){this.g&&(this.response=n,Qa(this))};P.ka=function(){this.g&&Qa(this)};function Qa(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Va(n)}P.setRequestHeader=function(n,e){this.v.append(n,e)};P.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};P.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Va(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(pu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var gN=H.JSON.parse;function ke(n){Qe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=bE,this.L=this.M=!1}Ye(ke,Qe);var bE="",mN=/^https?$/i,yN=["POST","PUT"];P=ke.prototype;P.Oa=function(n){this.M=n};P.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Ip.g(),this.C=this.u?xw(this.u):xw(Ip),this.g.onreadystatechange=ut(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){Lw(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=H.FormData&&n instanceof H.FormData,!(0<=Vw(yN,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{RE(this),0<this.B&&((this.L=vN(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ut(this.ua,this)):this.A=Gp(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Lw(this,s)}};function vN(n){return qs&&typeof n.timeout=="number"&&n.ontimeout!==void 0}P.ua=function(){typeof xp<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,st(this,"timeout"),this.abort(8))};function Lw(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,IE(n),gu(n)}function IE(n){n.F||(n.F=!0,st(n,"complete"),st(n,"error"))}P.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,st(this,"complete"),st(this,"abort"),gu(this))};P.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),gu(this,!0)),ke.$.N.call(this)};P.La=function(){this.s||(this.G||this.v||this.l?AE(this):this.kb())};P.kb=function(){AE(this)};function AE(n){if(n.h&&typeof xp<"u"&&(!n.C[1]||kn(n)!=4||n.da()!=2)){if(n.v&&kn(n)==4)Gp(n.La,0,n);else if(st(n,"readystatechange"),kn(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(gE)[1]||null;!i&&H.self&&H.self.location&&(i=H.self.location.protocol.slice(0,-1)),r=!mN.test(i?i.toLowerCase():"")}t=r}if(t)st(n,"complete"),st(n,"success");else{n.m=6;try{var s=2<kn(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",IE(n)}}finally{gu(n)}}}}function gu(n,e){if(n.g){RE(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||st(n,"ready");try{t.onreadystatechange=r}catch{}}}function RE(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(H.clearTimeout(n.A),n.A=null)}P.isActive=function(){return!!this.g};function kn(n){return n.g?n.g.readyState:0}P.da=function(){try{return 2<kn(this)?this.g.status:-1}catch{return-1}};P.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};P.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),gN(e)}};function Fw(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case bE:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function SN(n){let e={};n=(n.g&&2<=kn(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Ma(n[r]))continue;var t=Kk(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}Vk(e,function(r){return r.join(", ")})}P.Ia=function(){return this.m};P.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function DE(n){let e="";return Lp(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function Yp(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=DE(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):Se(n,e,t))}function Da(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function kE(n){this.Ga=0,this.j=[],this.l=new lu,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Da("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Da("baseRetryDelayMs",5e3,n),this.hb=Da("retryDelaySeedMs",1e4,n),this.eb=Da("forwardChannelMaxRetries",2,n),this.xa=Da("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new SE(n&&n.concurrentRequestLimit),this.Ja=new dN,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}P=kE.prototype;P.ra=8;P.H=1;function Xp(n){if(NE(n),n.H==3){var e=n.W++,t=ir(n.I);if(Se(t,"SID",n.K),Se(t,"RID",e),Se(t,"TYPE","terminate"),Ya(n,t),e=new Ha(n,n.l,e),e.L=2,e.A=fu(ir(t)),t=!1,H.navigator&&H.navigator.sendBeacon)try{t=H.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&H.Image&&(new Image().src=e.A,t=!0),t||(e.g=qE(e.l,null),e.g.ha(e.A)),e.G=Date.now(),$a(e)}FE(n)}function mu(n){n.g&&(Zp(n),n.g.cancel(),n.g=null)}function NE(n){mu(n),n.u&&(H.clearTimeout(n.u),n.u=null),Zc(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&H.clearTimeout(n.m),n.m=null)}function yu(n){if(!TE(n.i)&&!n.m){n.m=!0;var e=n.Na;La||Zw(),Fa||(La(),Fa=!0),zp.add(e,n),n.C=0}}function TN(n,e){return wE(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Ga(ut(n.Na,n,e),LE(n,n.C)),n.C++,!0)}P.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new Ha(this,this.l,n),s=this.s;if(this.U&&(s?(s=Kw(s),Hw(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=OE(this,i,e),t=ir(this.I),Se(t,"RID",n),Se(t,"CVER",22),this.F&&Se(t,"X-HTTP-Session-Id",this.F),Ya(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(DE(s)))+"&"+e:this.o&&Yp(t,this.o,s)),Wp(this.i,i),this.bb&&Se(t,"TYPE","init"),this.P?(Se(t,"$req",e),Se(t,"SID","null"),i.aa=!0,Rp(i,t,null)):Rp(i,t,e),this.H=2}}else this.H==3&&(n?Bw(this,n):this.j.length==0||TE(this.i)||Bw(this))};function Bw(n,e){var t;e?t=e.m:t=n.W++;let r=ir(n.I);Se(r,"SID",n.K),Se(r,"RID",t),Se(r,"AID",n.V),Ya(n,r),n.o&&n.s&&Yp(r,n.o,n.s),t=new Ha(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=OE(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Wp(n.i,t),Rp(t,r,e)}function Ya(n,e){n.na&&Lp(n.na,function(t,r){Se(e,r,t)}),n.h&&pE({},function(t,r){Se(e,r,t)})}function OE(n,e,t){t=Math.min(n.j.length,t);var r=n.h?ut(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<t;l++){let c=i[l].g,u=i[l].map;if(c-=s,0>c)s=Math.max(0,i[l].g-100),a=!1;else try{fN(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function xE(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;La||Zw(),Fa||(La(),Fa=!0),zp.add(e,n),n.A=0}}function Jp(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Ga(ut(n.Ma,n),LE(n,n.A)),n.A++,!0)}P.Ma=function(){if(this.u=null,ME(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Ga(ut(this.jb,this),n)}};P.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,_t(10),mu(this),ME(this))};function Zp(n){n.B!=null&&(H.clearTimeout(n.B),n.B=null)}function ME(n){n.g=new Ha(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=ir(n.wa);Se(e,"RID","rpc"),Se(e,"SID",n.K),Se(e,"AID",n.V),Se(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Se(e,"TO",n.qa),Se(e,"TYPE","xmlhttp"),Ya(n,e),n.o&&n.s&&Yp(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=fu(ir(e)),t.u=null,t.S=!0,uE(t,n)}P.ib=function(){this.v!=null&&(this.v=null,mu(this),Jp(this),_t(19))};function Zc(n){n.v!=null&&(H.clearTimeout(n.v),n.v=null)}function PE(n,e){var t=null;if(n.g==e){Zc(n),Zp(n),n.g=null;var r=2}else if(kp(n.i,e))t=e.F,EE(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=cu(),st(r,new sE(r,t)),yu(n)}else xE(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&TN(n,e)||r==2&&Jp(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:xi(n,5);break;case 4:xi(n,10);break;case 3:xi(n,6);break;default:xi(n,2)}}}function LE(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function xi(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=ut(n.pb,n);t||(t=new Mi("//www.google.com/images/cleardot.gif"),H.location&&H.location.protocol=="http"||Xc(t,"https"),fu(t)),pN(t.toString(),r)}else _t(2);n.H=0,n.h&&n.h.za(e),FE(n),NE(n)}P.pb=function(n){n?(this.l.info("Successfully pinged google.com"),_t(2)):(this.l.info("Failed to ping google.com"),_t(1))};function FE(n){if(n.H=0,n.ma=[],n.h){let e=_E(n.i);(e.length!=0||n.j.length!=0)&&(Dw(n.ma,e),Dw(n.ma,n.j),n.i.i.length=0,Mp(n.j),n.j.length=0),n.h.ya()}}function BE(n,e,t){var r=t instanceof Mi?ir(t):new Mi(t);if(r.g!="")e&&(r.g=e+"."+r.g),Jc(r,r.m);else{var i=H.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Mi(null);r&&Xc(s,r),e&&(s.g=e),i&&Jc(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&Se(r,t,e),Se(r,"VER",n.ra),Ya(n,r),r}function qE(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new ke(new Wa({ob:t})):new ke(n.va),e.Oa(n.J),e}P.isActive=function(){return!!this.h&&this.h.isActive(this)};function UE(){}P=UE.prototype;P.Ba=function(){};P.Aa=function(){};P.za=function(){};P.ya=function(){};P.isActive=function(){return!0};P.Va=function(){};function eu(){if(qs&&!(10<=Number(Fk)))throw Error("Environmental error: no available transport.")}eu.prototype.g=function(n,e){return new Bt(n,e)};function Bt(n,e){Qe.call(this),this.g=new kE(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Ma(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ma(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new Vs(this)}Ye(Bt,Qe);Bt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;_t(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=BE(n,null,n.Y),yu(n)};Bt.prototype.close=function(){Xp(this.g)};Bt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Vp(n),n=t);e.j.push(new cN(e.fb++,n)),e.H==3&&yu(e)};Bt.prototype.N=function(){this.g.h=null,delete this.j,Xp(this.g),delete this.g,Bt.$.N.call(this)};function VE(n){Hp.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Ye(VE,Hp);function zE(){$p.call(this),this.status=1}Ye(zE,$p);function Vs(n){this.g=n}Ye(Vs,UE);Vs.prototype.Ba=function(){st(this.g,"a")};Vs.prototype.Aa=function(n){st(this.g,new VE(n))};Vs.prototype.za=function(n){st(this.g,new zE)};Vs.prototype.ya=function(){st(this.g,"b")};function wN(){this.blockSize=-1}function dn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Ye(dn,wN);dn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function mp(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}dn.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)mp(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){mp(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){mp(this,r),i=0;break}}this.h=i,this.i+=e};dn.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function ce(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var EN={};function eg(n){return-128<=n&&128>n?Mk(n,function(e){return new ce([e|0],0>e?-1:0)}):new ce([n|0],0>n?-1:0)}function Nn(n){if(isNaN(n)||!isFinite(n))return Bs;if(0>n)return it(Nn(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Np;return new ce(e,0)}function jE(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return it(jE(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Nn(Math.pow(e,8)),r=Bs,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Nn(Math.pow(e,s)),r=r.R(s).add(Nn(o))):(r=r.R(t),r=r.add(Nn(o)))}return r}var Np=4294967296,Bs=eg(0),Op=eg(1),qw=eg(16777216);P=ce.prototype;P.ea=function(){if(Ht(this))return-it(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Np+r)*e,e*=Np}return n};P.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(rr(this))return"0";if(Ht(this))return"-"+it(this).toString(n);for(var e=Nn(Math.pow(n,6)),t=this,r="";;){var i=nu(t,e).g;t=tu(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,rr(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};P.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function rr(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function Ht(n){return n.h==-1}P.X=function(n){return n=tu(this,n),Ht(n)?-1:rr(n)?0:1};function it(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new ce(t,~n.h).add(Op)}P.abs=function(){return Ht(this)?it(this):this};P.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new ce(t,t[t.length-1]&-2147483648?-1:0)};function tu(n,e){return n.add(it(e))}P.R=function(n){if(rr(this)||rr(n))return Bs;if(Ht(this))return Ht(n)?it(this).R(it(n)):it(it(this).R(n));if(Ht(n))return it(this.R(it(n)));if(0>this.X(qw)&&0>n.X(qw))return Nn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,l=n.D(i)&65535;t[2*r+2*i]+=o*l,Yc(t,2*r+2*i),t[2*r+2*i+1]+=s*l,Yc(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,Yc(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,Yc(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new ce(t,0)};function Yc(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function ka(n,e){this.g=n,this.h=e}function nu(n,e){if(rr(e))throw Error("division by zero");if(rr(n))return new ka(Bs,Bs);if(Ht(n))return e=nu(it(n),e),new ka(it(e.g),it(e.h));if(Ht(e))return e=nu(n,it(e)),new ka(it(e.g),e.h);if(30<n.g.length){if(Ht(n)||Ht(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Op,r=e;0>=r.X(n);)t=Uw(t),r=Uw(r);var i=Ls(t,1),s=Ls(r,1);for(r=Ls(r,2),t=Ls(t,2);!rr(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Ls(r,1),t=Ls(t,1)}return e=tu(n,i.R(e)),new ka(i,e)}for(i=Bs;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Nn(t),o=s.R(e);Ht(o)||0<o.X(n);)t-=r,s=Nn(t),o=s.R(e);rr(s)&&(s=Op),i=i.add(s),n=tu(n,o)}return new ka(i,n)}P.gb=function(n){return nu(this,n).h};P.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new ce(t,this.h&n.h)};P.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new ce(t,this.h|n.h)};P.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new ce(t,this.h^n.h)};function Uw(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new ce(t,n.h)}function Ls(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new ce(i,n.h)}eu.prototype.createWebChannel=eu.prototype.g;Bt.prototype.send=Bt.prototype.u;Bt.prototype.open=Bt.prototype.m;Bt.prototype.close=Bt.prototype.close;uu.NO_ERROR=0;uu.TIMEOUT=8;uu.HTTP_ERROR=6;oE.COMPLETE="complete";aE.EventType=Ka;Ka.OPEN="a";Ka.CLOSE="b";Ka.ERROR="c";Ka.MESSAGE="d";Qe.prototype.listen=Qe.prototype.O;ke.prototype.listenOnce=ke.prototype.P;ke.prototype.getLastError=ke.prototype.Sa;ke.prototype.getLastErrorCode=ke.prototype.Ia;ke.prototype.getStatus=ke.prototype.da;ke.prototype.getResponseJson=ke.prototype.Wa;ke.prototype.getResponseText=ke.prototype.ja;ke.prototype.send=ke.prototype.ha;ke.prototype.setWithCredentials=ke.prototype.Oa;dn.prototype.digest=dn.prototype.l;dn.prototype.reset=dn.prototype.reset;dn.prototype.update=dn.prototype.j;ce.prototype.add=ce.prototype.add;ce.prototype.multiply=ce.prototype.R;ce.prototype.modulo=ce.prototype.gb;ce.prototype.compare=ce.prototype.X;ce.prototype.toNumber=ce.prototype.ea;ce.prototype.toString=ce.prototype.toString;ce.prototype.getBits=ce.prototype.D;ce.fromNumber=Nn;ce.fromString=jE;var zV=fn.createWebChannelTransport=function(){return new eu},jV=fn.getStatEventTarget=function(){return cu()},GV=fn.ErrorCode=uu,KV=fn.EventType=oE,HV=fn.Event=Pi,$V=fn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},WV=fn.FetchXmlHttpFactory=Wa,QV=fn.WebChannel=aE,YV=fn.XhrIo=ke,GE=fn.Md5=dn,Li=fn.Integer=ce;var ns=xT(vI(),1),kA=xT(Qm(),1);var SI="@firebase/firestore",TI="4.5.1";var Ke=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ke.UNAUTHENTICATED=new Ke(null);Ke.GOOGLE_CREDENTIALS=new Ke("google-credentials-uid");Ke.FIRST_PARTY=new Ke("first-party-uid");Ke.MOCK_USER=new Ke("mock-user");var VF="10.10.0";var ca=VF;function zF(n){ca=n}function jF(n){return FF(n,{depth:100})}var hi=new Bc("@firebase/firestore");function Fo(){return hi.logLevel}function NA(n){hi.setLogLevel(n)}function R(n,...e){if(hi.logLevel<=Rn.DEBUG){let t=e.map(AS);hi.debug(`Firestore (${ca}): ${n}`,...t)}}function Ie(n,...e){if(hi.logLevel<=Rn.ERROR){let t=e.map(AS);hi.error(`Firestore (${ca}): ${n}`,...t)}}function on(n,...e){if(hi.logLevel<=Rn.WARN){let t=e.map(AS);hi.warn(`Firestore (${ca}): ${n}`,...t)}}function AS(n){if(typeof n=="string")return n;try{return jF(n)}catch{return n}}function F(n="Unexpected state"){let e=`FIRESTORE (${ca}) INTERNAL ASSERTION FAILED: `+n;throw Ie(e),new Error(e)}function U(n,e){n||F()}function OA(n,e){n||F()}function M(n,e){return n}var v={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},_=class extends aw{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Fe=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Cd=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Rv=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ke.UNAUTHENTICATED))}shutdown(){}},Dv=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},kv=class{constructor(e){this.authProvider=e,this.currentUser=Ke.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new Fe;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new Fe,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>g(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{R("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(R("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Fe)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(R("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(U(typeof r.accessToken=="string"),new Cd(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return U(e===null||typeof e=="string"),new Ke(e)}},Nv=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=Ke.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Ov=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new Nv(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(Ke.FIRST_PARTY))}shutdown(){}invalidateToken(){}},xv=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Mv=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let r=s=>{s.error!=null&&R("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,R("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{R("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):R("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(U(typeof t.token=="string"),this.latestAppCheckToken=t.token,new xv(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function GF(n){if(!n)return new Rv;switch(n.type){case"firstParty":return new Ov(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new _(v.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function KF(n){return UF(n)}var bd=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=KF(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function W(n,e){return n<e?-1:n>e?1:0}function rs(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function xA(n){return n+"\0"}var wI=-62135596800,EI=1e6,Ae=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new _(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new _(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<wI)throw new _(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*EI);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/EI}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-wI,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var j=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Ae(0,0))}static max(){return new n(new Ae(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var _I="__name__",Id=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&F(),r===void 0?r=e.length-t:r>e.length-t&&F(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ne=class n extends Id{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new _(v.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},HF=/^[_a-zA-Z][_a-zA-Z0-9]*$/,qe=class n extends Id{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return HF.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===_I}static keyField(){return new n([_I])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new _(v.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new _(v.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new _(v.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new _(v.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var x=class n{constructor(e){this.path=e}static fromPath(e){return new n(ne.fromString(e))}static fromName(e){return new n(ne.fromString(e).popFirst(5))}static empty(){return new n(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ne.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new ne(e.slice()))}};var Ho=-1,$F=0,Pv=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function RS(n){return n.fields.find(e=>e.kind===2)}function is(n){return n.fields.filter(e=>e.kind!==2)}function WF(n){let e=is(n);return e.length===0?0:e[e.length-1].kind}function QF(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var jo=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Gl=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n($F,an.min())}};function MA(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=j.fromTimestamp(r===1e9?new Ae(t+1,0):new Ae(t,r));return new an(i,x.empty(),e)}function PA(n){return new an(n.readTime,n.key,Ho)}var an=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(j.min(),x.empty(),Ho)}static max(){return new n(j.max(),x.empty(),Ho)}};function DS(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=x.comparator(n.documentKey,e.documentKey),t!==0)?t:W(n.largestBatchId,e.largestBatchId)}var LA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ad=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Ei(n){return g(this,null,function*(){if(n.code===v.FAILED_PRECONDITION&&n.message===LA)R("LocalStore","Unexpectedly lost primary lease");else throw n})}var m=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&F(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var zt="SimpleDb",YF=3,Rd=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new Fe,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new ts(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=kS(r.target.error);this.completionDeferred.reject(new ts(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new ts(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(R(zt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new Fv(t)}},gr=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(ba())===12.2&&Ie("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return R(zt,"Removing database:",e),Wi(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!Fc())return!1;if(n.isMockPersistence())return!0;let e=ba(),t=n.getIOSVersion(e),r=0<t&&t<10,i=n.getAndroidVersion(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static getAndroidVersion(e){let t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return g(this,null,function*(){return this.db||(R(zt,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new ts(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new _(v.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new _(v.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ts(e,o))},i.onupgradeneeded=s=>{R(zt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{R(zt,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return g(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=Rd.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),m.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<YF;if(R(zt,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}},Lv=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return Wi(this.dbCursor.delete())}},ts=class extends _{constructor(e,t){super(v.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function _i(n){return n.name==="IndexedDbTransactionError"}var Fv=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(R(zt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(R(zt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Wi(r)}add(e){R(zt,"ADD",this.store.name,e,e);let t=this.store.add(e);return Wi(t)}get(e){let t=this.store.get(e);return Wi(t).next(r=>(r===void 0&&(r=null),R(zt,"GET",this.store.name,e,r),r))}delete(e){R(zt,"DELETE",this.store.name,e);let t=this.store.delete(e);return Wi(t)}count(){R(zt,"COUNT",this.store.name);let e=this.store.count();return Wi(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new m((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){R(zt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new m((r,i)=>{t.onerror=s=>{let o=kS(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new Lv(a),c=t(a.primaryKey,a.value,l);if(c instanceof m){let u=c.catch(h=>(l.done(),m.reject(h)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>m.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function Wi(n){return new m((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=kS(r.target.error);t(i)}})}var CI=!1;function kS(n){let e=gr.getIOSVersion(ba());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new _("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return CI||(CI=!0,setTimeout(()=>{throw r},0)),r}}return n}var Bl="IndexBackfiller",XF=15*1e3,JF=60*1e3,ZF=50,Bv=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(XF)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){R(Bl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>g(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();R(Bl,`Documents written: ${t}`)}catch(t){_i(t)?R(Bl,"Ignoring IndexedDB error during index backfill: ",t):yield Ei(t)}yield this.schedule(JF)}))}},qv=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return g(this,arguments,function*(e=ZF){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return m.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return R(Bl,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(R(Bl,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=PA(s);DS(o,r)>0&&(r=o)}),new an(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var jt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Go="",Uv="",FA="",BA="";function Rt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=bI(e)),e=e6(n.get(t),e);return bI(e)}function e6(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Go+FA;break;case Go:t+=Go+BA;break;default:t+=s}}return t}function bI(n){return n+Go+Uv}function Qn(n){let e=n.length;if(U(e>=2),e===2)return U(n.charAt(0)===Go&&n.charAt(1)===Uv),ne.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Go,s);switch((o<0||o>t)&&F(),n.charAt(o+1)){case Uv:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case FA:i+=n.substring(s,o),i+="\0";break;case BA:i+=n.substring(s,o+1);break;default:F()}s=o+2}return new ne(r)}var Qi="remoteDocuments";var gc="owner",ko="owner",mc="mutationQueues",t6="userId",En="mutations",qA="batchId",Zi="userMutationsIndex",UA=["userId","batchId"];function n6(n){return[n]}function vd(n,e){return[n,Rt(e)]}function VA(n,e,t){return[n,Rt(e),t]}var r6={},ua="documentMutations",yf="remoteDocumentsV14",i6=["prefixPath","collectionGroup","readTime","documentId"],Sd="documentKeyIndex",s6=["prefixPath","collectionGroup","documentId"],zA="collectionGroupIndex",o6=["collectionGroup","readTime","prefixPath","documentId"],yc="remoteDocumentGlobal",Vv="remoteDocumentGlobalKey",ha="targets",a6="targetId",jA="queryTargetsIndex",l6=["canonicalId","targetId"],da="targetDocuments",c6=["targetId","path"],NS="documentTargetsIndex",u6=["path","targetId"],Dd="targetGlobalKey",ys="targetGlobal",Kl="collectionParents",h6=["collectionId","parent"],$o="clientMetadata",d6="clientId",vf="bundles",f6="bundleId",Sf="namedQueries",p6="name",OS="indexConfiguration",g6="indexId",zv="collectionGroupIndex",m6="collectionGroup",xS="indexState",y6=["indexId","uid"],GA="sequenceNumberIndex",v6=["uid","sequenceNumber"],MS="indexEntries",S6=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],KA="documentKeyIndex",T6=["indexId","uid","orderedDocumentKey"],Tf="documentOverlays",w6=["userId","collectionPath","documentId"],jv="collectionPathOverlayIndex",E6=["userId","collectionPath","largestBatchId"],HA="collectionGroupOverlayIndex",_6=["userId","collectionGroup","largestBatchId"],C6=[mc,En,ua,Qi,ha,gc,ys,da],b6=C6,I6=[...b6,$o],A6=[...I6,yc],R6=[...A6,Kl],$A=[...R6,vf,Sf],D6=[...$A,Tf],WA=[mc,En,ua,yf,ha,gc,ys,da,$o,yc,Kl,vf,Sf,Tf],QA=WA,k6=[...QA,OS,xS,MS];function N6(n){if(n===15)return k6;if(n===14)return QA;if(n===13)return WA;if(n===12)return D6;if(n===11)return $A;F()}var Hl=class extends Ad{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function nt(n,e){let t=M(n);return gr.getStore(t.simpleDbTransaction,e)}function II(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function vs(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function YA(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Te=class n{constructor(e,t){this.comparator=e,this.root=t||ql.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ql.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ql.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vo(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vo(this.root,e,this.comparator,!0)}},Vo=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},ql=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw F();let t=this.left.check();if(t!==this.right.check())throw F();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Gv=class{constructor(){this.size=0}get key(){throw F()}get value(){throw F()}get color(){throw F()}get left(){throw F()}get right(){throw F()}copy(e,t,r,i,s){return this}insert(e,t,r){return new ql(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};ql.EMPTY=new Gv;var fe=class n{constructor(e){this.comparator=e,this.data=new Te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new kd(this.data.getIterator())}getIteratorFrom(e){return new kd(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},kd=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function O6(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=No(s),l=No(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let h=t(a,l);h<0?u=!0:h>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=No(o)):u?(i(a),a=No(s)):(a=No(s),l=No(o))}}function No(n){return n.hasNext()?n.getNext():void 0}var Gt=class n{constructor(e){this.fields=e,e.sort(qe.comparator)}static empty(){return new n([])}unionWith(e){let t=new fe(qe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rs(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function x6(n){return Buffer.from(n,"base64").toString("binary")}function M6(n){return Buffer.from(n,"binary").toString("base64")}function XA(){return!0}var tt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=x6(e);return new n(t)}static fromUint8Array(e){let t=P6(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return M6(this.binaryString)}toUint8Array(){return L6(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};tt.EMPTY_BYTE_STRING=new tt("");function P6(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function L6(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var F6=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function di(n){if(U(!!n),typeof n=="string"){let e=0,t=F6.exec(n);if(U(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=xe(n.seconds),t=xe(n.nanos);return{seconds:e,nanos:t}}}function xe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function fi(n){return typeof n=="string"?tt.fromBase64String(n):tt.fromUint8Array(n)}var JA="server_timestamp",ZA="__type__",eR="__previous_value__",tR="__local_write_time__";function wf(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[ZA])===null||t===void 0?void 0:t.stringValue)===JA}function B6(n,e){let t={fields:{[ZA]:{stringValue:JA},[tR]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&wf(e)&&(e=PS(e)),e&&(t.fields[eR]=e),{mapValue:t}}function PS(n){let e=n.mapValue.fields[eR];return wf(e)?PS(e):e}function $l(n){let e=di(n.mapValue.fields[tR].timestampValue);return new Ae(e.seconds,e.nanos)}var Kv=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},AI="(default)",pi=class n{constructor(e,t){this.projectId=e,this.database=t||AI}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===AI}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function q6(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new _(v.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pi(n.options.projectId,e)}var ui=-1;function vc(n){return n==null}function Wl(n){return n===0&&1/n===-1/0}function nR(n){return typeof n=="number"&&Number.isInteger(n)&&!Wl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var rR="__max__",li={mapValue:{fields:{__type__:{stringValue:rR}}}},Td={nullValue:"NULL_VALUE"};function ss(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?wf(n)?4:iR(n)?9007199254740991:10:F()}function _n(n,e){if(n===e)return!0;let t=ss(n),r=ss(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return $l(n).isEqual($l(e));case 3:return U6(n,e);case 5:return n.stringValue===e.stringValue;case 6:return z6(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return V6(n,e);case 2:return j6(n,e);case 9:return rs(n.arrayValue.values||[],e.arrayValue.values||[],_n);case 10:return G6(n,e);case 9007199254740991:return!0;default:return F()}}function U6(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=di(n.timestampValue),r=di(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function V6(n,e){return xe(n.geoPointValue.latitude)===xe(e.geoPointValue.latitude)&&xe(n.geoPointValue.longitude)===xe(e.geoPointValue.longitude)}function z6(n,e){return fi(n.bytesValue).isEqual(fi(e.bytesValue))}function j6(n,e){if("integerValue"in n&&"integerValue"in e)return xe(n.integerValue)===xe(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=xe(n.doubleValue),r=xe(e.doubleValue);return t===r?Wl(t)===Wl(r):isNaN(t)&&isNaN(r)}return!1}function G6(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(II(t)!==II(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!_n(t[i],r[i])))return!1;return!0}function Ql(n,e){return(n.values||[]).find(t=>_n(t,e))!==void 0}function gi(n,e){if(n===e)return 0;let t=ss(n),r=ss(e);if(t!==r)return W(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(n.booleanValue,e.booleanValue);case 2:return K6(n,e);case 3:return RI(n.timestampValue,e.timestampValue);case 4:return RI($l(n),$l(e));case 5:return W(n.stringValue,e.stringValue);case 6:return W6(n.bytesValue,e.bytesValue);case 7:return H6(n.referenceValue,e.referenceValue);case 8:return $6(n.geoPointValue,e.geoPointValue);case 9:return Q6(n.arrayValue,e.arrayValue);case 10:return Y6(n.mapValue,e.mapValue);default:throw F()}}function K6(n,e){let t=xe(n.integerValue||n.doubleValue),r=xe(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function RI(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return W(n,e);let t=di(n),r=di(e),i=W(t.seconds,r.seconds);return i!==0?i:W(t.nanos,r.nanos)}function H6(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=W(t[i],r[i]);if(s!==0)return s}return W(t.length,r.length)}function $6(n,e){let t=W(xe(n.latitude),xe(e.latitude));return t!==0?t:W(xe(n.longitude),xe(e.longitude))}function W6(n,e){let t=fi(n),r=fi(e);return t.compareTo(r)}function Q6(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=gi(t[i],r[i]);if(s)return s}return W(t.length,r.length)}function Y6(n,e){if(n===li.mapValue&&e===li.mapValue)return 0;if(n===li.mapValue)return 1;if(e===li.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=W(r[o],s[o]);if(a!==0)return a;let l=gi(t[r[o]],i[s[o]]);if(l!==0)return l}return W(r.length,s.length)}function Wo(n){return LS(n)}function LS(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?J6(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?X6(n.bytesValue):"referenceValue"in n?eB(n.referenceValue):"geoPointValue"in n?Z6(n.geoPointValue):"arrayValue"in n?nB(n.arrayValue):"mapValue"in n?tB(n.mapValue):F()}function X6(n){return fi(n).toBase64()}function J6(n){let e=di(n);return`time(${e.seconds},${e.nanos})`}function Z6(n){return`geo(${n.latitude},${n.longitude})`}function eB(n){return x.fromName(n).toString()}function tB(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${LS(n.fields[i])}`;return t+"}"}function nB(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=LS(r);return e+"]"}function os(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Hv(n){return!!n&&"integerValue"in n}function rB(n){return!!n&&"doubleValue"in n}function iB(n){return Hv(n)||rB(n)}function Yl(n){return!!n&&"arrayValue"in n}function DI(n){return!!n&&"nullValue"in n}function kI(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function wd(n){return!!n&&"mapValue"in n}function Ul(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return vs(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ul(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ul(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function iR(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===rR}function sB(n){return"nullValue"in n?Td:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?os(pi.empty(),x.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:F()}function oB(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?os(pi.empty(),x.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?li:F()}function NI(n,e){let t=gi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function OI(n,e){let t=gi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var yt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!wd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Ul(t)}setAll(e){let t=qe.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Ul(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());wd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return _n(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!wd(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){vs(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Ul(this.value))}};function sR(n){let e=[];return vs(n.fields,(t,r)=>{let i=new qe([t]);if(wd(r)){let o=sR(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Gt(e)}var Ge=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,j.min(),j.min(),j.min(),yt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,j.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,j.min(),j.min(),yt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,j.min(),j.min(),yt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(j.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=yt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function aB(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?gi(r,i):F()}var Zn=class{constructor(e,t){this.position=e,this.inclusive=t}};function oR(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=x.comparator(x.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=gi(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function lB(n,e,t){let r=oR(n,e,t);return n.inclusive?r>=0:r>0}function cB(n,e,t){let r=oR(n,e,t);return n.inclusive?r<=0:r<0}function xI(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!_n(r,i))return!1}return!0}var as=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function uB(n){return n.field.canonicalString()+n.dir}function hB(n){return`${n.field.canonicalString()} (${n.dir})`}function dB(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Nd=class{},Z=class n extends Nd{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Qv(e,t,r):t==="array-contains"?new Jv(e,r):t==="in"?new Od(e,r):t==="not-in"?new Zv(e,r):t==="array-contains-any"?new e0(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Yv(e,r):new Xv(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(gi(t,this.value)):t!==null&&ss(this.value)===ss(t)&&this.matchesComparison(gi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return F()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ue=class n extends Nd{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return Qo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function Qo(n){return n.op==="and"}function $v(n){return n.op==="or"}function FS(n){return aR(n)&&Qo(n)}function aR(n){for(let e of n.filters)if(e instanceof ue)return!1;return!0}function Wv(n){if(n instanceof Z)return n.field.canonicalString()+n.op.toString()+Wo(n.value);if(FS(n))return n.filters.map(e=>Wv(e)).join(",");{let e=n.filters.map(t=>Wv(t)).join(",");return`${n.op}(${e})`}}function lR(n,e){if(n instanceof Z)return fB(n,e);if(n instanceof ue)return pB(n,e);F()}function fB(n,e){return e instanceof Z&&n.op===e.op&&n.field.isEqual(e.field)&&_n(n.value,e.value)}function pB(n,e){return e instanceof ue&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&lR(i,e.filters[s]),!0):!1}function cR(n,e){let t=n.filters.concat(e);return ue.create(t,n.op)}function uR(n){return n instanceof Z?mB(n):n instanceof ue?gB(n):"Filter"}function gB(n){return n.op.toString()+" {"+n.getFilters().map(uR).join(" ,")+"}"}function mB(n){return`${n.field.canonicalString()} ${n.op} ${Wo(n.value)}`}var Qv=class extends Z{constructor(e,t,r){super(e,t,r),this.key=x.fromName(r.referenceValue)}matches(e){let t=x.comparator(e.key,this.key);return this.matchesComparison(t)}},Yv=class extends Z{constructor(e,t){super(e,"in",t),this.keys=hR("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Xv=class extends Z{constructor(e,t){super(e,"not-in",t),this.keys=hR("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function hR(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>x.fromName(r.referenceValue))}var Jv=class extends Z{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Yl(t)&&Ql(t.arrayValue,this.value)}},Od=class extends Z{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ql(this.value.arrayValue,t)}},Zv=class extends Z{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ql(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Ql(this.value.arrayValue,t)}},e0=class extends Z{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Yl(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>Ql(this.value.arrayValue,r))}};var t0=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function n0(n,e=null,t=[],r=[],i=null,s=null,o=null){return new t0(n,e,t,r,i,s,o)}function ls(n){let e=M(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Wv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>uB(r)).join(","),vc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Wo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Wo(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function yB(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>uR(t)).join(", ")}]`),vc(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>hB(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Wo(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Wo(t)).join(",")),`Target(${e})`}function Sc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!dB(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!lR(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!xI(n.startAt,e.startAt)?!1:xI(n.endAt,e.endAt)}function xd(n){return x.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Ef(n,e){return n.filters.filter(t=>t instanceof Z&&t.field.isEqual(e))}function vB(n,e){let t=RS(e);if(t===void 0)return null;for(let r of Ef(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function SB(n,e){let t=new Map;for(let r of is(e))for(let i of Ef(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function TB(n,e){let t=[],r=!0;for(let i of is(e)){let s=i.kind===0?dR(n,i.fieldPath,n.startAt):fR(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new Zn(t,r)}function wB(n,e){let t=[],r=!0;for(let i of is(e)){let s=i.kind===0?fR(n,i.fieldPath,n.endAt):dR(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new Zn(t,r)}function dR(n,e,t){let r=Td,i=!0;for(let s of Ef(n,e)){let o=Td,a=!0;switch(s.op){case"<":case"<=":o=sB(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Td;break}NI({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];NI({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function fR(n,e,t){let r=li,i=!0;for(let s of Ef(n,e)){let o=li,a=!0;switch(s.op){case">=":case">":o=oB(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=li;break}OI({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];OI({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function EB(n){let e=new fe(qe.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function _B(n){return n.limit!==null}var Cn=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function pR(n,e,t,r,i,s,o,a){return new Cn(n,e,t,r,i,s,o,a)}function fa(n){return new Cn(n)}function CB(n,e){return new Cn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function MI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function bB(n){let e=new fe(qe.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function IB(n){return new Cn(ne.emptyPath(),n)}function AB(n){return x.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function BS(n){return n.collectionGroup!==null}function Yo(n){let e=M(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";bB(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new as(s,r))}),t.has(qe.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new as(qe.keyField(),r))}return e.memoizedNormalizedOrderBy}function Dt(n){let e=M(n);return e.memoizedTarget||(e.memoizedTarget=RB(e,Yo(n))),e.memoizedTarget}function RB(n,e){if(n.limitType==="F")return n0(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new as(i.field,s)});let t=n.endAt?new Zn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Zn(n.startAt.position,n.startAt.inclusive):null;return n0(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function qS(n,e){let t=n.filters.concat([e]);return new Cn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function DB(n,e){let t=n.explicitOrderBy.concat([e]);return new Cn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function Md(n,e,t){return new Cn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function kB(n,e){return new Cn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function NB(n,e){return new Cn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function Tc(n,e){return Sc(Dt(n),Dt(e))&&n.limitType===e.limitType}function gR(n){return`${ls(Dt(n))}|lt:${n.limitType}`}function Bo(n){return`Query(target=${yB(Dt(n))}; limitType=${n.limitType})`}function wc(n,e){return e.isFoundDocument()&&OB(n,e)&&xB(n,e)&&MB(n,e)&&PB(n,e)}function OB(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):x.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function xB(n,e){for(let t of Yo(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function MB(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function PB(n,e){return!(n.startAt&&!cB(n.startAt,Yo(n),e)||n.endAt&&!lB(n.endAt,Yo(n),e))}function mR(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function yR(n){return(e,t)=>{let r=!1;for(let i of Yo(n)){let s=LB(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function LB(n,e,t){let r=n.field.isKeyField()?x.comparator(e.key,t.key):aB(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F()}}var er=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){vs(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return YA(this.inner)}size(){return this.innerSize}};var FB=new Te(x.comparator);function Lt(){return FB}var vR=new Te(x.comparator);function Ll(...n){let e=vR;for(let t of n)e=e.insert(t.key,t);return e}function BB(){return Xl()}function SR(n){let e=vR;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Yn(){return Xl()}function TR(){return Xl()}function Xl(){return new er(n=>n.toString(),(n,e)=>n.isEqual(e))}var qB=new Te(x.comparator);function UB(){return qB}var VB=new fe(x.comparator);function Q(...n){let e=VB;for(let t of n)e=e.add(t);return e}var zB=new fe(W);function US(){return zB}function wR(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wl(e)?"-0":e}}function ER(n){return{integerValue:""+n}}function _R(n,e){return nR(e)?ER(e):wR(n,e)}var Xo=class{constructor(){this._=void 0}};function jB(n,e,t){return n instanceof mi?B6(t,e):n instanceof mr?bR(n,e):n instanceof yr?IR(n,e):HB(n,e)}function GB(n,e,t){return n instanceof mr?bR(n,e):n instanceof yr?IR(n,e):t}function CR(n,e){return n instanceof yi?iB(e)?e:{integerValue:0}:null}function KB(n,e){return n instanceof mr&&e instanceof mr||n instanceof yr&&e instanceof yr?rs(n.elements,e.elements,_n):n instanceof yi&&e instanceof yi?_n(n.operand,e.operand):n instanceof mi&&e instanceof mi}var mi=class extends Xo{},mr=class extends Xo{constructor(e){super(),this.elements=e}};function bR(n,e){let t=AR(e);for(let r of n.elements)t.some(i=>_n(i,r))||t.push(r);return{arrayValue:{values:t}}}var yr=class extends Xo{constructor(e){super(),this.elements=e}};function IR(n,e){let t=AR(e);for(let r of n.elements)t=t.filter(i=>!_n(i,r));return{arrayValue:{values:t}}}var yi=class extends Xo{constructor(e,t){super(),this.serializer=e,this.operand=t}};function HB(n,e){let t=CR(n,e),r=PI(t)+PI(n.operand);return Hv(t)&&Hv(n.operand)?ER(r):wR(n.serializer,r)}function PI(n){return xe(n.integerValue||n.doubleValue)}function AR(n){return Yl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var cs=class{constructor(e,t){this.field=e,this.transform=t}};function $B(n,e){return n.field.isEqual(e.field)&&KB(n.transform,e.transform)}function WB(n,e){return n===void 0&&e===void 0?!0:n&&e?rs(n,e,(t,r)=>$B(t,r)):!1}var r0=class{constructor(e,t){this.version=e,this.transformResults=t}},Oe=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function _f(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var Jo=class{};function RR(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Si(n.key,Oe.none()):new vi(n.key,n.data,Oe.none());{let t=n.data,r=yt.empty(),i=new fe(qe.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new bn(n.key,r,new Gt(i.toArray()),Oe.none())}}function QB(n,e,t){n instanceof vi?XB(n,e,t):n instanceof bn?ZB(n,e,t):t5(n,e,t)}function Vl(n,e,t,r){return n instanceof vi?JB(n,e,t,r):n instanceof bn?e5(n,e,t,r):n5(n,e,t)}function YB(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=CR(r.transform,i||null);s!=null&&(t===null&&(t=yt.empty()),t.set(r.field,s))}return t||null}function LI(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!WB(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var vi=class extends Jo{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function XB(n,e,t){let r=n.value.clone(),i=kR(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function JB(n,e,t,r){if(!_f(n.precondition,e))return t;let i=n.value.clone(),s=NR(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var bn=class extends Jo{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function ZB(n,e,t){if(!_f(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=kR(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(DR(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function e5(n,e,t,r){if(!_f(n.precondition,e))return t;let i=NR(n.fieldTransforms,r,e),s=e.data;return s.setAll(DR(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function DR(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function kR(n,e,t){let r=new Map;U(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,GB(o,a,t[i]))}return r}function NR(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,jB(s,o,e))}return r}var Si=class extends Jo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function t5(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function n5(n,e,t){return _f(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Jl=class extends Jo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Zl=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];QB(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Vl(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Vl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=TR();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=RR(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(j.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Q())}isEqual(e){return this.batchId===e.batchId&&rs(this.mutations,e.mutations,(t,r)=>LI(t,r))&&rs(this.baseMutations,e.baseMutations,(t,r)=>LI(t,r))}},i0=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){U(e.mutations.length===r.length);let i=UB(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var ec=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var s0=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var et=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(et||{});function OR(n){switch(n){case v.OK:return F();case v.CANCELLED:case v.UNKNOWN:case v.DEADLINE_EXCEEDED:case v.RESOURCE_EXHAUSTED:case v.INTERNAL:case v.UNAVAILABLE:case v.UNAUTHENTICATED:return!1;case v.INVALID_ARGUMENT:case v.NOT_FOUND:case v.ALREADY_EXISTS:case v.PERMISSION_DENIED:case v.FAILED_PRECONDITION:case v.ABORTED:case v.OUT_OF_RANGE:case v.UNIMPLEMENTED:case v.DATA_LOSS:return!0;default:return F()}}function r5(n){return OR(n)&&n!==v.ABORTED}function Ed(n){if(n===void 0)return Ie("GRPC error has no .code"),v.UNKNOWN;switch(n){case et.OK:return v.OK;case et.CANCELLED:return v.CANCELLED;case et.UNKNOWN:return v.UNKNOWN;case et.DEADLINE_EXCEEDED:return v.DEADLINE_EXCEEDED;case et.RESOURCE_EXHAUSTED:return v.RESOURCE_EXHAUSTED;case et.INTERNAL:return v.INTERNAL;case et.UNAVAILABLE:return v.UNAVAILABLE;case et.UNAUTHENTICATED:return v.UNAUTHENTICATED;case et.INVALID_ARGUMENT:return v.INVALID_ARGUMENT;case et.NOT_FOUND:return v.NOT_FOUND;case et.ALREADY_EXISTS:return v.ALREADY_EXISTS;case et.PERMISSION_DENIED:return v.PERMISSION_DENIED;case et.FAILED_PRECONDITION:return v.FAILED_PRECONDITION;case et.ABORTED:return v.ABORTED;case et.OUT_OF_RANGE:return v.OUT_OF_RANGE;case et.UNIMPLEMENTED:return v.UNIMPLEMENTED;case et.DATA_LOSS:return v.DATA_LOSS;default:return F()}}var o0=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Sv=null;function xR(){return new BF}function i5(){return new qF("utf-8")}var s5=new Li([4294967295,4294967295],0);function FI(n){let e=xR().encode(n),t=new GE;return t.update(e),new Uint8Array(t.digest())}function BI(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Li([t,r],0),a=new Li([i,s],0);return[o,a]}var a0=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new es(`Invalid padding: ${t}`);if(r<0)throw new es(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new es(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new es(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Li.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(Li.fromNumber(r)));return i.compare(s5)===1&&(i=new Li([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=FI(e),[r,i]=BI(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=FI(e),[r,i]=BI(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},es=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var tc=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,nc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(j.min(),i,new Te(W),Lt(),Q())}},nc=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Q(),Q(),Q())}};var Ko=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},Pd=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},Ld=class{constructor(e,t,r=tt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Fd=class{constructor(){this.pendingResponses=0,this.documentChanges=UI(),this._resumeToken=tt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=Q(),t=Q(),r=Q();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:F()}}),new nc(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=UI()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,U(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},o5="WatchChangeAggregator",l0=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Lt(),this.pendingDocumentTargetMapping=qI(),this.pendingTargetResets=new Te(W)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:F()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(xd(s))if(r===0){let o=new x(s.path);this.removeDocumentFromTarget(t,o,Ge.newNoDocument(o,j.min()))}else U(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Sv?.notifyOnExistenceFilterMismatch(a5(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=fi(r).toUint8Array()}catch(l){if(l instanceof o0)return on("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new a0(o,i,s)}catch(l){return l instanceof es?on("BloomFilter error: ",l):on("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&xd(a.target)){let l=new x(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,Ge.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=Q();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new tc(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Lt(),this.pendingDocumentTargetMapping=qI(),this.pendingTargetResets=new Te(W),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Fd,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new fe(W),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||R(o5,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Fd),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function qI(){return new Te(x.comparator)}function UI(){return new Te(x.comparator)}function a5(n,e,t,r,i){var s,o,a,l,c,u;let h={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},d=e.unchangedNames;return d&&(h.bloomFilter={applied:i===0,hashCount:(s=d?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=d?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=d?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:p=>{var y;return(y=r?.mightContain(p))!==null&&y!==void 0?y:!1}}),h}var l5=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),c5=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),u5=(()=>{let n={};return n.and="AND",n.or="OR",n})();var c0=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function h5(n){let e=n.code===void 0?v.UNKNOWN:Ed(n.code);return new _(e,n.message||"")}function u0(n,e){return n.useProto3Json||vc(e)?e:{value:e}}function d5(n){let e;return typeof n=="object"?e=n.value:e=n,vc(e)?null:e}function Zo(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function f5(n){let e=di(n);return new Ae(e.seconds,e.nanos)}function MR(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function p5(n,e){return n.useProto3Json?(U(e===void 0||typeof e=="string"),tt.fromBase64String(e||"")):(U(e===void 0||e instanceof Uint8Array),tt.fromUint8Array(e||new Uint8Array))}function g5(n,e){return Zo(n,e.toTimestamp())}function Be(n){return U(!!n),j.fromTimestamp(f5(n))}function VS(n,e){return h0(n,e).canonicalString()}function h0(n,e){let t=m5(n).child("documents");return e===void 0?t:t.child(e)}function PR(n){let e=ne.fromString(n);return U(KR(e)),e}function rc(n,e){return VS(n.databaseId,e.path)}function Xn(n,e){let t=PR(e);if(t.get(1)!==n.databaseId.projectId)throw new _(v.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new _(v.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new x(BR(t))}function LR(n,e){return VS(n.databaseId,e)}function FR(n){let e=PR(n);return e.length===4?ne.emptyPath():BR(e)}function d0(n){return new ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function m5(n){return new ne(["projects",n.projectId,"databases",n.database])}function BR(n){return U(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function VI(n,e,t){return{name:rc(n,e),fields:t.value.mapValue.fields}}function y5(n,e){return{name:rc(n,e.key),fields:e.data.value.mapValue.fields,updateTime:Zo(n,e.version.toTimestamp()),createTime:Zo(n,e.createTime.toTimestamp())}}function qR(n,e,t){let r=Xn(n,e.name),i=Be(e.updateTime),s=e.createTime?Be(e.createTime):j.min(),o=new yt({mapValue:{fields:e.fields}}),a=Ge.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function v5(n,e){U(!!e.found),e.found.name,e.found.updateTime;let t=Xn(n,e.found.name),r=Be(e.found.updateTime),i=e.found.createTime?Be(e.found.createTime):j.min(),s=new yt({mapValue:{fields:e.found.fields}});return Ge.newFoundDocument(t,r,i,s)}function S5(n,e){U(!!e.missing),U(!!e.readTime);let t=Xn(n,e.missing),r=Be(e.readTime);return Ge.newNoDocument(t,r)}function T5(n,e){return"found"in e?v5(n,e):"missing"in e?S5(n,e):F()}function w5(n,e){let t;if("targetChange"in e){e.targetChange;let r=E5(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=p5(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&h5(o);t=new Ld(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Xn(n,r.document.name),s=Be(r.document.updateTime),o=r.document.createTime?Be(r.document.createTime):j.min(),a=new yt({mapValue:{fields:r.document.fields}}),l=Ge.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Ko(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Xn(n,r.document),s=r.readTime?Be(r.readTime):j.min(),o=Ge.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Ko([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Xn(n,r.document),s=r.removedTargetIds||[];t=new Ko([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new s0(i,s),a=r.targetId;t=new Pd(a,o)}else return F();return t}function E5(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:F()}function _5(n){if(!("targetChange"in n))return j.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?j.min():Be(e.readTime)}function ic(n,e){let t;if(e instanceof vi)t={update:VI(n,e.key,e.value)};else if(e instanceof Si)t={delete:rc(n,e.key)};else if(e instanceof bn)t={update:VI(n,e.key,e.data),updateMask:n9(e.fieldMask)};else if(e instanceof Jl)t={verify:rc(n,e.key)};else return F();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>R5(n,r))),e.precondition.isNone||(t.currentDocument=C5(n,e.precondition)),t}function f0(n,e){let t=e.currentDocument?b5(e.currentDocument):Oe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>D5(n,i)):[];if(e.update){e.update.name;let i=Xn(n,e.update.name),s=new yt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=r9(e.updateMask);return new bn(i,s,o,t,r)}else return new vi(i,s,t,r)}else if(e.delete){let i=Xn(n,e.delete);return new Si(i,t)}else if(e.verify){let i=Xn(n,e.verify);return new Jl(i,t)}else return F()}function C5(n,e){return e.updateTime!==void 0?{updateTime:g5(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:F()}function b5(n){return n.updateTime!==void 0?Oe.updateTime(Be(n.updateTime)):n.exists!==void 0?Oe.exists(n.exists):Oe.none()}function I5(n,e){let t=n.updateTime?Be(n.updateTime):Be(e);return t.isEqual(j.min())&&(t=Be(e)),new r0(t,n.transformResults||[])}function A5(n,e){return n&&n.length>0?(U(e!==void 0),n.map(t=>I5(t,e))):[]}function R5(n,e){let t=e.transform;if(t instanceof mi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof mr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof yr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof yi)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw F()}function D5(n,e){let t=null;if("setToServerValue"in e)U(e.setToServerValue==="REQUEST_TIME"),t=new mi;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new mr(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new yr(i)}else"increment"in e?t=new yi(n,e.increment):F();let r=qe.fromServerFormat(e.fieldPath);return new cs(r,t)}function UR(n,e){return{documents:[LR(n,e.path)]}}function k5(n){let e=n.documents.length;U(e===1);let t=n.documents[0];return Dt(fa(FR(t)))}function VR(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=LR(n,i);let s=P5(e.filters);s&&(t.structuredQuery.where=s);let o=F5(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=u0(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=q5(e.startAt)),e.endAt&&(t.structuredQuery.endAt=U5(e.endAt)),{queryTarget:t,parent:i}}function zR(n){let e=FR(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){U(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=L5(t.where));let o=[];t.orderBy&&(o=B5(t.orderBy));let a=null;t.limit&&(a=d5(t.limit));let l=null;t.startAt&&(l=V5(t.startAt));let c=null;return t.endAt&&(c=z5(t.endAt)),pR(e,i,o,s,a,"F",l,c)}function N5(n){return Dt(zR(n))}function O5(n,e){let t=x5(e.purpose);return t==null?null:{"goog-listen-tags":t}}function x5(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F()}}function M5(n,e){let t,r=e.target;if(xd(r)?t={documents:UR(n,r)}:t={query:VR(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=MR(n,e.resumeToken);let i=u0(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(j.min())>0){t.readTime=Zo(n,e.snapshotVersion.toTimestamp());let i=u0(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function P5(n){if(n.length!==0)return GR(ue.create(n,"and"))}function L5(n){let e=jR(n);return e instanceof ue&&FS(e)?e.getFilters():[e]}function jR(n){return n.unaryFilter!==void 0?Z5(n):n.fieldFilter!==void 0?e9(n):n.compositeFilter!==void 0?t9(n):F()}function F5(n){if(n.length!==0)return n.map(e=>Q5(e))}function B5(n){return n.map(e=>Y5(e))}function q5(n){return{before:n.inclusive,values:n.position}}function U5(n){return{before:!n.inclusive,values:n.position}}function V5(n){let e=!!n.before,t=n.values||[];return new Zn(t,e)}function z5(n){let e=!n.before,t=n.values||[];return new Zn(t,e)}function j5(n){return l5[n]}function G5(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function K5(n){return c5[n]}function H5(n){return u5[n]}function $5(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F();default:return F()}}function W5(n){switch(n){case"AND":return"and";case"OR":return"or";default:return F()}}function qo(n){return{fieldPath:n.canonicalString()}}function zo(n){return qe.fromServerFormat(n.fieldPath)}function Q5(n){return{field:qo(n.field),direction:j5(n.dir)}}function Y5(n){return new as(zo(n.field),G5(n.direction))}function GR(n){return n instanceof Z?J5(n):n instanceof ue?X5(n):F()}function X5(n){let e=n.getFilters().map(t=>GR(t));return e.length===1?e[0]:{compositeFilter:{op:H5(n.op),filters:e}}}function J5(n){if(n.op==="=="){if(kI(n.value))return{unaryFilter:{field:qo(n.field),op:"IS_NAN"}};if(DI(n.value))return{unaryFilter:{field:qo(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(kI(n.value))return{unaryFilter:{field:qo(n.field),op:"IS_NOT_NAN"}};if(DI(n.value))return{unaryFilter:{field:qo(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qo(n.field),op:K5(n.op),value:n.value}}}function Z5(n){switch(n.unaryFilter.op){case"IS_NAN":let e=zo(n.unaryFilter.field);return Z.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=zo(n.unaryFilter.field);return Z.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=zo(n.unaryFilter.field);return Z.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=zo(n.unaryFilter.field);return Z.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F();default:return F()}}function e9(n){return Z.create(zo(n.fieldFilter.field),$5(n.fieldFilter.op),n.fieldFilter.value)}function t9(n){return ue.create(n.compositeFilter.filters.map(e=>jR(e)),W5(n.compositeFilter.op))}function n9(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function r9(n){let e=n.fieldPaths||[];return new Gt(e.map(t=>qe.fromServerFormat(t)))}function KR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ea=class n{constructor(e,t,r,i,s=j.min(),o=j.min(),a=tt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Bd=class{constructor(e){this.remoteSerializer=e}};function i9(n,e){let t;if(e.document)t=qR(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=x.fromSegments(e.noDocument.path),i=hs(e.noDocument.readTime);t=Ge.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=x.fromSegments(e.unknownDocument.path),i=hs(e.unknownDocument.version);t=Ge.newUnknownDocument(r,i)}else return F();return e.readTime&&t.setReadTime(s9(e.readTime)),t}function zI(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Cf(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=y5(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:us(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:us(e.version)};else return F();return r}function Cf(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function s9(n){let e=new Ae(n[0],n[1]);return j.fromTimestamp(e)}function us(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function hs(n){let e=new Ae(n.seconds,n.nanoseconds);return j.fromTimestamp(e)}function o9(n,e,t){let r=t.baseMutations.map(s=>ic(n.remoteSerializer,s)),i=t.mutations.map(s=>ic(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function Yi(n,e){let t=(e.baseMutations||[]).map(s=>f0(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>f0(n.remoteSerializer,s)),i=Ae.fromMillis(e.localWriteTimeMs);return new Zl(e.batchId,i,t,r)}function Fl(n){let e=hs(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?hs(n.lastLimboFreeSnapshotVersion):j.min(),r;return a9(n.query)?r=k5(n.query):r=N5(n.query),new ea(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,tt.fromBase64String(n.resumeToken))}function HR(n,e){let t=us(e.snapshotVersion),r=us(e.lastLimboFreeSnapshotVersion),i;xd(e.target)?i=UR(n.remoteSerializer,e.target):i=VR(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ls(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function a9(n){return n.documents!==void 0}function l9(n){return{id:n.bundleId,createTime:hs(n.createTime),version:n.version}}function c9(n){return{bundleId:n.id,createTime:us(Be(n.createTime)),version:n.version}}function u9(n){return{name:n.name,query:zS(n.bundledQuery),readTime:hs(n.readTime)}}function h9(n){return{name:n.name,readTime:us(Be(n.readTime)),bundledQuery:n.bundledQuery}}function zS(n){let e=zR({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Md(e,e.limit,"L"):e}function d9(n){return{name:n.name,query:zS(n.bundledQuery),readTime:Be(n.readTime)}}function f9(n){return{id:n.id,version:n.version,createTime:Be(n.createTime)}}function Tv(n,e){return new ec(e.largestBatchId,f0(n.remoteSerializer,e.overlayMutation))}function p9(n,e,t){let[r,i,s]=$R(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:ic(n.remoteSerializer,t.mutation)}}function $R(n,e){let t=e.path.lastSegment(),r=Rt(e.path.popLast());return[n,r,t]}function g9(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function m9(n,e){let t=e?new Gl(e.sequenceNumber,new an(hs(e.readTime),new x(Qn(e.documentKey)),e.largestBatchId)):Gl.empty(),r=n.fields.map(([i,s])=>new jo(qe.fromServerFormat(i),s));return new Pv(n.indexId,n.collectionGroup,r,t)}function jI(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:us(r.readTime),documentKey:Rt(r.documentKey.path),largestBatchId:r.largestBatchId}}var p0=class{getBundleMetadata(e,t){return GI(e).get(t).next(r=>{if(r)return l9(r)})}saveBundleMetadata(e,t){return GI(e).put(c9(t))}getNamedQuery(e,t){return KI(e).get(t).next(r=>{if(r)return u9(r)})}saveNamedQuery(e,t){return KI(e).put(h9(t))}};function GI(n){return nt(n,vf)}function KI(n){return nt(n,Sf)}var qd=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Ol(e).get($R(this.userId,t)).next(r=>r?Tv(this.serializer,r):null)}getOverlays(e,t){let r=Yn();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new ec(t,o);i.push(this.saveOverlay(e,a))}),m.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Rt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Ol(e).deleteAll(jv,a))}),m.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Yn(),s=Rt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ol(e).loadAll(jv,o).next(a=>{for(let l of a){let c=Tv(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Yn(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ol(e).iterate({index:HA,range:a},(l,c,u)=>{let h=Tv(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return Ol(e).put(p9(this.serializer,this.userId,t))}};function Ol(n){return nt(n,Tf)}var y9=5,v9=10,S9=13,HI=15,T9=20,w9=25,E9=30,_9=37,C9=45,b9=50,I9=55,A9=60,R9=2,pr=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,y9);else if("booleanValue"in e)this.writeValueTypeLabel(t,v9),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,HI),t.writeNumber(xe(e.integerValue));else if("doubleValue"in e){let r=xe(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,S9):(this.writeValueTypeLabel(t,HI),Wl(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,T9),typeof r=="string"?t.writeString(r):(t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0))}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,E9),t.writeBytes(fi(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,C9),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?iR(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):F()}writeIndexString(e,t){this.writeValueTypeLabel(t,w9),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,I9);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,b9);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,_9),x.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,A9),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(R9)}};pr.INSTANCE=new pr;var $I="\uD800",WI="\uDBFF",Oo=0,QI=255,YI=1,xo=255,XI=255,JI=0,D9=64,k9=8,N9=1024;function O9(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function x9(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function M9(n){let e=0;for(let t=0;t<8;++t){let r=x9(n[t]&255);if(e+=r,r!==8)break}return e}function ZI(n){let e=D9-M9(n);return Math.ceil(e/k9)}var g0=class{constructor(){this.buffer=new Uint8Array(N9),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<$I||WI<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<$I||WI<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=ZI(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=ZI(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(xo),this.writeEscapedByteAscending(XI)}writeInfinityDescending(){this.writeEscapedByteDescending(xo),this.writeEscapedByteDescending(XI)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=O9(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===Oo?(this.writeEscapedByteAscending(Oo),this.writeEscapedByteAscending(QI)):t===xo?(this.writeEscapedByteAscending(xo),this.writeEscapedByteAscending(JI)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Oo?(this.writeEscapedByteDescending(Oo),this.writeEscapedByteDescending(QI)):t===xo?(this.writeEscapedByteDescending(xo),this.writeEscapedByteDescending(JI)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Oo),this.writeEscapedByteAscending(YI)}writeSeparatorDescending(){this.writeEscapedByteDescending(Oo),this.writeEscapedByteDescending(YI)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},m0=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},y0=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},Xi=class{constructor(){this.orderedCode=new g0,this.ascending=new m0(this.orderedCode),this.descending=new y0(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var Ji=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function ii(n,e){let t=n.indexId-e.indexId;return t!==0||(t=eA(n.arrayValue,e.arrayValue),t!==0)||(t=eA(n.directionalValue,e.directionalValue),t!==0)?t:x.comparator(n.documentKey,e.documentKey)}function eA(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Ud=class{constructor(e){this.inequalityFilters=new fe((t,r)=>qe.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(U(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=RS(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=is(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new fe(qe.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new jo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new jo(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new jo(r.field,r.dir==="asc"?0:1)));return new Pv(Pv.UNKNOWN_ID,this.collectionId,t,Gl.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function WR(n){var e,t;if(U(n instanceof Z||n instanceof ue),n instanceof Z)if(n instanceof Od){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>Z.create(n.field,"==",s)))||[];return ue.create(i,"or")}else return n;let r=n.filters.map(i=>WR(i));return ue.create(r,n.op)}function P9(n){if(n.getFilters().length===0)return[];let e=v0(WR(n));return U(QR(e)),jS(e)||GS(e)?[e]:e.getFilters()}function jS(n){return n instanceof Z}function GS(n){return n instanceof ue&&FS(n)}function QR(n){return jS(n)||GS(n)||L9(n)}function L9(n){if(n instanceof ue&&$v(n)){for(let e of n.getFilters())if(!jS(e)&&!GS(e))return!1;return!0}return!1}function v0(n){if(U(n instanceof Z||n instanceof ue),n instanceof Z)return n;if(n.filters.length===1)return v0(n.filters[0]);let e=n.filters.map(r=>v0(r)),t=ue.create(e,n.op);return t=Vd(t),QR(t)?t:(U(t instanceof ue),U(Qo(t)),U(t.filters.length>1),t.filters.reduce((r,i)=>KS(r,i)))}function KS(n,e){U(n instanceof Z||n instanceof ue),U(e instanceof Z||e instanceof ue);let t;return n instanceof Z?e instanceof Z?t=F9(n,e):t=tA(n,e):e instanceof Z?t=tA(e,n):t=B9(n,e),Vd(t)}function F9(n,e){return ue.create([n,e],"and")}function B9(n,e){if(U(n.filters.length>0&&e.filters.length>0),Qo(n)&&Qo(e))return cR(n,e.getFilters());let t=$v(n)?n:e,r=$v(n)?e:n,i=t.filters.map(s=>KS(s,r));return ue.create(i,"or")}function tA(n,e){if(Qo(e))return cR(e,n.getFilters());{let t=e.filters.map(r=>KS(n,r));return ue.create(t,"or")}}function Vd(n){if(U(n instanceof Z||n instanceof ue),n instanceof Z)return n;let e=n.getFilters();if(e.length===1)return Vd(e[0]);if(aR(n))return n;let t=e.map(i=>Vd(i)),r=[];return t.forEach(i=>{i instanceof Z?r.push(i):i instanceof ue&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ue.create(r,n.op)}var S0=class{constructor(){this.collectionParentIndex=new sc}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t){return m.resolve(null)}getIndexType(e,t){return m.resolve(0)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,t){return m.resolve(an.min())}getMinOffsetFromCollectionGroup(e,t){return m.resolve(an.min())}updateCollectionGroup(e,t,r){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}},sc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new fe(ne.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new fe(ne.comparator)).toArray()}};var nA="IndexedDbIndexManager",pd=new Uint8Array(0),T0=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new sc,this.targetToDnfSubTargets=new er(r=>ls(r),(r,i)=>Sc(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:Rt(i)};return rA(e).put(s)}return m.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[xA(t),""],!1,!0);return rA(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Qn(o.parent))}return r})}addFieldIndex(e,t){let r=xl(e),i=g9(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Po(e);return s.next(a=>{o.put(jI(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=xl(e),i=Po(e),s=Mo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=xl(e),r=Mo(e),i=Po(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return m.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new Ud(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=Mo(e),i=!0,s=new Map;return m.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=Q(),a=[];return m.forEach(s,(l,c)=>{R(nA,`Using index ${QF(l)} to execute ${ls(t)}`);let u=vB(c,l),h=SB(c,l),d=TB(c,l),p=wB(c,l),y=this.encodeBound(l,c,d),S=this.encodeBound(l,c,p),T=this.encodeValues(l,c,h),D=this.generateIndexRanges(l.indexId,u,y,d.inclusive,S,p.inclusive,T);return m.forEach(D,E=>r.loadFirst(E,t.limit).next(k=>{k.forEach(N=>{let q=x.fromSegments(N.documentKey);o.has(q)||(o=o.add(q),a.push(q))})}))}).next(()=>a)}else return m.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=P9(ue.create(e.filters,"and")).map(i=>n0(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let h=0;h<l;++h){let d=t?this.encodeSingleElement(t[h/c]):pd,p=this.generateLowerBound(e,d,r[h%c],i),y=this.generateUpperBound(e,d,s[h%c],o),S=a.map(T=>this.generateLowerBound(e,d,T,!0));u.push(...this.createRange(p,y,S))}return u}generateLowerBound(e,t,r,i){let s=new Ji(e,x.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new Ji(e,x.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new Ud(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return m.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<EB(s)&&(r=1):r=0})).next(()=>_B(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new Xi;for(let i of is(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);pr.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new Xi;return pr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new Xi;return pr.INSTANCE.writeIndexValue(os(this.databaseId,t),r.forKind(WF(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new Xi);let s=0;for(let o of is(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&Yl(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);pr.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new Xi;l.seed(a.encodedBytes()),pr.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof Z&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=xl(e),i=Po(e);return(t?r.loadAll(zv,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return m.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(m9(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:W(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=xl(e),s=Po(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(zv,IDBKeyRange.bound(t,t)).next(a=>m.forEach(a,l=>s.put(jI(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return m.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),m.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let h=this.computeIndexEntries(s,c);return u.isEqual(h)?m.resolve():this.updateEntries(e,s,c,u,h)}))))})}addIndexEntry(e,t,r,i){return Mo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return Mo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=Mo(e),s=new fe(ii);return i.iterate({index:KA,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new Ji(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new fe(ii),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=RS(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Yl(o))for(let a of o.arrayValue.values||[])r=r.add(new Ji(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new Ji(t.indexId,e.key,pd,i));return r}updateEntries(e,t,r,i,s){R(nA,"Updating index entries for document '%s'",t.key);let o=[];return O6(i,s,ii,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),m.waitFor(o)}getNextSequenceNumber(e){let t=1;return Po(e).iterate({index:GA,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>ii(o,a)).filter((o,a,l)=>!a||ii(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=ii(o,e),l=ii(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,pd,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,pd,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return ii(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(iA)}getMinOffset(e,t){return m.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||F())).next(iA)}};function rA(n){return nt(n,Kl)}function Mo(n){return nt(n,MS)}function xl(n){return nt(n,OS)}function Po(n){return nt(n,xS)}function iA(n){U(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;DS(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new an(e.readTime,e.documentKey,t)}function YR(n,e,t){let r=n.store(En),i=n.store(ua),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,h,d)=>(a++,d.delete()));s.push(l.next(()=>{U(a===1)}));let c=[];for(let u of t.mutations){let h=VA(e,u.key.path,t.batchId);s.push(i.delete(h)),c.push(u.key)}return m.waitFor(s).next(()=>c)}function zd(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw F();return JSON.stringify(e).length}var jd=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){U(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return si(e).iterate({index:Zi,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Uo(e),o=si(e);return o.add({}).next(a=>{U(typeof a=="number");let l=new Zl(a,t,r,i),c=o9(this.serializer,this.userId,l),u=[],h=new fe((d,p)=>W(d.canonicalString(),p.canonicalString()));for(let d of i){let p=VA(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),u.push(o.put(c)),u.push(s.put(p,r6))}return h.forEach(d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),m.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return si(e).get(t).next(r=>r?(U(r.userId===this.userId),Yi(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?m.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return si(e).iterate({index:Zi,range:i},(o,a,l)=>{a.userId===this.userId&&(U(a.batchId>=r),s=Yi(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=ui;return si(e).iterate({index:Zi,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,ui],[this.userId,Number.POSITIVE_INFINITY]);return si(e).loadAll(Zi,t).next(r=>r.map(i=>Yi(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=vd(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Uo(e).iterate({range:i},(o,a,l)=>{let[c,u,h]=o,d=Qn(u);if(c!==this.userId||!t.path.isEqual(d)){l.done();return}return si(e).get(h).next(p=>{if(!p)throw F();U(p.userId===this.userId),s.push(Yi(this.serializer,p))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(W),i=[];return t.forEach(s=>{let o=vd(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Uo(e).iterate({range:a},(c,u,h)=>{let[d,p,y]=c,S=Qn(p);if(d!==this.userId||!s.path.isEqual(S)){h.done();return}r=r.add(y)});i.push(l)}),m.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=vd(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new fe(W);return Uo(e).iterate({range:o},(l,c,u)=>{let[h,d,p]=l,y=Qn(d);if(h!==this.userId||!r.isPrefixOf(y)){u.done();return}y.length===i&&(a=a.add(p))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(si(e).get(s).next(o=>{if(o===null)throw F();U(o.userId===this.userId),r.push(Yi(this.serializer,o))}))}),m.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return YR(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),m.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return m.resolve();let r=IDBKeyRange.lowerBound(n6(this.userId)),i=[];return Uo(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=Qn(s[1]);i.push(c)}}).next(()=>{U(i.length===0)})})}containsKey(e,t){return XR(e,this.userId,t)}getMutationQueueMetadata(e){return JR(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:ui,lastStreamToken:""})}};function XR(n,e,t){let r=vd(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Uo(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,h,d]=a;u===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function q9(n,e){let t=!1;return JR(n).iterateSerial(r=>XR(n,r,e).next(i=>(i&&(t=!0),m.resolve(!i)))).next(()=>t)}function si(n){return nt(n,En)}function Uo(n){return nt(n,ua)}function JR(n){return nt(n,mc)}var wv=2,ta=class n{constructor(e){this.lastId=e}next(){return this.lastId+=wv,this.lastId}static forTargetCache(){return new n(2-wv)}static forSyncEngine(){return new n(1-wv)}};var w0=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new ta(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>j.fromTimestamp(new Ae(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Lo(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(U(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Lo(e).iterate((o,a)=>{let l=Fl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>m.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Lo(e).iterate((r,i)=>{let s=Fl(i);t(s)})}retrieveMetadata(e){return sA(e).get(Dd).next(t=>(U(t!==null),t))}saveMetadata(e,t){return sA(e).put(Dd,t)}saveTargetData(e,t){return Lo(e).put(HR(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=ls(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Lo(e).iterate({range:i,index:jA},(o,a,l)=>{let c=Fl(a);Sc(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=ai(e);return t.forEach(o=>{let a=Rt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),m.waitFor(i)}removeMatchingKeys(e,t,r){let i=ai(e);return m.forEach(t,s=>{let o=Rt(s.path);return m.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=ai(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=ai(e),s=Q();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=Qn(o[1]),u=new x(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=Rt(t.path),i=IDBKeyRange.bound([r],[xA(r)],!1,!0),s=0;return ai(e).iterate({index:NS,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Lo(e).get(t).next(r=>r?Fl(r):null)}};function Lo(n){return nt(n,ha)}function sA(n){return nt(n,ys)}function ai(n){return nt(n,da)}var oA={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ec=-1,ZR=40*1024*1024,sn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};sn.DEFAULT_COLLECTION_PERCENTILE=10;sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;sn.DEFAULT=new sn(ZR,sn.DEFAULT_COLLECTION_PERCENTILE,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);sn.DISABLED=new sn(Ec,0,0);var aA="LruGarbageCollector",lA=1*1024*1024,U9=1*60*1e3,V9=5*60*1e3;function cA([n,e],[t,r]){let i=W(n,t);return i===0?W(e,r):i}var E0=class{constructor(e){this.maxElements=e,this.buffer=new fe(cA),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();cA(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},_0=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==Ec&&this.scheduleGC(U9)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){R(aA,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){_i(t)?R(aA,"Ignoring IndexedDB error during garbage collection: ",t):yield Ei(t)}yield this.scheduleGC(V9)}))}},C0=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return m.resolve(jt.INVALID);let r=new E0(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===Ec?(R("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(oA)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),oA):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(R("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>{if(c=Date.now(),Fo()<=Rn.DEBUG){let d=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${h} documents in ${c-l}ms
Total Duration: ${c-u}ms`;R("LruGarbageCollector",d)}return m.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})})}};function z9(n,e){return new C0(n,e)}var b0=class{constructor(e,t){this.db=e,this.garbageCollector=z9(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return gd(e,r)}removeReference(e,t,r){return gd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return gd(e,t)}isPinned(e,t){return q9(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(h=>{if(!h)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,j.min()),ai(e).delete(j9(l))))});s.push(u)}}).next(()=>m.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return gd(e,t)}forEachOrphanedDocument(e,t){let r=ai(e),i=jt.INVALID,s;return r.iterate({index:NS},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==jt.INVALID&&t(new x(Qn(s)),i),i=c,s=l):i=jt.INVALID}).next(()=>{i!==jt.INVALID&&t(new x(Qn(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function j9(n){return[0,Rt(n.path)]}function G9(n,e){return{targetId:0,path:Rt(n.path),sequenceNumber:e}}function gd(n,e){return ai(n).put(G9(e,n.currentSequenceNumber))}var Gd=class{constructor(){this.changes=new er(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ge.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?m.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var I0=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return $i(e).put(r)}removeEntry(e,t,r){return $i(e).delete(K9(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=Ge.newInvalidDocument(t);return $i(e).iterate({index:Sd,range:IDBKeyRange.only(Ml(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:Ge.newInvalidDocument(t)};return $i(e).iterate({index:Sd,range:IDBKeyRange.only(Ml(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:zd(s)}}).next(()=>r)}getEntries(e,t){let r=Lt();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=Lt(),i=new Te(x.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,zd(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return m.resolve();let i=new fe(dA);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(Ml(i.first()),Ml(i.last())),o=i.getIterator(),a=o.getNext();return $i(e).iterate({index:Sd,range:s},(l,c,u)=>{let h=x.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&dA(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(Ml(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Cf(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return $i(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Lt();for(let h of c){let d=this.maybeDecodeDocument(x.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(wc(t,d)||i.has(d.key))&&(u=u.insert(d.key,d))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=Lt(),o=hA(t,r),a=hA(t,an.max());return $i(e).iterate({index:zA,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let h=this.maybeDecodeDocument(x.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new A0(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return uA(e).get(Vv).next(t=>(U(!!t),t))}setMetadata(e,t){return uA(e).put(Vv,t)}maybeDecodeDocument(e,t){if(t){let r=i9(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(j.min())))return r}return Ge.newInvalidDocument(e)}};function e2(n){return new I0(n)}var A0=class extends Gd{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new er(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new fe((s,o)=>W(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=zI(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=zd(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=zI(this.documentCache.serializer,o.convertToNoDocument(j.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),m.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function uA(n){return nt(n,yc)}function $i(n){return nt(n,yf)}function Ml(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function K9(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],Cf(e),t[t.length-1]]}function hA(n,e){let t=e.documentKey.path.toArray();return[n,Cf(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function dA(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=W(t[s],r[s]),i)return i;return i=W(t.length,r.length),i||(i=W(t[t.length-2],r[r.length-2]),i)?i:W(t[t.length-1],r[r.length-1])}var H9=15;var R0=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Kd=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Vl(r.mutation,i,Gt.empty(),Ae.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Q()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Q()){let i=Yn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Ll();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Yn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Q()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Lt(),o=Xl(),a=BB();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof bn)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Vl(u.mutation,c,u.mutation.getFieldMask(),Ae.now())):o.set(c.key,Gt.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var h;return a.set(c,new R0(u,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Xl(),i=new Te((o,a)=>o-a),s=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||Gt.empty();u=a.applyToLocalView(c,u),r.set(l,u);let h=(i.get(a.batchId)||Q()).add(l);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,h=TR();u.forEach(d=>{if(!s.has(d)){let p=RR(t.get(d),r.get(d));p!==null&&h.set(d,p),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return AB(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):BS(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):m.resolve(Yn()),a=Ho,l=s;return o.next(c=>m.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?m.resolve():this.remoteDocumentCache.getEntry(e,u).next(d=>{l=l.insert(u,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Q())).next(u=>({batchId:a,changes:SR(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new x(t)).next(r=>{let i=Ll();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Ll();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,l=>{let c=CB(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,Ge.newInvalidDocument(u)))});let a=Ll();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Vl(u.mutation,c,Gt.empty(),Ae.now()),wc(t,c)&&(a=a.insert(l,c))}),a})}};var D0=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return m.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,f9(t)),m.resolve()}getNamedQuery(e,t){return m.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,d9(t)),m.resolve()}};var k0=class{constructor(){this.overlays=new Te(x.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Yn();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),m.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),m.resolve()}getOverlaysForCollection(e,t,r){let i=Yn(),s=t.length+1,o=new x(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return m.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Te((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let d=s.get(u.largestBatchId);d===null&&(d=Yn(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=Yn(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((h,d)=>a.set(h,d)),!(a.size()>=i)););return m.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new ec(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Q(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var oc=class{constructor(){this.refsByKey=new fe(je.compareByKey),this.refsByTarget=new fe(je.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new je(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new je(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new x(new ne([])),r=new je(t,e),i=new je(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new x(new ne([])),r=new je(t,e),i=new je(t,e+1),s=Q();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new je(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},je=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return x.comparator(e.key,t.key)||W(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return W(e.targetOrBatchId,t.targetOrBatchId)||x.comparator(e.key,t.key)}};var N0=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new fe(je.compareByKey)}checkEmpty(e){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Zl(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new je(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?ui:this.nextBatchId-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new je(t,0),i=new je(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(W);return t.forEach(i=>{let s=new je(i,0),o=new je(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),m.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;x.isDocumentKey(s)||(s=s.child(""));let o=new je(new x(s),0),a=new fe(W);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),m.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");U(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return m.forEach(t.mutations,s=>{let o=new je(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new je(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return m.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,m.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function $9(){return new Te(x.comparator)}var O0=class{constructor(e){this.sizer=e,this.docs=$9(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return m.resolve(r?r.document.mutableCopy():Ge.newInvalidDocument(t))}getEntries(e,t){let r=Lt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ge.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Lt(),o=t.path,a=new x(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||DS(PA(u),r)<=0||!i.has(u.key)&&!wc(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,t,r,i){F()}forEachDocumentKey(e,t){return m.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new x0(this)}getSize(e){return m.resolve(this.size)}};function W9(n){return new O0(n)}var x0=class extends Gd{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),m.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var M0=class{constructor(e){this.persistence=e,this.targets=new er(t=>ls(t),Sc),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new oc,this.targetCount=0,this.targetIdGenerator=ta.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),m.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new ta(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.saveTargetData(t),m.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return m.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),m.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),m.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return m.resolve(r)}containsKey(e,t){return m.resolve(this.references.containsKey(t))}};var Q9="MemoryPersistence",Hd=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new jt(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new M0(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new S0,this.remoteDocumentCache=W9(r),this.serializer=new Bd(t),this.bundleCache=new D0(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new k0,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new N0(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){R(Q9,"Starting transaction:",e);let i=new P0(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return m.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},P0=class extends Ad{constructor(e){super(),this.currentSequenceNumber=e}},$d=class n{constructor(e){this.persistence=e,this.localViewReferences=new oc,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw F()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),m.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),m.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.orphanedDocuments,i=>{let s=x.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,j.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return m.or([()=>m.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var L0=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new Rd("createOrUpgrade",t);r<1&&i>=1&&(X9(e),J9(e),fA(e),e7(e));let o=m.resolve();return r<3&&i>=3&&(r!==0&&(r7(e),fA(e)),o=o.next(()=>s7(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>Z9(e,s))),o=o.next(()=>{o7(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(n7(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{i7(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{a7(e),l7(e)})),r<12&&i>=12&&(o=o.next(()=>{u7(e)})),r<13&&i>=13&&(o=o.next(()=>t7(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(Qi))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>c7(e))),o}addDocumentGlobal(e){let t=0;return e.store(Qi).iterate((r,i)=>{t+=zd(i)}).next(()=>{let r={byteSize:t};return e.store(yc).put(Vv,r)})}removeAcknowledgedMutations(e){let t=e.store(mc),r=e.store(En);return t.loadAll().next(i=>m.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,ui],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(Zi,o).next(a=>m.forEach(a,l=>{U(l.userId===s.userId);let c=Yi(this.serializer,l);return YR(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(da),r=e.store(Qi);return e.store(ys).get(Dd).next(s=>{let o=l=>t.put({targetId:0,path:Rt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new ne(l),h=Y9(u);a.push(t.get(h).next(d=>d?m.resolve():o(u)))}).next(()=>m.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Kl,{keyPath:h6});let r=t.store(Kl),i=new sc,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Rt(l)})}};return t.store(Qi).iterate({keysOnly:!0},(o,a)=>{let l=new ne(o);return s(l.popLast())}).next(()=>t.store(ua).iterate({keysOnly:!0},([o,a,l],c)=>{let u=Qn(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(ha);return t.iterate((r,i)=>{let s=Fl(i),o=HR(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(Qi),i=[];return r.iterate((s,o)=>{let a=t.store(yf),l=h7(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>m.waitFor(i))}runOverlayMigration(e,t){let r=t.store(En),i=e2(this.serializer),s=new Hd($d.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:Q();Yi(this.serializer,l).keys().forEach(d=>u=u.add(d)),a.set(l.userId,u)}),m.forEach(a,(l,c)=>{let u=new Ke(c),h=qd.forUser(this.serializer,u),d=s.getIndexManager(u),p=jd.forUser(u,this.serializer,d,s.referenceDelegate);return new Kd(i,p,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Hl(t,jt.INVALID),l).next()})})}};function Y9(n){return[0,Rt(n)]}function X9(n){n.createObjectStore(gc)}function J9(n){n.createObjectStore(mc,{keyPath:t6}),n.createObjectStore(En,{keyPath:qA,autoIncrement:!0}).createIndex(Zi,UA,{unique:!0}),n.createObjectStore(ua)}function Z9(n,e){return e.store(En).loadAll().next(r=>{n.deleteObjectStore(En),n.createObjectStore(En,{keyPath:qA,autoIncrement:!0}).createIndex(Zi,UA,{unique:!0});let s=e.store(En),o=r.map(a=>s.put(a));return m.waitFor(o)})}function e7(n){n.createObjectStore(Qi)}function t7(n){let e=n.createObjectStore(yf,{keyPath:i6});e.createIndex(Sd,s6),e.createIndex(zA,o6)}function n7(n){n.createObjectStore(yc)}function fA(n){n.createObjectStore(da,{keyPath:c6}).createIndex(NS,u6,{unique:!0}),n.createObjectStore(ha,{keyPath:a6}).createIndex(jA,l6,{unique:!0}),n.createObjectStore(ys)}function r7(n){n.deleteObjectStore(da),n.deleteObjectStore(ha),n.deleteObjectStore(ys)}function i7(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function s7(n){let e=n.store(ys),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return e.put(Dd,t)}function o7(n){n.createObjectStore($o,{keyPath:d6})}function a7(n){n.createObjectStore(vf,{keyPath:f6})}function l7(n){n.createObjectStore(Sf,{keyPath:p6})}function c7(n){n.createObjectStore(OS,{keyPath:g6,autoIncrement:!0}).createIndex(zv,m6,{unique:!1}),n.createObjectStore(xS,{keyPath:y6}).createIndex(GA,v6,{unique:!1}),n.createObjectStore(MS,{keyPath:S6}).createIndex(KA,T6,{unique:!1})}function u7(n){let e=n.createObjectStore(Tf,{keyPath:w6});e.createIndex(jv,E6,{unique:!1}),e.createIndex(HA,_6,{unique:!1})}function h7(n){return n.document?new x(ne.fromString(n.document.name).popFirst(5)):n.noDocument?x.fromSegments(n.noDocument.path):n.unknownDocument?x.fromSegments(n.unknownDocument.path):F()}var oi="IndexedDbPersistence",Ev=30*60*1e3,_v=5e3,d7=4e3,Cv="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",f7="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",p7="firestore_zombie",t2="main",F0=class n{constructor(e,t,r,i,s,o,a,l,c,u,h=H9){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=h,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=d=>Promise.resolve(),!n.isAvailable())throw new _(v.UNIMPLEMENTED,f7);this.referenceDelegate=new b0(this,i),this.dbName=t+t2,this.serializer=new Bd(l),this.simpleDb=new gr(this.dbName,this.schemaVersion,new L0(this.serializer)),this.targetCache=new w0(this.referenceDelegate,this.serializer),this.remoteDocumentCache=e2(this.serializer),this.bundleCache=new p0,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Ie(oi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new _(v.FAILED_PRECONDITION,Cv);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new jt(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>g(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>g(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>g(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>md(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(_i(e))return R(oi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return R(oi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return Pl(e).get(ko).next(r=>m.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return md(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return g(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,Ev)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=nt(t,$o);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,Ev),o=i.filter(a=>s.indexOf(a)===-1);return m.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",d7,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?m.resolve(!0):Pl(e).get(ko).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,_v)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new _(v.FAILED_PRECONDITION,Cv);return!1}}return this.networkEnabled&&this.inForeground?!0:md(e).loadAll().next(s=>this.filterActiveClients(s,_v).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&R(oi,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return g(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[gc,$o],e=>{let t=new Hl(e,jt.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>md(e).loadAll().next(t=>this.filterActiveClients(t,Ev).map(r=>r.clientId)))}get started(){return this._started}getMutationQueue(e,t){return jd.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new T0(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return qd.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){R(oi,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=N6(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Hl(a,this.listenSequence?this.listenSequence.next():jt.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Ie(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new _(v.FAILED_PRECONDITION,LA);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return Pl(e).get(ko).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,_v)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new _(v.FAILED_PRECONDITION,Cv)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Pl(e).put(ko,t)}static isAvailable(){return gr.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=Pl(e);return t.get(ko).next(r=>this.isLocalClient(r)?(R(oi,"Releasing primary lease."),t.delete(ko)):m.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Ie(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Qf()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return R(oi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ie(oi,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Ie("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${p7}_${this.persistenceKey}_${e}`}};function Pl(n){return nt(n,gc)}function md(n){return nt(n,$o)}function HS(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function g7(n){return g(this,null,function*(){if(!gr.isAvailable())return Promise.resolve();let e=n+t2;yield gr.delete(e)})}var $S="LocalStore",m7=5*60*1e6,ac=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Te(W),this.targetIdByTarget=new er(s=>ls(s),Sc),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Kd(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function n2(n,e,t,r){return new ac(n,e,t,r)}function r2(n,e){return g(this,null,function*(){let t=M(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=Q();for(let u of s){a.push(u.batchId);for(let h of u.mutations)c=c.add(h.key)}for(let u of o){l.push(u.batchId);for(let h of u.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function y7(n,e){let t=M(n),r=Ae.now(),i=e.reduce((a,l)=>a.add(l.key),Q()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Lt(),c=Q();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((h,d)=>{d.isValidDocument()||(c=c.add(h))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let h=[];for(let d of e){let p=YB(d,s.get(d.key).overlayedDocument);p!=null&&h.push(new bn(d.key,p,sR(p.value.mapValue),Oe.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,h,e)}).next(u=>{o=u;let h=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,h)})}).then(()=>({batchId:o.batchId,changes:SR(s)}))}function v7(n,e){let t=M(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return R7(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,S7(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function S7(n){let e=Q();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function T7(n,e){let t=M(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(U(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function w7(n){let e=M(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function i2(n){let e=M(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function E7(n,e){let t=M(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,h)=>{let d=i.get(h);if(!d)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,h).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,h)));let p=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?p=p.withResumeToken(tt.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),i=i.insert(h,p),_7(d,p,u)&&a.push(t.targetCache.updateTargetData(s,p))});let l=Lt(),c=Q();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(s2(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(j.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(h=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function s2(n,e,t){let r=Q(),i=Q();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Lt();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(j.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):R($S,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function _7(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=m7?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function C7(n,e){return g(this,null,function*(){let t=M(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>m.forEach(e,i=>m.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>m.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(_i(r))R($S,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function b7(n,e){let t=M(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=ui),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function I7(n,e){let t=M(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function na(n,e){let t=M(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new ea(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function A7(n,e,t){let r=M(n),i=r.targetIdByTarget.get(t);return i!==void 0?m.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function ra(n,e,t){return g(this,null,function*(){let r=M(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(_i(o))R($S,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function bf(n,e,t){let r=M(n),i=j.min(),s=Q();return r.persistence.runTransaction("Execute query","readwrite",o=>A7(r,o,Dt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:j.min(),t?s:Q())).next(a=>(l2(r,mR(e),a),{documents:a,remoteKeys:s})))}function R7(n,e,t,r){let i=t.batch,s=i.keys(),o=m.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);U(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function D7(n,e){let t=M(n),r=M(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):m.resolve(null)))}function k7(n,e){M(M(n,ac).mutationQueue).removeCachedMutationKeys(e)}function N7(n){return M(M(n,ac).persistence).getActiveClients()}function o2(n,e){let t=M(n),r=M(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function a2(n,e){let t=M(n),r=t.collectionGroupReadTime.get(e)||j.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,MA(r,Ho),Number.MAX_SAFE_INTEGER)).then(i=>(l2(t,e,i),i))}function l2(n,e,t){let r=n.collectionGroupReadTime.get(e)||j.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function O7(n){return Dt(fa(ne.fromString(`__bundle__/docs/${n}`)))}function x7(n,e,t,r){return g(this,null,function*(){let i=M(n),s=Q(),o=Lt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let h=e.toMutableDocument(c);h.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,h)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield na(i,O7(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>s2(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function M7(n,e){let t=M(n),r=Be(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function P7(n,e){let t=M(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function L7(n,e){let t=M(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function F7(r,i){return g(this,arguments,function*(n,e,t=Q()){let s=yield na(n,Dt(zS(e.bundledQuery))),o=M(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=Be(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(tt.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var B0=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var B7=100;function q7(){return Qf()?8:gr.getAndroidVersion(ba())>0?6:4}var Wd=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=B7,this.relativeIndexReadCostPerDocument=q7()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new B0;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Fo()<=Rn.DEBUG&&R("QueryEngine","SDK will not create cache indexes for query:",Bo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),m.resolve()):(Fo()<=Rn.DEBUG&&R("QueryEngine","Query:",Bo(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Fo()<=Rn.DEBUG&&R("QueryEngine","The SDK decides to create cache indexes for query:",Bo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Dt(t))):m.resolve())}performQueryUsingIndex(e,t){if(MI(t))return m.resolve(null);let r=Dt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Md(t,null,"F"),r=Dt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Q(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,Md(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return MI(t)||i.isEqual(j.min())?m.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?m.resolve(null):(Fo()<=Rn.DEBUG&&R("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Bo(t)),this.appendRemainingResults(e,o,t,MA(i,Ho)).next(a=>a))})}applyQuery(e,t){let r=new fe(yR(e));return t.forEach((i,s)=>{wc(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Fo()<=Rn.DEBUG&&R("QueryEngine","Using full collection scan to execute query:",Bo(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,an.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var c2="firestore_clients";function pA(n,e){return`${c2}_${n}_${e}`}var u2="firestore_mutations";function gA(n,e,t){let r=`${u2}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var h2="firestore_targets";function bv(n,e){return`${h2}_${n}_${e}`}var U7="firestore_online_state";function V7(n){return`${U7}_${n}`}var z7="firestore_bundle_loaded_v2";function j7(n){return`${z7}_${n}`}var G7="firestore_sequence_number";function K7(n){return`${G7}_${n}`}var Wn="SharedClientState",Qd=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new _(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Ie(Wn,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},zl=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new _(r.error.code,r.error.message))),i?new n(e,r.state,s):(Ie(Wn,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Yd=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=US();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=nR(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Ie(Wn,`Failed to parse client data for instance '${e}': ${t}`),null)}},q0=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ie(Wn,`Failed to parse online state: ${e}`),null)}},lc=class{constructor(){this.activeTargetIds=US()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},jl=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Te(W),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=pA(this.persistenceKey,this.localClientId),this.sequenceNumberKey=K7(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new lc),this.clientStateKeyRe=new RegExp(`^${c2}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${u2}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${h2}_${o}_(\\d+)$`),this.onlineStateKey=V7(this.persistenceKey),this.bundleLoadedKey=j7(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return g(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(pA(this.persistenceKey,r));if(i){let s=Yd.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(bv(this.persistenceKey,e));if(r){let i=zl.fromWebStorageEntry(e,r);i&&(t=i.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(bv(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return R(Wn,"READ",e,t),t}setItem(e,t){R(Wn,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){R(Wn,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(R(Wn,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Ie("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>g(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=H7(t.newValue);r!==jt.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new Qd(this.currentUser,e,t,r),s=gA(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=gA(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=bv(this.persistenceKey,e),s=new zl(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return Yd.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Qd.fromWebStorageEntry(new Ke(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return zl.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return q0.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return g(this,null,function*(){if(e.user.uid!==this.currentUser.uid){R(Wn,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=US();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function H7(n){let e=jt.INVALID;if(n!=null)try{let t=JSON.parse(n);U(typeof t=="number"),e=t}catch(t){Ie(Wn,"Failed to read sequence number from WebStorage",t)}return e}var Xd=class{constructor(){this.localState=new lc,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new lc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var U0=class{addCallback(e){}shutdown(){}};var V0=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var yd=null;function $7(){return 268435456+Math.round(2147483648*Math.random())}function Iv(){return yd===null?yd=$7():yd++,"0x"+yd.toString(16)}function W7(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var Q7="1.9.1",At="GrpcConnection",Y7=`gl-node/${process.versions.node} fire/${ca} grpc/${Q7}`;function Av(n,e,t,r){U(e===null||e.type==="OAuth");let i=new ns.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",Y7),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var z0=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){R(At,"Creating Firestore stub.");let e=this.databaseInfo.ssl?ns.credentials.createSsl():ns.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=Iv(),a=this.ensureActiveStub(),l=Av(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return W7(u=>(R(At,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(h,d)=>{h?(R(At,`RPC '${e}' ${o} failed with error:`,h),u(new _(Ed(h.code),h.message))):(R(At,`RPC '${e}' ${o} completed with response:`,d),u(void 0,d))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=Iv(),l=[],c=new Fe;R(At,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),h=Av(this.databasePath,i,s,this.databaseInfo.appId),d=Object.assign(Object.assign({},r),{database:this.databasePath}),p=u[e](d,h),y=!1;return p.on("data",S=>{R(At,`RPC ${e} ${a} received result:`,S),l.push(S),o!==void 0&&l.length===o&&(y=!0,c.resolve(l))}),p.on("end",()=>{R(At,`RPC '${e}' ${a} completed.`),y||(y=!0,c.resolve(l))}),p.on("error",S=>{R(At,`RPC '${e}' ${a} failed with error:`,S);let T=Ed(S.code);c.reject(new _(T,S.message))}),c.promise}openStream(e,t,r){let i=Iv(),s=this.ensureActiveStub(),o=Av(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=h=>{l||(l=!0,u.callOnClose(h),a.end())},u=new V0({sendFn:h=>{if(l)R(At,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,h);else{R(At,`RPC '${e}' stream ${i} sending:`,h);try{a.write(h)}catch(d){throw Ie("Failure sending:",h),Ie("Error:",d),d}}},closeFn:()=>{R(At,`RPC '${e}' stream ${i} closed locally via close().`),c()}});return a.on("data",h=>{l||(R(At,`RPC '${e}' stream ${i} received:`,h),u.callOnMessage(h))}),a.on("end",()=>{R(At,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",h=>{if(!l){on(At,`RPC '${e}' stream ${i} error. Code:`,h.code,"Message:",h.message);let d=Ed(h.code);c(new _(d,h.message))}}),R(At,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},d2={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},X7={nested:d2},J7=Object.freeze({__proto__:null,nested:d2,default:X7});var Z7={longs:String,enums:String,defaults:!0,oneofs:!1};function eq(){let n=kA.fromJSON(J7,Z7);return ns.loadPackageDefinition(n)}function tq(n){let e=eq();return new z0(e,n)}function nq(){return new U0}function f2(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function rq(){return null}function _c(n){return new c0(n,!1)}var iq="ExponentialBackoff",sq=1e3,oq=1.5,aq=60*1e3,cc=class{constructor(e,t,r=sq,i=oq,s=aq){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&R(iq,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var mA="PersistentStream",lq=60*1e3,cq=10*1e3,Jd=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new cc(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return g(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,lq,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return g(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return g(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===v.RESOURCE_EXHAUSTED?(Ie(t.toString()),Ie("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===v.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new _(v.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,cq,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>g(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return R(mA,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(R(mA,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},j0=class extends Jd{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=w5(this.serializer,e),r=_5(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=d0(this.serializer),t.addTarget=M5(this.serializer,e);let r=O5(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=d0(this.serializer),t.removeTarget=e,this.sendRequest(t)}},G0=class extends Jd{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(U(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=A5(e.writeResults,e.commitTime),r=Be(e.commitTime);return this.listener.onMutationResult(r,t)}else return U(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=d0(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>ic(this.serializer,r))};this.sendRequest(t)}};var K0=class{},H0=class extends K0{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new _(v.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,h0(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new _(v.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,h0(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new _(v.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function uq(n,e,t,r){return new H0(n,e,t,r)}function hq(n,e){return g(this,null,function*(){let t=M(n),r={writes:e.map(i=>ic(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,ne.emptyPath(),r)})}function dq(n,e){return g(this,null,function*(){let t=M(n),r={documents:e.map(a=>rc(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,ne.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=T5(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());U(!!l),o.push(l)}),o})}function fq(n,e,t){let r=M(n);return r.verifyInitialized(),new G0(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function pq(n,e,t){let r=M(n);return r.verifyInitialized(),new j0(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var gq="OnlineStateTracker",yA=1,vA=10*1e3,$0=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",vA,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${vA/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=yA&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${yA} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Ie(t),this.shouldWarnClientIsOffline=!1):R(gq,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var ds="RemoteStore",mq=10,W0=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>g(this,null,function*(){Ci(this)&&(R(ds,"Restarting streams for network reachability change."),yield xq(this))}))}),this.onlineStateTracker=new $0(r,i)}};function yq(n,e,t,r,i){return new W0(n,e,t,r,i)}function vq(n){let e=M(n);return e.offlineCauses.delete(0),Cc(e)}function Cc(n){return g(this,null,function*(){if(Ci(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function Sq(n){return g(this,null,function*(){let e=M(n);e.offlineCauses.add(0),yield pa(e),e.onlineStateTracker.set("Offline")})}function pa(n){return g(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function Tq(n){return g(this,null,function*(){let e=M(n);R(ds,"RemoteStore shutting down."),e.offlineCauses.add(5),yield pa(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function If(n,e){let t=M(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),YS(t)?QS(t):ya(t).isOpen()&&WS(t,e))}function ga(n,e){let t=M(n),r=ya(t);t.listenTargets.delete(e),r.isOpen()&&p2(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Ci(t)&&t.onlineStateTracker.set("Unknown"))}function WS(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ya(n).watch(e)}function p2(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),ya(n).unwatch(e)}function QS(n){n.watchChangeAggregator=new l0({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),ya(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function YS(n){return Ci(n)&&!ya(n).isStarted()&&n.listenTargets.size>0}function Ci(n){return M(n).offlineCauses.size===0}function g2(n){n.watchChangeAggregator=void 0}function wq(n){return g(this,null,function*(){n.listenTargets.forEach((e,t)=>{WS(n,e)})})}function Eq(n,e){return g(this,null,function*(){g2(n),YS(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),QS(n)):n.onlineStateTracker.set("Unknown")})}function _q(n,e,t){return g(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof Ld&&e.state===2&&e.cause){try{yield bq(n,e)}catch(r){R(ds,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Zd(n,r)}return}if(e instanceof Ko?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Pd?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(j.min()))try{let r=yield i2(n.localStore);t.compareTo(r)>=0&&(yield Cq(n,t))}catch(r){R(ds,"Failed to raise snapshot:",r),yield Zd(n,r)}})}function Zd(n,e,t){return g(this,null,function*(){if(_i(e))n.offlineCauses.add(1),yield pa(n),n.onlineStateTracker.set("Offline"),t||(t=()=>i2(n.localStore)),n.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){R(ds,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Cc(n)}));else throw e})}function m2(n,e){return e().catch(t=>Zd(n,t,e))}function Cq(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(tt.EMPTY_BYTE_STRING,s.snapshotVersion)),p2(n,r);let o=new ea(s.target,r,i,s.sequenceNumber);WS(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function bq(n,e){return g(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function ma(n){return g(this,null,function*(){let e=M(n),t=bi(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:ui;for(;Iq(e);)try{let i=yield b7(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,Aq(e,i)}catch(i){yield Zd(e,i)}y2(e)&&v2(e)})}function Iq(n){return Ci(n)&&n.writePipeline.length<mq}function Aq(n,e){n.writePipeline.push(e);let t=bi(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function y2(n){return Ci(n)&&!bi(n).isStarted()&&n.writePipeline.length>0}function v2(n){bi(n).start()}function Rq(n){return g(this,null,function*(){bi(n).writeHandshake()})}function Dq(n){return g(this,null,function*(){let e=bi(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function kq(n,e,t){return g(this,null,function*(){let r=n.writePipeline.shift(),i=i0.from(r,e,t);yield m2(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield ma(n)})}function Nq(n,e){return g(this,null,function*(){e&&bi(n).handshakeComplete&&(yield Oq(n,e)),y2(n)&&v2(n)})}function Oq(n,e){return g(this,null,function*(){if(r5(e.code)){let t=n.writePipeline.shift();bi(n).inhibitBackoff(),yield m2(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield ma(n)}})}function xq(n){return g(this,null,function*(){let e=M(n);e.offlineCauses.add(4),yield pa(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Cc(e)})}function SA(n,e){return g(this,null,function*(){let t=M(n);t.asyncQueue.verifyOperationInProgress(),R(ds,"RemoteStore received new credentials");let r=Ci(t);t.offlineCauses.add(3),yield pa(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Cc(t)})}function Q0(n,e){return g(this,null,function*(){let t=M(n);e?(t.offlineCauses.delete(2),yield Cc(t)):e||(t.offlineCauses.add(2),yield pa(t),t.onlineStateTracker.set("Unknown"))})}function ya(n){return n.watchStream||(n.watchStream=pq(n.datastore,n.asyncQueue,{onOpen:wq.bind(null,n),onClose:Eq.bind(null,n),onWatchChange:_q.bind(null,n)}),n.onNetworkStatusChange.push(e=>g(this,null,function*(){e?(n.watchStream.inhibitBackoff(),YS(n)?QS(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),g2(n))}))),n.watchStream}function bi(n){return n.writeStream||(n.writeStream=fq(n.datastore,n.asyncQueue,{onOpen:Rq.bind(null,n),onClose:Nq.bind(null,n),onHandshakeComplete:Dq.bind(null,n),onMutationResult:kq.bind(null,n)}),n.onNetworkStatusChange.push(e=>g(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield ma(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(R(ds,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var Mq="AsyncQueue",Y0=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Fe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new _(v.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function va(n,e){if(Ie(Mq,`${e}: ${n}`),_i(n))return new _(v.UNAVAILABLE,`${e}: ${n}`);throw n}var ef=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||x.comparator(t.key,r.key):this.comparator=(t,r)=>x.comparator(t.key,r.key),this.keyedMap=Ll(),this.sortedSet=new Te(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var tf=class{constructor(){this.changeMap=new Te(x.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):F()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},ia=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,ef.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Tc(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var X0=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function Pq(){return new J0}var J0=class{constructor(){this.queries=new er(e=>gR(e),Tc),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function XS(n,e){return g(this,null,function*(){let t=M(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new X0,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=va(o,`Initialization of query '${Bo(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&ZS(t)})}function JS(n,e){return g(this,null,function*(){let t=M(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function Lq(n,e){let t=M(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&ZS(t)}function Fq(n,e,t){let r=M(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function Bq(n,e){let t=M(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&ZS(t)}function qq(n,e){M(n).snapshotsInSyncListeners.add(e),e.next()}function Uq(n,e){M(n).snapshotsInSyncListeners.delete(e)}function ZS(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var S2=function(n){return n.Default="default",n.Cache="cache",n}(S2||{}),uc=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ia(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=ia.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==S2.Cache}};var Z0=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=Q(),i=Q();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var nf=class{constructor(e){this.serializer=e}toDocumentKey(e){return Xn(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?qR(this.serializer,e.document,!1):Ge.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return Be(e)}},eS=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=T2(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=ne.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new nf(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||Q()).add(s);t.set(o,a)}}return t}complete(){return g(this,null,function*(){let e=yield x7(this.localStore,new nf(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield F7(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function T2(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function Vq(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var rf=class{constructor(e){this.key=e}},sf=class{constructor(e){this.key=e}},of=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=Q(),this.mutatedKeys=Q(),this.docComparator=yR(e),this.documentSet=new ef(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new tf,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,h)=>{let d=i.get(u),p=wc(this.query,h)?h:null,y=d?this.mutatedKeys.has(d.key):!1,S=p?p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations:!1,T=!1;d&&p?d.data.isEqual(p.data)?y!==S&&(r.track({type:3,doc:p}),T=!0):this.shouldWaitForSyncedDocument(d,p)||(r.track({type:2,doc:p}),T=!0,(l&&this.docComparator(p,l)>0||c&&this.docComparator(p,c)<0)&&(a=!0)):!d&&p?(r.track({type:0,doc:p}),T=!0):d&&!p&&(r.track({type:1,doc:d}),T=!0,(l||c)&&(a=!0)),T&&(p?(o=o.add(p),S?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((h,d)=>zq(h.type,d.type)||this.docComparator(h.doc,d.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new ia(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new tf,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=Q(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new sf(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new rf(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=Q();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return ia.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function zq(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return F()}};return t(n)-t(e)}var Ii="SyncEngine",tS=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},nS=class{constructor(e){this.key=e,this.receivedDocument=!1}},rS=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new er(a=>gR(a),Tc),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Te(x.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new oc,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ta.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function jq(n,e,t,r,i,s,o){let a=new rS(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function Gq(n,e,t=!0){return g(this,null,function*(){let r=Af(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield w2(r,e,t,!0),i})}function Kq(n,e){return g(this,null,function*(){let t=Af(n);yield w2(t,e,!0,!1)})}function w2(n,e,t,r){return g(this,null,function*(){let i=yield na(n.localStore,Dt(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield eT(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&If(n.remoteStore,i),a})}function eT(n,e,t,r,i){return g(this,null,function*(){n.applyDocChanges=(h,d,p)=>n8(n,h,d,p);let s=yield bf(n.localStore,e,!0),o=new of(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=nc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);rT(n,t,c.limboChanges);let u=new tS(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function Hq(n,e,t){return g(this,null,function*(){let r=M(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!Tc(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield ra(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&ga(r.remoteStore,i.targetId),sa(r,i.targetId)}).catch(Ei))):(sa(r,i.targetId),yield ra(r.localStore,i.targetId,!0))})}function $q(n,e){return g(this,null,function*(){let t=M(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ga(t.remoteStore,r.targetId))})}function Wq(n,e,t){return g(this,null,function*(){let r=sT(n);try{let i=yield y7(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),e8(r,i.batchId,t),yield wr(r,i.changes),yield ma(r.remoteStore)}catch(i){let s=va(i,"Failed to persist write");t.reject(s)}})}function E2(n,e){return g(this,null,function*(){let t=M(n);try{let r=yield E7(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(U(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?U(o.receivedDocument):i.removedDocuments.size>0&&(U(o.receivedDocument),o.receivedDocument=!1))}),yield wr(t,r,e)}catch(r){yield Ei(r)}})}function TA(n,e,t){let r=M(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),Bq(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Qq(n,e,t){return g(this,null,function*(){let r=M(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Te(x.comparator);o=o.insert(s,Ge.newNoDocument(s,j.min()));let a=Q().add(s),l=new tc(j.min(),new Map,new Te(W),o,a);yield E2(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),iT(r)}else yield ra(r.localStore,e,!1).then(()=>sa(r,e,t)).catch(Ei)})}function Yq(n,e){return g(this,null,function*(){let t=M(n),r=e.batch.batchId;try{let i=yield v7(t.localStore,e);nT(t,r,null),tT(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield wr(t,i)}catch(i){yield Ei(i)}})}function Xq(n,e,t){return g(this,null,function*(){let r=M(n);try{let i=yield T7(r.localStore,e);nT(r,e,t),tT(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield wr(r,i)}catch(i){yield Ei(i)}})}function Jq(n,e){return g(this,null,function*(){let t=M(n);Ci(t.remoteStore)||R(Ii,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield w7(t.localStore);if(r===ui){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=va(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function tT(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function Zq(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new _(v.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function e8(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Te(W)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function nT(n,e,t){let r=M(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function sa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||_2(n,i)})}function _2(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(ga(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),iT(n))}function rT(n,e,t){for(let r of t)r instanceof rf?(n.limboDocumentRefs.addReference(r.key,e),t8(n,r)):r instanceof sf?(R(Ii,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||_2(n,r.key)):F()}function t8(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(R(Ii,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),iT(n))}function iT(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new x(ne.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new nS(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),If(n.remoteStore,new ea(Dt(fa(t.path)),r,"TargetPurposeLimboResolution",jt.INVALID))}}function wr(n,e,t){return g(this,null,function*(){let r=M(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let u=Z0.fromSnapshot(l.targetId,c);s.push(u)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield C7(r.localStore,s))})}function n8(n,e,t,r){return g(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield bf(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return rT(n,e.targetId,a.limboChanges),a.snapshot})}function r8(n,e){return g(this,null,function*(){let t=M(n);if(!t.currentUser.isEqual(e)){R(Ii,"User change. New user:",e.toKey());let i=yield r2(t.localStore,e);t.currentUser=e,Zq(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield wr(t,i.affectedDocuments)}})}function i8(n,e){let t=M(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return Q().add(r.key);{let i=Q(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function s8(n,e){return g(this,null,function*(){let t=M(n),r=yield bf(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&rT(t,e.targetId,i.limboChanges),i})}function o8(n,e){return g(this,null,function*(){let t=M(n);return a2(t.localStore,e).then(r=>wr(t,r))})}function a8(n,e,t,r){return g(this,null,function*(){let i=M(n),s=yield D7(i.localStore,e);if(s===null){R(Ii,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield ma(i.remoteStore):t==="acknowledged"||t==="rejected"?(nT(i,e,r||null),tT(i,e),k7(i.localStore,e)):F(),yield wr(i,s)})}function l8(n,e){return g(this,null,function*(){let t=M(n);if(Af(t),sT(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield wA(t,r.toArray());t._isPrimaryClient=!0,yield Q0(t.remoteStore,!0);for(let s of i)If(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(sa(t,o),ra(t.localStore,o,!0))),ga(t.remoteStore,o)}),yield i,yield wA(t,r),c8(t),t._isPrimaryClient=!1,yield Q0(t.remoteStore,!1)}})}function c8(n){let e=M(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{ga(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Te(x.comparator)}function wA(n,e,t){return g(this,null,function*(){let r=M(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield na(r.localStore,Dt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),h=yield s8(r,u);h.snapshot&&s.push(h.snapshot)}}else{let c=yield o2(r.localStore,o);a=yield na(r.localStore,c),yield eT(r,C2(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function C2(n){return pR(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function u8(n){let e=M(n);return N7(e.localStore)}function h8(n,e,t,r){return g(this,null,function*(){let i=M(n);if(i._isPrimaryClient){R(Ii,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield a2(i.localStore,mR(s[0])),a=tc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",tt.EMPTY_BYTE_STRING);yield wr(i,o,a);break}case"rejected":{yield ra(i.localStore,e,!0),sa(i,e,r);break}default:F()}})}function d8(n,e,t){return g(this,null,function*(){let r=Af(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){R(Ii,"Adding an already active target "+i);continue}let o=yield o2(r.localStore,i),a=yield na(r.localStore,o);yield eT(r,C2(o),a.targetId,!1,a.resumeToken),If(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield ra(r.localStore,i,!1).then(()=>{ga(r.remoteStore,i),sa(r,i)}).catch(Ei))}})}function Af(n){let e=M(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=E2.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=i8.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Qq.bind(null,e),e.syncEngineListener.onWatchChange=Lq.bind(null,e.eventManager),e.syncEngineListener.onWatchError=Fq.bind(null,e.eventManager),e}function sT(n){let e=M(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Yq.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Xq.bind(null,e),e}function f8(n,e,t){let r=M(n);p8(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function p8(n,e,t){return g(this,null,function*(){try{let r=yield e.getMetadata();if(yield M7(n.localStore,r))return yield e.close(),t._completeWith(Vq(r)),Promise.resolve(new Set);t._updateProgress(T2(r));let s=new eS(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield wr(n,a.changedDocs,void 0),yield P7(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return on(Ii,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var hc=class{constructor(){this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){this.serializer=_c(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return n2(this.persistence,new Wd,e.initialUser,this.serializer)}createPersistence(e){return new Hd($d.factory,this.serializer)}createSharedClientState(e){return new Xd}terminate(){return g(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var af=class n extends hc{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){yield zf(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield sT(this.onlineComponentProvider.syncEngine),yield ma(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return n2(this.persistence,new Wd,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new _0(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new qv(t,this.persistence);return new Bv(e.asyncQueue,r)}createPersistence(e){let t=HS(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?sn.withCacheSize(this.cacheSizeBytes):sn.DEFAULT;return new F0(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,f2(),rq(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Xd}},iS=class n extends af{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return g(this,null,function*(){yield zf(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof jl&&(this.sharedClientState.syncEngine={applyBatchState:a8.bind(null,t),applyTargetState:h8.bind(null,t),applyActiveTargetsChange:d8.bind(null,t),getActiveClients:u8.bind(null,t),synchronizeWithChangedDocuments:o8.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>g(this,null,function*(){yield l8(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=f2();if(!jl.isAvailable(t))throw new _(v.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=HS(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new jl(t,e.asyncQueue,r,e.clientId,e.initialUser)}},dc=class{initialize(e,t){return g(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>TA(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=r8.bind(null,this.syncEngine),yield Q0(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return Pq()}createDatastore(e){let t=_c(e.databaseInfo.databaseId),r=tq(e.databaseInfo);return uq(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return yq(this.localStore,this.datastore,e.asyncQueue,t=>TA(this.syncEngine,t,0),nq())}createSyncEngine(e,t){return jq(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return g(this,null,function*(){var e;yield Tq(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var g8=10240;function m8(n,e=g8){let t=0;return{read(){return g(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return g(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function oT(n,e,t){if(!t)throw new _(v.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function aT(n,e,t,r){if(e===!0&&r===!0)throw new _(v.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function EA(n){if(!x.isDocumentKey(n))throw new _(v.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _A(n){if(x.isDocumentKey(n))throw new _(v.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function y8(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function bc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=v8(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":F()}function v8(n){return n.constructor?n.constructor.name:null}function re(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new _(v.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=bc(n);throw new _(v.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function b2(n,e){if(e<=0)throw new _(v.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function S8(n,e){if(!(n instanceof Uint8Array))throw new _(v.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${bc(n)}`);return m8(n,e)}var oa=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):Ie("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var sS=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var oS=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new Fe,this.buffer=new Uint8Array,this.textDecoder=i5(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return g(this,null,function*(){return this.metadata.promise})}nextElement(){return g(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return g(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new sS(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return g(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return g(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return g(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function T8(n,e){return new oS(n,e)}var aS=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new _(v.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield dq(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Si(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=x.fromPath(r);this.mutations.push(new Jl(i,this.precondition(i)))}),yield hq(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=j.min();else throw F();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new _(v.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(j.min())?Oe.exists(!1):Oe.updateTime(t):Oe.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(j.min()))throw new _(v.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Oe.updateTime(t)}else return Oe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var lS=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new cc(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>g(this,null,function*(){let e=new aS(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return vc(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!OR(t)}return!1}};var Ti="FirestoreClient",w8=100,E8=11,_8=20,C8=22,cS=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ke.UNAUTHENTICATED,this.clientId=bd.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>g(this,null,function*(){R(Ti,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(R(Ti,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:w8}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _(v.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Fe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=va(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function _d(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),R(Ti,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>g(this,null,function*(){r.isEqual(i)||(yield r2(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function uS(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield lT(n);R(Ti,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>SA(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>SA(e.remoteStore,i)),n._onlineComponents=e})}function I2(n){return n.name==="FirebaseError"?n.code===v.FAILED_PRECONDITION||n.code===v.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===C8||n.code===_8||n.code===E8:!0}function lT(n){return g(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){R(Ti,"Using user provided OfflineComponentProvider");try{yield _d(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!I2(t))throw t;on("Error using user provided cache. Falling back to memory cache: "+t),yield _d(n,new hc)}}else R(Ti,"Using default OfflineComponentProvider"),yield _d(n,new hc);return n._offlineComponents})}function Rf(n){return g(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(R(Ti,"Using user provided OnlineComponentProvider"),yield uS(n,n._uninitializedComponentsProvider._online)):(R(Ti,"Using default OnlineComponentProvider"),yield uS(n,new dc))),n._onlineComponents})}function A2(n){return lT(n).then(e=>e.persistence)}function cT(n){return lT(n).then(e=>e.localStore)}function R2(n){return Rf(n).then(e=>e.remoteStore)}function uT(n){return Rf(n).then(e=>e.syncEngine)}function b8(n){return Rf(n).then(e=>e.datastore)}function aa(n){return g(this,null,function*(){let e=yield Rf(n),t=e.eventManager;return t.onListen=Gq.bind(null,e.syncEngine),t.onUnlisten=Hq.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Kq.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=$q.bind(null,e.syncEngine),t})}function I8(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield A2(n),t=yield R2(n);return e.setNetworkEnabled(!0),vq(t)}))}function A8(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield A2(n),t=yield R2(n);return e.setNetworkEnabled(!1),Sq(t)}))}function R8(n){let e=new Fe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let t=yield uT(n);return Jq(t,e)})),e.promise}function D8(n,e,t,r){let i=new oa(r),s=new uc(e,i,t);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let o=yield aa(n);return XS(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let o=yield aa(n);return JS(o,s)}))}}function k8(n,e){let t=new Fe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield cT(n);return P8(r,e,t)})),t.promise}function D2(n,e,t={}){let r=new Fe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield aa(n);return L8(i,n.asyncQueue,e,t,r)})),r.promise}function N8(n,e){let t=new Fe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield cT(n);return F8(r,e,t)})),t.promise}function k2(n,e,t={}){let r=new Fe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield aa(n);return B8(i,n.asyncQueue,e,t,r)})),r.promise}function O8(n,e){let t=new Fe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield uT(n);return Wq(r,e,t)})),t.promise}function x8(n,e){let t=new oa(e);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield aa(n);return qq(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield aa(n);return Uq(r,t)}))}}function M8(n,e,t){let r=new Fe;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield b8(n);new lS(n.asyncQueue,i,t,e,r).run()})),r.promise}function P8(n,e,t){return g(this,null,function*(){try{let r=yield I7(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new _(v.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=va(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function L8(n,e,t,r,i){let s=new oa({next:a=>{e.enqueueAndForget(()=>JS(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new _(v.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new _(v.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new uc(fa(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return XS(n,o)}function F8(n,e,t){return g(this,null,function*(){try{let r=yield bf(n,e,!0),i=new of(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=va(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function B8(n,e,t,r,i){let s=new oa({next:a=>{e.enqueueAndForget(()=>JS(n,o)),a.fromCache&&r.source==="server"?i.reject(new _(v.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new uc(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return XS(n,o)}function q8(n,e,t,r){let i=V8(t,_c(e));n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){f8(yield uT(n),i,r)}))}function U8(n,e){return n.asyncQueue.enqueue(()=>g(this,null,function*(){return L7(yield cT(n),e)}))}function V8(n,e){let t;return typeof n=="string"?t=xR().encode(n):t=n,T8(S8(t),e)}function z8(n,e){return n.timeoutSeconds===e.timeoutSeconds}function N2(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var j8="ComponentProvider",CA=new Map;function G8(n){let e=CA.get(n);e&&(R(j8,"Removing Datastore"),CA.delete(n),e.terminate())}function K8(n,e,t,r){return new Kv(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,N2(r.experimentalLongPollingOptions),r.useFetchStreams)}var O2="firestore.googleapis.com",bA=!0,IA=5,AA=30,H8=!0,lf=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new _(v.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=O2,this.ssl=bA}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:bA;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ZR;else{if(e.cacheSizeBytes!==Ec&&e.cacheSizeBytes<lA)throw new _(v.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${lA}`);this.cacheSizeBytes=e.cacheSizeBytes}aT("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=H8:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=N2((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),$8(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&z8(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function $8(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new _(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<IA)throw new _(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${IA})`);if(n.timeoutSeconds>AA)throw new _(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${AA})`)}}var fs=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new _(v.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new _(v.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lf(e),e.credentials!==void 0&&(this._authCredentials=GF(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return G8(this),Promise.resolve()}};function x2(n,e,t,r={}){var i;n=re(n,fs);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==O2&&s.host!==o&&on("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Ke.MOCK_USER;else{a=ow(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new _(v.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Ke(c)}n._authCredentials=new Dv(new Cd(a,l))}}var ot=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ye=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Jn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Jn=class n extends ot{constructor(e,t,r){super(e,t,fa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ye(this.firestore,null,new x(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function hT(n,e,...t){if(n=be(n),oT("collection","path",e),n instanceof fs){let r=ne.fromString(e,...t);return _A(r),new Jn(n,null,r)}else{if(!(n instanceof ye)&&!(n instanceof Jn))throw new _(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ne.fromString(e,...t));return _A(r),new Jn(n.firestore,null,r)}}function M2(n,e){if(n=re(n,fs),oT("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new _(v.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ot(n,null,IB(e))}function Ic(n,e,...t){if(n=be(n),arguments.length===1&&(e=bd.newId()),oT("doc","path",e),n instanceof fs){let r=ne.fromString(e,...t);return EA(r),new ye(n,null,new x(r))}else{if(!(n instanceof ye)&&!(n instanceof Jn))throw new _(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ne.fromString(e,...t));return EA(r),new ye(n.firestore,n instanceof Jn?n.converter:null,new x(r))}}function dT(n,e){return n=be(n),e=be(e),(n instanceof ye||n instanceof Jn)&&(e instanceof ye||e instanceof Jn)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function fT(n,e){return n=be(n),e=be(e),n instanceof ot&&e instanceof ot?n.firestore===e.firestore&&Tc(n._query,e._query)&&n.converter===e.converter:!1}var W8="AsyncQueue",hS=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new cc(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new Fe;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return g(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(_i(e))R(W8,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=Y8(r);throw Ie("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=Y0.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&F()}verifyOperationInProgress(){}drain(){return g(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function Q8(){return new hS}function Y8(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var dS=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Fe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var P2=Ec,Ce=class extends fs{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=Q8(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||L2(this),this._firestoreClient.terminate()}};function We(n){return n._firestoreClient||L2(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function L2(n){var e,t,r;let i=n._freezeSettings(),s=K8(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new cS(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function F2(n,e){n=re(n,Ce),H2(n);let t=We(n);if(t._uninitializedComponentsProvider)throw new _(v.FAILED_PRECONDITION,"SDK cache is already specified.");on("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new dc,s=new af(i,r.cacheSizeBytes,e?.forceOwnership);return q2(t,i,s)}function B2(n){n=re(n,Ce),H2(n);let e=We(n);if(e._uninitializedComponentsProvider)throw new _(v.FAILED_PRECONDITION,"SDK cache is already specified.");on("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new dc,i=new iS(r,t.cacheSizeBytes);return q2(e,r,i)}function q2(n,e,t){let r=new Fe;return n.asyncQueue.enqueue(()=>g(this,null,function*(){try{yield _d(n,t),yield uS(n,e),r.resolve()}catch(i){let s=i;if(!I2(s))throw s;on("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function U2(n){if(n._initialized&&!n._terminated)throw new _(v.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Fe;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{yield g7(HS(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function V2(n){n=re(n,Ce);let e=We(n);return R8(e)}function z2(n){n=re(n,Ce);let e=We(n);return I8(e)}function j2(n){n=re(n,Ce);let e=We(n);return A8(e)}function G2(n,e){n=re(n,Ce);let t=We(n),r=new dS;return q8(t,n._databaseId,e,r),r}function K2(n,e){n=re(n,Ce);let t=We(n);return U8(t,e).then(r=>r?new ot(n,null,r.query):null)}function H2(n){if(n._initialized||n._terminated)throw new _(v.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function X8(n,e=!0){zF(cw),Ia(new Di("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Ce(new kv(t.getProvider("auth-internal")),new Mv(t.getProvider("app-check-internal")),q6(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Ar(SI,TI,n),Ar(SI,TI,"esm2017")}var tr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(tt.fromBase64String(e))}catch(t){throw new _(v.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var In=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new _(v.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var vr=class{constructor(e){this._methodName=e}};var ps=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new _(v.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new _(v.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}};var J8=/^__.*__$/,fS=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new bn(e,this.data,this.fieldMask,t,this.fieldTransforms):new vi(e,this.data,t,this.fieldTransforms)}},cf=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new bn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function $2(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F()}}var uf=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return hf(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if($2(this.dataSource)&&J8.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},pS=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||_c(e)}createContext(e,t,r,i=!1){return new uf({dataSource:e,methodName:t,targetDoc:r,path:qe.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ss(n){let e=n._freezeSettings(),t=_c(n._databaseId);return new pS(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Df(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);mT("Data must be an object, but it was:",o,r);let a=Y2(r,o),l,c;if(s.merge)l=new Gt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let h of s.mergeFields){let d=SS(e,h,t);if(!o.contains(d))throw new _(v.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);J2(u,d)||u.push(d)}l=new Gt(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new fS(new yt(a),l,c)}var fc=class n extends vr{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function W2(n,e,t){return new uf({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var gS=class n extends vr{_toFieldTransform(e){return new cs(e.path,new mi)}isEqual(e){return e instanceof n}},mS=class n extends vr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=W2(this,e,!0),r=this._elements.map(s=>Ts(s,t)),i=new mr(r);return new cs(e.path,i)}isEqual(e){return e instanceof n&&Yf(this._elements,e._elements)}},yS=class n extends vr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=W2(this,e,!0),r=this._elements.map(s=>Ts(s,t)),i=new yr(r);return new cs(e.path,i)}isEqual(e){return e instanceof n&&Yf(this._elements,e._elements)}},vS=class n extends vr{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new yi(e.serializer,_R(e.serializer,this._operand));return new cs(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function pT(n,e,t,r){let i=n.createContext(1,e,t);mT("Data must be an object, but it was:",i,r);let s=[],o=yt.empty();vs(r,(l,c)=>{let u=yT(e,l,t);c=be(c);let h=i.childContextForFieldPath(u);if(c instanceof fc)s.push(u);else{let d=Ts(c,h);d!=null&&(s.push(u),o.set(u,d))}});let a=new Gt(s);return new cf(o,a,i.fieldTransforms)}function gT(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[SS(e,r,t)],l=[i];if(s.length%2!==0)throw new _(v.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(SS(e,s[d])),l.push(s[d+1]);let c=[],u=yt.empty();for(let d=a.length-1;d>=0;--d)if(!J2(c,a[d])){let p=a[d],y=l[d];y=be(y);let S=o.childContextForFieldPath(p);if(y instanceof fc)c.push(p);else{let T=Ts(y,S);T!=null&&(c.push(p),u.set(p,T))}}let h=new Gt(c);return new cf(u,h,o.fieldTransforms)}function Q2(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Ts(t,i)}function Ts(n,e){if(n=be(n),X2(n))return mT("Unsupported field value:",e,n),Y2(n,e);if(n instanceof vr)return eU(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return Z8(n,e)}else return tU(n,e)}function Y2(n,e){let t={};return YA(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vs(n,(r,i)=>{let s=Ts(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Z8(n,e){let t=[],r=0;for(let i of n){let s=Ts(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function eU(n,e){if(!$2(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function tU(n,e){if(n=be(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return _R(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Ae.fromDate(n);return{timestampValue:Zo(e.serializer,t)}}else if(n instanceof Ae){let t=new Ae(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:Zo(e.serializer,t)}}else{if(n instanceof ps)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof tr)return{bytesValue:MR(e.serializer,n._byteString)};if(n instanceof ye){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:VS(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${bc(n)}`)}}function X2(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Ae)&&!(n instanceof ps)&&!(n instanceof tr)&&!(n instanceof ye)&&!(n instanceof vr)}function mT(n,e,t){if(!X2(t)||!y8(t)){let r=bc(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function SS(n,e,t){if(e=be(e),e instanceof In)return e._internalPath;if(typeof e=="string")return yT(n,e);throw hf("Field path arguments must be of type string or ",n,!1,void 0,t)}var nU=new RegExp("[~\\*/\\[\\]]");function yT(n,e,t){if(e.search(nU)>=0)throw hf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new In(...e.split("."))._internalPath}catch{throw hf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function hf(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new _(v.INVALID_ARGUMENT,a+n+l)}function J2(n,e){return n.some(t=>t.isEqual(e))}var gs=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ye(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new TS(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(kf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},TS=class extends gs{data(){return super.data()}};function kf(n,e){return typeof e=="string"?yT(n,e):e instanceof In?e._internalPath:e._delegate._internalPath}function Z2(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new _(v.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var pc=class{},ms=class extends pc{};function Er(n,e,...t){let r=[];e instanceof pc&&r.push(e),r=r.concat(t),uU(r);for(let i of r)n=i._apply(n);return n}var df=class n extends ms{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return cD(e._query,t),new ot(e.firestore,e.converter,qS(e._query,t))}_parse(e){let t=Ss(e.firestore);return rU(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function eD(n,e,t){let r=e,i=kf("where",n);return df._create(i,r,t)}var wS=class n extends pc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ue.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(lU(e._query,t),new ot(e.firestore,e.converter,qS(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var ES=class n extends ms{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=iU(e._query,this._field,this._direction);return new ot(e.firestore,e.converter,DB(e._query,t))}};function tD(n,e="asc"){let t=e,r=kf("orderBy",n);return ES._create(r,t)}var ff=class n extends ms{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new ot(e.firestore,e.converter,Md(e._query,this._limit,this._limitType))}};function nD(n){return b2("limit",n),ff._create("limit",n,"F")}function rD(n){return b2("limitToLast",n),ff._create("limitToLast",n,"L")}var pf=class n extends ms{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=lD(e,this.type,this._docOrFields,this._inclusive);return new ot(e.firestore,e.converter,kB(e._query,t))}};function iD(...n){return pf._create("startAt",n,!0)}function sD(...n){return pf._create("startAfter",n,!1)}var gf=class n extends ms{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=lD(e,this.type,this._docOrFields,this._inclusive);return new ot(e.firestore,e.converter,NB(e._query,t))}};function oD(...n){return gf._create("endBefore",n,!1)}function aD(...n){return gf._create("endAt",n,!0)}function lD(n,e,t,r){if(t[0]=be(t[0]),t[0]instanceof gs)return sU(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Ss(n.firestore);return oU(n._query,n.firestore._databaseId,i,e,t,r)}}function rU(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new _(v.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){DA(o,s);let c=[];for(let u of o)c.push(RA(r,n,u));a={arrayValue:{values:c}}}else a=RA(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&DA(o,s),a=Q2(t,e,o,s==="in"||s==="not-in");return Z.create(i,s,a)}function iU(n,e,t){if(n.startAt!==null)throw new _(v.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new _(v.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new as(e,t)}function sU(n,e,t,r,i){if(!r)throw new _(v.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of Yo(n))if(o.field.isKeyField())s.push(os(e,r.key));else{let a=r.data.field(o.field);if(wf(a))throw new _(v.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new _(v.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new Zn(s,i)}function oU(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new _(v.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new _(v.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!BS(n)&&c.indexOf("/")!==-1)throw new _(v.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let h=n.path.child(ne.fromString(c));if(!x.isDocumentKey(h))throw new _(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${h}' is not because it contains an odd number of segments.`);let d=new x(h);a.push(os(e,d))}else{let h=Q2(t,r,c);a.push(h)}}return new Zn(a,s)}function RA(n,e,t){if(t=be(t),typeof t=="string"){if(t==="")throw new _(v.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!BS(e)&&t.indexOf("/")!==-1)throw new _(v.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ne.fromString(t));if(!x.isDocumentKey(r))throw new _(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return os(n,new x(r))}else{if(t instanceof ye)return os(n,t._key);throw new _(v.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${bc(t)}.`)}}function DA(n,e){if(!Array.isArray(n)||n.length===0)throw new _(v.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function aU(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function cD(n,e){let t=cU(n.filters,aU(e.op));if(t!==null)throw t===e.op?new _(v.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new _(v.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function lU(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)cD(t,i),t=qS(t,i)}function cU(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function uU(n){let e=n.filter(r=>r instanceof wS).length,t=n.filter(r=>r instanceof df).length;if(e>1||e>0&&t>0)throw new _(v.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var la=class{convertValue(e,t="none"){switch(ss(e)){case 0:return null;case 1:return e.booleanValue;case 2:return xe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(fi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw F()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return vs(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new ps(xe(e.latitude),xe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=PS(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp($l(e));default:return null}}convertTimestamp(e){let t=di(e);return new Ae(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ne.fromString(e);U(KR(r));let i=new pi(r.get(1),r.get(3)),s=new x(r.popFirst(5));return i.isEqual(t)||Ie(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Nf(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var _S=class extends la{constructor(e){super(),this.firestore=e}convertBytes(e){return new tr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ye(this.firestore,null,t)}};function CS(n){return hU(n,["next","error","complete"])}function hU(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Sr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},ln=class extends gs{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new wi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(kf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},wi=class extends ln{data(e={}){return super.data(e)}},An=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Sr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new wi(this._firestore,this._userDataWriter,r.key,r,new Sr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new _(v.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=dU(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function dU(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new wi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Sr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new wi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Sr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:fU(r.type),doc:i,oldIndex:s,newIndex:o}})}}function fU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F()}}function vT(n,e){return n instanceof ln&&e instanceof ln?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof An&&e instanceof An?n._firestore===e._firestore&&fT(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function uD(n){n=re(n,ye);let e=re(n.firestore,Ce),t=We(e);return D2(t,n._key).then(r=>ET(e,n,r))}var Tr=class extends la{constructor(e){super(),this.firestore=e}convertBytes(e){return new tr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ye(this.firestore,null,t)}};function hD(n){n=re(n,ye);let e=re(n.firestore,Ce),t=We(e),r=new Tr(e);return k8(t,n._key).then(i=>new ln(e,r,n._key,i,new Sr(i!==null&&i.hasLocalMutations,!0),n.converter))}function dD(n){n=re(n,ye);let e=re(n.firestore,Ce),t=We(e);return D2(t,n._key,{source:"server"}).then(r=>ET(e,n,r))}function fD(n){n=re(n,ot);let e=re(n.firestore,Ce),t=We(e),r=new Tr(e);return Z2(n._query),k2(t,n._query).then(i=>new An(e,r,n,i))}function pD(n){n=re(n,ot);let e=re(n.firestore,Ce),t=We(e),r=new Tr(e);return N8(t,n._query).then(i=>new An(e,r,n,i))}function gD(n){n=re(n,ot);let e=re(n.firestore,Ce),t=We(e),r=new Tr(e);return k2(t,n._query,{source:"server"}).then(i=>new An(e,r,n,i))}function ST(n,e,t){n=re(n,ye);let r=re(n.firestore,Ce),i=Nf(n.converter,e,t),s=Ss(r),a=Df(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Oe.none());return Sa(r,[a])}function TT(n,e,t,...r){n=re(n,ye);let i=re(n.firestore,Ce),s=Ss(i);e=be(e);let o;typeof e=="string"||e instanceof In?o=gT(s,"updateDoc",n._key,e,t,r):o=pT(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Oe.exists(!0));return Sa(i,[a])}function mD(n){let e=re(n.firestore,Ce),t=[new Si(n._key,Oe.none())];return Sa(e,t)}function yD(n,e){let t=re(n.firestore,Ce),r=Ic(n),i=Nf(n.converter,e),s=Ss(n.firestore),a=Df(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Oe.exists(!1));return Sa(t,[a]).then(()=>r)}function wT(n,...e){var t,r,i;n=be(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!CS(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(CS(e[o])){let d=e[o];e[o]=(t=d.next)===null||t===void 0?void 0:t.bind(d),e[o+1]=(r=d.error)===null||r===void 0?void 0:r.bind(d),e[o+2]=(i=d.complete)===null||i===void 0?void 0:i.bind(d)}let l,c,u;if(n instanceof ye)c=re(n.firestore,Ce),u=fa(n._key.path),l={next:d=>{e[o]&&e[o](ET(c,n,d))},error:e[o+1],complete:e[o+2]};else{let d=re(n,ot);c=re(d.firestore,Ce),u=d._query;let p=new Tr(c);l={next:y=>{e[o]&&e[o](new An(c,p,d,y))},error:e[o+1],complete:e[o+2]},Z2(n._query)}let h=We(c);return D8(h,u,a,l)}function vD(n,e){n=re(n,Ce);let t=We(n),r=CS(e)?e:{next:e};return x8(t,r)}function Sa(n,e){let t=We(n);return O8(t,e)}function ET(n,e,t){let r=t.docs.get(e._key),i=new Tr(n);return new ln(n,i,e._key,r,new Sr(t.hasPendingWrites,t.fromCache),e.converter)}var pU={maxAttempts:5};function gU(n){if(n.maxAttempts<1)throw new _(v.INVALID_ARGUMENT,"Max attempts must be at least 1")}var mf=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ss(e)}set(e,t,r){this._verifyNotCommitted();let i=ci(e,this._firestore),s=Nf(i.converter,t,r),o=Df(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Oe.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=ci(e,this._firestore);t=be(t);let o;return typeof t=="string"||t instanceof In?o=gT(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=pT(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Oe.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=ci(e,this._firestore);return this._mutations=this._mutations.concat(new Si(t._key,Oe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new _(v.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function ci(n,e){if(n=be(n),n.firestore!==e)throw new _(v.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var bS=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ss(e)}get(e){let t=ci(e,this._firestore),r=new _S(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return F();let s=i[0];if(s.isFoundDocument())return new gs(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new gs(this._firestore,r,t._key,null,t.converter);throw F()})}set(e,t,r){let i=ci(e,this._firestore),s=Nf(i.converter,t,r),o=Df(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=ci(e,this._firestore);t=be(t);let o;return typeof t=="string"||t instanceof In?o=gT(this._dataReader,"Transaction.update",s._key,t,r,i):o=pT(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=ci(e,this._firestore);return this._transaction.delete(t._key),this}};var IS=class extends bS{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=ci(e,this._firestore),r=new Tr(this._firestore);return super.get(e).then(i=>new ln(this._firestore,r,t._key,i._document,new Sr(!1,!1),t.converter))}};function SD(n,e,t){n=re(n,Ce);let r=Object.assign(Object.assign({},pU),t);gU(r);let i=We(n);return M8(i,s=>e(new IS(n,s)),r)}function TD(){return new fc("deleteField")}function wD(){return new gS("serverTimestamp")}function ED(...n){return new mS("arrayUnion",n)}function _D(...n){return new yS("arrayRemove",n)}function CD(n){return new vS("increment",n)}X8("node");var mU="@firebase/firestore-compat",yU="0.3.28";function RT(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new _("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function bD(){if(typeof Uint8Array>"u")throw new _("unimplemented","Uint8Arrays are not available in this environment.")}function ID(){if(!XA())throw new _("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Of=class n{constructor(e){this._delegate=e}static fromBase64String(e){return ID(),new n(tr.fromBase64String(e))}static fromUint8Array(e){return bD(),new n(tr.fromUint8Array(e))}toBase64(){return ID(),this._delegate.toBase64()}toUint8Array(){return bD(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function _T(n){return vU(n,["next","error","complete"])}function vU(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var CT=class{enableIndexedDbPersistence(e,t){return F2(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return B2(e._delegate)}clearIndexedDbPersistence(e){return U2(e._delegate)}},xf=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof pi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&on("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){x2(this._delegate,e,t,r)}enableNetwork(){return z2(this._delegate)}disableNetwork(){return j2(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,aT("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return V2(this._delegate)}onSnapshotsInSync(e){return vD(this._delegate,e)}get app(){if(!this._appCompat)throw new _("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ea(this,hT(this._delegate,e))}catch(t){throw kt(t,"collection()","Firestore.collection()")}}doc(e){try{return new nr(this,Ic(this._delegate,e))}catch(t){throw kt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Cs(this,M2(this._delegate,e))}catch(t){throw kt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return SD(this._delegate,t=>e(new Mf(this,t)))}batch(){return We(this._delegate),new Pf(new mf(this._delegate,e=>Sa(this._delegate,e)))}loadBundle(e){return G2(this._delegate,e)}namedQuery(e){return K2(this._delegate,e).then(t=>t?new Cs(this,t):null)}},Ta=class extends la{constructor(e){super(),this.firestore=e}convertBytes(e){return new Of(new tr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return nr.forKey(t,this.firestore,null)}};function SU(n){NA(n)}var Mf=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ta(e)}get(e){let t=ws(e);return this._delegate.get(t).then(r=>new Es(this._firestore,new ln(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=ws(e);return r?(RT("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=ws(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=ws(e);return this._delegate.delete(t),this}},Pf=class{constructor(e){this._delegate=e}set(e,t,r){let i=ws(e);return r?(RT("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=ws(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=ws(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},wa=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new wi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new _s(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Ta(e),t),i.set(t,s)),s}};wa.INSTANCES=new WeakMap;var nr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ta(e)}static forPath(e,t,r){if(e.length%2!==0)throw new _("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new ye(t._delegate,r,new x(e)))}static forKey(e,t,r){return new n(t,new ye(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Ea(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ea(this.firestore,hT(this._delegate,e))}catch(t){throw kt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=be(e),e instanceof ye?dT(this._delegate,e):!1}set(e,t){t=RT("DocumentReference.set",t);try{return t?ST(this._delegate,e,t):ST(this._delegate,e)}catch(r){throw kt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?TT(this._delegate,e):TT(this._delegate,e,t,...r)}catch(i){throw kt(i,"updateDoc()","DocumentReference.update()")}}delete(){return mD(this._delegate)}onSnapshot(...e){let t=AD(e),r=RD(e,i=>new Es(this.firestore,new ln(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return wT(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=hD(this._delegate):e?.source==="server"?t=dD(this._delegate):t=uD(this._delegate),t.then(r=>new Es(this.firestore,new ln(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(wa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function kt(n,e,t){return n.message=n.message.replace(e,t),n}function AD(n){for(let e of n)if(typeof e=="object"&&!_T(e))return e;return{}}function RD(n,e){var t,r;let i;return _T(n[0])?i=n[0]:_T(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Es=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new nr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return vT(this._delegate,e._delegate)}},_s=class extends Es{data(e){let t=this._delegate.data(e);return this._delegate._converter||OA(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Cs=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ta(e)}where(e,t,r){try{return new n(this.firestore,Er(this._delegate,eD(e,t,r)))}catch(i){throw kt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Er(this._delegate,tD(e,t)))}catch(r){throw kt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Er(this._delegate,nD(e)))}catch(t){throw kt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Er(this._delegate,rD(e)))}catch(t){throw kt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Er(this._delegate,iD(...e)))}catch(t){throw kt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Er(this._delegate,sD(...e)))}catch(t){throw kt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Er(this._delegate,oD(...e)))}catch(t){throw kt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Er(this._delegate,aD(...e)))}catch(t){throw kt(t,"endAt()","Query.endAt()")}}isEqual(e){return fT(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=pD(this._delegate):e?.source==="server"?t=gD(this._delegate):t=fD(this._delegate),t.then(r=>new Ac(this.firestore,new An(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=AD(e),r=RD(e,i=>new Ac(this.firestore,new An(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return wT(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(wa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},bT=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new _s(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Ac=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Cs(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new _s(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new bT(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new _s(this._firestore,r))})}isEqual(e){return vT(this._delegate,e._delegate)}},Ea=class n extends Cs{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new nr(this.firestore,e):null}doc(e){try{return e===void 0?new nr(this.firestore,Ic(this._delegate)):new nr(this.firestore,Ic(this._delegate,e))}catch(t){throw kt(t,"doc()","CollectionReference.doc()")}}add(e){return yD(this._delegate,e).then(t=>new nr(this.firestore,t))}isEqual(e){return dT(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(wa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ws(n){return re(n,ye)}var IT=class n{constructor(...e){this._delegate=new In(...e)}static documentId(){return new n(qe.keyField().canonicalString())}isEqual(e){return e=be(e),e instanceof In?this._delegate._internalPath.isEqual(e._internalPath):!1}};var AT=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=wD();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=TD();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=ED(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=_D(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=CD(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var TU={Firestore:xf,GeoPoint:ps,Timestamp:Ae,Blob:Of,Transaction:Mf,WriteBatch:Pf,DocumentReference:nr,DocumentSnapshot:Es,Query:Cs,QueryDocumentSnapshot:_s,QuerySnapshot:Ac,CollectionReference:Ea,FieldPath:IT,FieldValue:AT,setLogLevel:SU,CACHE_SIZE_UNLIMITED:P2};function wU(n,e){n.INTERNAL.registerComponent(new Di("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},TU)))}function EU(n){wU(n,(e,t)=>new xf(e,t,new CT)),n.registerVersion(mU,yU,"node")}EU(Nt);function _U(n,e=kc){return new Is(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function DD(n,e){return _U(n,e)}function CU(n,e){return DD(n,e).pipe(xc(void 0),Nc(),Tt(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function NT(n,e){return DD(n,e).pipe(Tt(t=>({payload:t,type:"query"})))}var Lf=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=MD(r,t);return new Bf(i,s,this.afs)}snapshotChanges(){return CU(this.ref,this.afs.schedulers.outsideAngular).pipe(Ot)}valueChanges(e={}){return this.snapshotChanges().pipe(Tt(({payload:t})=>e.idField?Vf(Dc({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Cr(this.ref.get(e)).pipe(Ot)}};function Ff(n,e){return NT(n,e).pipe(xc(void 0),Nc(),Tt(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(h=>h.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function kD(n,e,t){return Ff(n,t).pipe(Oc((r,i)=>bU(r,i.map(s=>s.payload),e),[]),FT(),Tt(r=>r.map(i=>({type:i.type,payload:i}))))}function bU(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=IU(n,r))}),n}function DT(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function IU(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return DT(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return DT(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return DT(n,e.oldIndex,1);break}return n}function ND(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Bf=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Ff(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Tt(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(xc(void 0),Nc(),_a(([r,i])=>i.length>0||!r),Tt(([,r])=>r),Ot)}auditTrail(e){return this.stateChanges(e).pipe(Oc((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=ND(e);return kD(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ot)}valueChanges(e={}){return NT(this.query,this.afs.schedulers.outsideAngular).pipe(Tt(t=>t.payload.docs.map(r=>e.idField?Vf(Dc({},r.data()),{[e.idField]:r.id}):r.data())),Ot)}get(e){return Cr(this.query.get(e)).pipe(Ot)}add(e){return this.ref.add(e)}doc(e){return new Lf(this.ref.doc(e),this.afs)}},kT=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Ff(this.query,this.afs.schedulers.outsideAngular).pipe(Ot):Ff(this.query,this.afs.schedulers.outsideAngular).pipe(Tt(t=>t.filter(r=>e.indexOf(r.type)>-1)),_a(t=>t.length>0),Ot)}auditTrail(e){return this.stateChanges(e).pipe(Oc((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=ND(e);return kD(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ot)}valueChanges(e={}){return NT(this.query,this.afs.schedulers.outsideAngular).pipe(Tt(r=>r.payload.docs.map(i=>e.idField?Dc({[e.idField]:i.id},i.data()):i.data())),Ot)}get(e){return Cr(this.query.get(e)).pipe(Ot)}},OD=new wt("angularfire2.enableFirestorePersistence"),xD=new wt("angularfire2.firestore.persistenceSettings"),AU=new wt("angularfire2.firestore.settings"),RU=new wt("angularfire2.firestore.use-emulator");function MD(n,e=t=>t){return{query:e(n),ref:n}}var OT=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,h,d,p,y,S,T,D,E){this.schedulers=l;let k=Ra(t,a,r),N=u;h&&hp(k,a,d,y,S,T,p,D),[this.firestore,this.persistenceEnabled$]=jc(`${k.name}.firestore`,"AngularFirestore",k.name,()=>{let q=a.runOutsideAngular(()=>k.firestore());if(s&&q.settings(s),N&&q.useEmulator(...N),i&&!Lc(o)){let K=()=>{try{return Cr(q.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(X){return typeof console<"u"&&console.warn(X),br(!1)}};return[q,a.runOutsideAngular(K)]}else return[q,br(!1)]},[s,N,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=MD(i,r),a=this.schedulers.ngZone.run(()=>s);return new Bf(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new kT(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Lf(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(ee(Ms),ee(Ps,8),ee(OD,8),ee(AU,8),ee(ks),ee(Ir),ee(Uc),ee(xD,8),ee(RU,8),ee(Rw,8),ee(sp,8),ee(op,8),ee(ap,8),ee(lp,8),ee(cp,8),ee(up,8),ee(Ni,8))};static \u0275prov=Rs({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),PD=(()=>{class n{constructor(){Nt.registerVersion("angularfire",xs.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:OD,useValue:!0},{provide:xD,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=un({type:n});static \u0275inj=cn({providers:[OT]})}return n})();var kU=(n,e)=>e.title,NU=()=>({title:"Explore the Docs",link:"https://angular.dev"}),OU=()=>({title:"Learn with Tutorials",link:"https://angular.dev/tutorials"}),xU=()=>({title:"CLI Docs",link:"https://angular.dev/tools/cli"}),MU=()=>({title:"Angular Language Service",link:"https://angular.dev/tools/language-service"}),PU=()=>({title:"Angular DevTools",link:"https://angular.dev/tools/devtools"}),LU=(n,e,t,r,i)=>[n,e,t,r,i];function FU(n,e){if(n&1&&($e(0,"li",33),Kt(1,"img",34),Et()),n&2){let t=e.$implicit;Ns(),Mc("src",t.url,Kf)}}function BU(n,e){if(n&1&&($e(0,"a",22)(1,"span"),Pc(2),Et(),Ds(),$e(3,"svg",35),Kt(4,"path",36),Et()()),n&2){let t=e.$implicit;Mc("href",t.link,Kf),Ns(2),HT(t.title)}}var qf=(()=>{let e=class e{constructor(r){this.firestore=r,this.title="NASAFAN",this.items$=this.firestore.collection("nasa_pics").valueChanges()}};e.\u0275fac=function(i){return new(i||e)(zT(OT))},e.\u0275cmp=VT({type:e,selectors:[["app-root"]],decls:42,vars:15,consts:[[1,"main"],[1,"content"],[1,"left-side"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 982 239","fill","none",1,"angular-logo"],["clip-path","url(#a)"],["fill","url(#b)","d","M388.676 191.625h30.849L363.31 31.828h-35.758l-56.215 159.797h30.848l13.174-39.356h60.061l13.256 39.356Zm-65.461-62.675 21.602-64.311h1.227l21.602 64.311h-44.431Zm126.831-7.527v70.202h-28.23V71.839h27.002v20.374h1.392c2.782-6.71 7.2-12.028 13.255-15.956 6.056-3.927 13.584-5.89 22.503-5.89 8.264 0 15.465 1.8 21.684 5.318 6.137 3.518 10.964 8.673 14.319 15.382 3.437 6.71 5.074 14.81 4.992 24.383v76.175h-28.23v-71.92c0-8.019-2.046-14.237-6.219-18.819-4.173-4.5-9.819-6.791-17.102-6.791-4.91 0-9.328 1.063-13.174 3.272-3.846 2.128-6.792 5.237-9.001 9.328-2.046 4.009-3.191 8.918-3.191 14.728ZM589.233 239c-10.147 0-18.82-1.391-26.103-4.091-7.282-2.7-13.092-6.382-17.511-10.964-4.418-4.582-7.528-9.655-9.164-15.219l25.448-6.136c1.145 2.372 2.782 4.663 4.991 6.954 2.209 2.291 5.155 4.255 8.837 5.81 3.683 1.554 8.428 2.291 14.074 2.291 8.019 0 14.647-1.964 19.884-5.81 5.237-3.845 7.856-10.227 7.856-19.064v-22.665h-1.391c-1.473 2.946-3.601 5.892-6.383 9.001-2.782 3.109-6.464 5.645-10.965 7.691-4.582 2.046-10.228 3.109-17.101 3.109-9.165 0-17.511-2.209-25.039-6.545-7.446-4.337-13.42-10.883-17.757-19.474-4.418-8.673-6.628-19.473-6.628-32.565 0-13.091 2.21-24.301 6.628-33.383 4.419-9.082 10.311-15.955 17.839-20.7 7.528-4.746 15.874-7.037 25.039-7.037 7.037 0 12.846 1.145 17.347 3.518 4.582 2.373 8.182 5.236 10.883 8.51 2.7 3.272 4.746 6.382 6.137 9.327h1.554v-19.8h27.821v121.749c0 10.228-2.454 18.737-7.364 25.447-4.91 6.709-11.538 11.7-20.048 15.055-8.509 3.355-18.165 4.991-28.884 4.991Zm.245-71.266c5.974 0 11.047-1.473 15.302-4.337 4.173-2.945 7.446-7.118 9.573-12.519 2.21-5.482 3.274-12.027 3.274-19.637 0-7.609-1.064-14.155-3.274-19.8-2.127-5.646-5.318-10.064-9.491-13.255-4.174-3.11-9.329-4.746-15.384-4.746s-11.537 1.636-15.792 4.91c-4.173 3.272-7.365 7.772-9.492 13.418-2.128 5.727-3.191 12.191-3.191 19.392 0 7.2 1.063 13.745 3.273 19.228 2.127 5.482 5.318 9.736 9.573 12.764 4.174 3.027 9.41 4.582 15.629 4.582Zm141.56-26.51V71.839h28.23v119.786h-27.412v-21.273h-1.227c-2.7 6.709-7.119 12.191-13.338 16.446-6.137 4.255-13.747 6.382-22.748 6.382-7.855 0-14.81-1.718-20.783-5.237-5.974-3.518-10.72-8.591-14.075-15.382-3.355-6.709-5.073-14.891-5.073-24.464V71.839h28.312v71.921c0 7.609 2.046 13.664 6.219 18.083 4.173 4.5 9.655 6.709 16.365 6.709 4.173 0 8.183-.982 12.111-3.028 3.927-2.045 7.118-5.072 9.655-9.082 2.537-4.091 3.764-9.164 3.764-15.218Zm65.707-109.395v159.796h-28.23V31.828h28.23Zm44.841 162.169c-7.61 0-14.402-1.391-20.457-4.091-6.055-2.7-10.883-6.791-14.32-12.109-3.518-5.319-5.237-11.946-5.237-19.801 0-6.791 1.228-12.355 3.765-16.773 2.536-4.419 5.891-7.937 10.228-10.637 4.337-2.618 9.164-4.664 14.647-6.055 5.4-1.391 11.046-2.373 16.856-3.027 7.037-.737 12.683-1.391 17.102-1.964 4.337-.573 7.528-1.555 9.574-2.782 1.963-1.309 3.027-3.273 3.027-5.973v-.491c0-5.891-1.718-10.391-5.237-13.664-3.518-3.191-8.51-4.828-15.056-4.828-6.955 0-12.356 1.473-16.447 4.5-4.009 3.028-6.71 6.546-8.183 10.719l-26.348-3.764c2.046-7.282 5.483-13.336 10.31-18.328 4.746-4.909 10.638-8.59 17.511-11.045 6.955-2.455 14.565-3.682 22.912-3.682 5.809 0 11.537.654 17.265 2.045s10.965 3.6 15.711 6.71c4.746 3.109 8.51 7.282 11.455 12.6 2.864 5.318 4.337 11.946 4.337 19.883v80.184h-27.166v-16.446h-.9c-1.719 3.355-4.092 6.464-7.201 9.328-3.109 2.864-6.955 5.237-11.619 6.955-4.828 1.718-10.229 2.536-16.529 2.536Zm7.364-20.701c5.646 0 10.556-1.145 14.729-3.354 4.173-2.291 7.364-5.237 9.655-9.001 2.292-3.763 3.355-7.854 3.355-12.273v-14.155c-.9.737-2.373 1.391-4.5 2.046-2.128.654-4.419 1.145-7.037 1.636-2.619.491-5.155.9-7.692 1.227-2.537.328-4.746.655-6.628.901-4.173.572-8.019 1.472-11.292 2.781-3.355 1.31-5.973 3.11-7.855 5.401-1.964 2.291-2.864 5.318-2.864 8.918 0 5.237 1.882 9.164 5.728 11.782 3.682 2.782 8.51 4.091 14.401 4.091Zm64.643 18.328V71.839h27.412v19.965h1.227c2.21-6.955 5.974-12.274 11.292-16.038 5.319-3.763 11.456-5.645 18.329-5.645 1.555 0 3.355.082 5.237.163 1.964.164 3.601.328 4.91.573v25.938c-1.227-.41-3.109-.819-5.646-1.146a58.814 58.814 0 0 0-7.446-.49c-5.155 0-9.738 1.145-13.829 3.354-4.091 2.209-7.282 5.236-9.655 9.164-2.373 3.927-3.519 8.427-3.519 13.5v70.448h-28.312ZM222.077 39.192l-8.019 125.923L137.387 0l84.69 39.192Zm-53.105 162.825-57.933 33.056-57.934-33.056 11.783-28.556h92.301l11.783 28.556ZM111.039 62.675l30.357 73.803H80.681l30.358-73.803ZM7.937 165.115 0 39.192 84.69 0 7.937 165.115Z"],["fill","url(#c)","d","M388.676 191.625h30.849L363.31 31.828h-35.758l-56.215 159.797h30.848l13.174-39.356h60.061l13.256 39.356Zm-65.461-62.675 21.602-64.311h1.227l21.602 64.311h-44.431Zm126.831-7.527v70.202h-28.23V71.839h27.002v20.374h1.392c2.782-6.71 7.2-12.028 13.255-15.956 6.056-3.927 13.584-5.89 22.503-5.89 8.264 0 15.465 1.8 21.684 5.318 6.137 3.518 10.964 8.673 14.319 15.382 3.437 6.71 5.074 14.81 4.992 24.383v76.175h-28.23v-71.92c0-8.019-2.046-14.237-6.219-18.819-4.173-4.5-9.819-6.791-17.102-6.791-4.91 0-9.328 1.063-13.174 3.272-3.846 2.128-6.792 5.237-9.001 9.328-2.046 4.009-3.191 8.918-3.191 14.728ZM589.233 239c-10.147 0-18.82-1.391-26.103-4.091-7.282-2.7-13.092-6.382-17.511-10.964-4.418-4.582-7.528-9.655-9.164-15.219l25.448-6.136c1.145 2.372 2.782 4.663 4.991 6.954 2.209 2.291 5.155 4.255 8.837 5.81 3.683 1.554 8.428 2.291 14.074 2.291 8.019 0 14.647-1.964 19.884-5.81 5.237-3.845 7.856-10.227 7.856-19.064v-22.665h-1.391c-1.473 2.946-3.601 5.892-6.383 9.001-2.782 3.109-6.464 5.645-10.965 7.691-4.582 2.046-10.228 3.109-17.101 3.109-9.165 0-17.511-2.209-25.039-6.545-7.446-4.337-13.42-10.883-17.757-19.474-4.418-8.673-6.628-19.473-6.628-32.565 0-13.091 2.21-24.301 6.628-33.383 4.419-9.082 10.311-15.955 17.839-20.7 7.528-4.746 15.874-7.037 25.039-7.037 7.037 0 12.846 1.145 17.347 3.518 4.582 2.373 8.182 5.236 10.883 8.51 2.7 3.272 4.746 6.382 6.137 9.327h1.554v-19.8h27.821v121.749c0 10.228-2.454 18.737-7.364 25.447-4.91 6.709-11.538 11.7-20.048 15.055-8.509 3.355-18.165 4.991-28.884 4.991Zm.245-71.266c5.974 0 11.047-1.473 15.302-4.337 4.173-2.945 7.446-7.118 9.573-12.519 2.21-5.482 3.274-12.027 3.274-19.637 0-7.609-1.064-14.155-3.274-19.8-2.127-5.646-5.318-10.064-9.491-13.255-4.174-3.11-9.329-4.746-15.384-4.746s-11.537 1.636-15.792 4.91c-4.173 3.272-7.365 7.772-9.492 13.418-2.128 5.727-3.191 12.191-3.191 19.392 0 7.2 1.063 13.745 3.273 19.228 2.127 5.482 5.318 9.736 9.573 12.764 4.174 3.027 9.41 4.582 15.629 4.582Zm141.56-26.51V71.839h28.23v119.786h-27.412v-21.273h-1.227c-2.7 6.709-7.119 12.191-13.338 16.446-6.137 4.255-13.747 6.382-22.748 6.382-7.855 0-14.81-1.718-20.783-5.237-5.974-3.518-10.72-8.591-14.075-15.382-3.355-6.709-5.073-14.891-5.073-24.464V71.839h28.312v71.921c0 7.609 2.046 13.664 6.219 18.083 4.173 4.5 9.655 6.709 16.365 6.709 4.173 0 8.183-.982 12.111-3.028 3.927-2.045 7.118-5.072 9.655-9.082 2.537-4.091 3.764-9.164 3.764-15.218Zm65.707-109.395v159.796h-28.23V31.828h28.23Zm44.841 162.169c-7.61 0-14.402-1.391-20.457-4.091-6.055-2.7-10.883-6.791-14.32-12.109-3.518-5.319-5.237-11.946-5.237-19.801 0-6.791 1.228-12.355 3.765-16.773 2.536-4.419 5.891-7.937 10.228-10.637 4.337-2.618 9.164-4.664 14.647-6.055 5.4-1.391 11.046-2.373 16.856-3.027 7.037-.737 12.683-1.391 17.102-1.964 4.337-.573 7.528-1.555 9.574-2.782 1.963-1.309 3.027-3.273 3.027-5.973v-.491c0-5.891-1.718-10.391-5.237-13.664-3.518-3.191-8.51-4.828-15.056-4.828-6.955 0-12.356 1.473-16.447 4.5-4.009 3.028-6.71 6.546-8.183 10.719l-26.348-3.764c2.046-7.282 5.483-13.336 10.31-18.328 4.746-4.909 10.638-8.59 17.511-11.045 6.955-2.455 14.565-3.682 22.912-3.682 5.809 0 11.537.654 17.265 2.045s10.965 3.6 15.711 6.71c4.746 3.109 8.51 7.282 11.455 12.6 2.864 5.318 4.337 11.946 4.337 19.883v80.184h-27.166v-16.446h-.9c-1.719 3.355-4.092 6.464-7.201 9.328-3.109 2.864-6.955 5.237-11.619 6.955-4.828 1.718-10.229 2.536-16.529 2.536Zm7.364-20.701c5.646 0 10.556-1.145 14.729-3.354 4.173-2.291 7.364-5.237 9.655-9.001 2.292-3.763 3.355-7.854 3.355-12.273v-14.155c-.9.737-2.373 1.391-4.5 2.046-2.128.654-4.419 1.145-7.037 1.636-2.619.491-5.155.9-7.692 1.227-2.537.328-4.746.655-6.628.901-4.173.572-8.019 1.472-11.292 2.781-3.355 1.31-5.973 3.11-7.855 5.401-1.964 2.291-2.864 5.318-2.864 8.918 0 5.237 1.882 9.164 5.728 11.782 3.682 2.782 8.51 4.091 14.401 4.091Zm64.643 18.328V71.839h27.412v19.965h1.227c2.21-6.955 5.974-12.274 11.292-16.038 5.319-3.763 11.456-5.645 18.329-5.645 1.555 0 3.355.082 5.237.163 1.964.164 3.601.328 4.91.573v25.938c-1.227-.41-3.109-.819-5.646-1.146a58.814 58.814 0 0 0-7.446-.49c-5.155 0-9.738 1.145-13.829 3.354-4.091 2.209-7.282 5.236-9.655 9.164-2.373 3.927-3.519 8.427-3.519 13.5v70.448h-28.312ZM222.077 39.192l-8.019 125.923L137.387 0l84.69 39.192Zm-53.105 162.825-57.933 33.056-57.934-33.056 11.783-28.556h92.301l11.783 28.556ZM111.039 62.675l30.357 73.803H80.681l30.358-73.803ZM7.937 165.115 0 39.192 84.69 0 7.937 165.115Z"],["id","c","cx","0","cy","0","r","1","gradientTransform","rotate(118.122 171.182 60.81) scale(205.794)","gradientUnits","userSpaceOnUse"],["stop-color","#FF41F8"],["offset",".707","stop-color","#FF41F8","stop-opacity",".5"],["offset","1","stop-color","#FF41F8","stop-opacity","0"],["id","b","x1","0","x2","982","y1","192","y2","192","gradientUnits","userSpaceOnUse"],["stop-color","#F0060B"],["offset","0","stop-color","#F0070C"],["offset",".526","stop-color","#CC26D5"],["offset","1","stop-color","#7702FF"],["id","a"],["fill","#fff","d","M0 0h982v239H0z"],["class","text",4,"ngFor","ngForOf"],["role","separator","aria-label","Divider",1,"divider"],[1,"right-side"],[1,"pill-group"],["target","_blank","rel","noopener",1,"pill",3,"href"],[1,"social-links"],["href","https://github.com/angular/angular","aria-label","Github","target","_blank","rel","noopener"],["width","25","height","24","viewBox","0 0 25 24","fill","none","xmlns","http://www.w3.org/2000/svg","alt","Github"],["d","M12.3047 0C5.50634 0 0 5.50942 0 12.3047C0 17.7423 3.52529 22.3535 8.41332 23.9787C9.02856 24.0946 9.25414 23.7142 9.25414 23.3871C9.25414 23.0949 9.24389 22.3207 9.23876 21.2953C5.81601 22.0377 5.09414 19.6444 5.09414 19.6444C4.53427 18.2243 3.72524 17.8449 3.72524 17.8449C2.61064 17.082 3.81137 17.0973 3.81137 17.0973C5.04697 17.1835 5.69604 18.3647 5.69604 18.3647C6.79321 20.2463 8.57636 19.7029 9.27978 19.3881C9.39052 18.5924 9.70736 18.0499 10.0591 17.7423C7.32641 17.4347 4.45429 16.3765 4.45429 11.6618C4.45429 10.3185 4.9311 9.22133 5.72065 8.36C5.58222 8.04931 5.16694 6.79833 5.82831 5.10337C5.82831 5.10337 6.85883 4.77319 9.2121 6.36459C10.1965 6.09082 11.2424 5.95546 12.2883 5.94931C13.3342 5.95546 14.3801 6.09082 15.3644 6.36459C17.7023 4.77319 18.7328 5.10337 18.7328 5.10337C19.3942 6.79833 18.9789 8.04931 18.8559 8.36C19.6403 9.22133 20.1171 10.3185 20.1171 11.6618C20.1171 16.3888 17.2409 17.4296 14.5031 17.7321C14.9338 18.1012 15.3337 18.8559 15.3337 20.0084C15.3337 21.6552 15.3183 22.978 15.3183 23.3779C15.3183 23.7009 15.5336 24.0854 16.1642 23.9623C21.0871 22.3484 24.6094 17.7341 24.6094 12.3047C24.6094 5.50942 19.0999 0 12.3047 0Z"],["href","https://twitter.com/angular","aria-label","Twitter","target","_blank","rel","noopener"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg","alt","Twitter"],["d","M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"],["href","https://www.youtube.com/channel/UCbn1OgGei-DV7aSRo_HaAiw","aria-label","Youtube","target","_blank","rel","noopener"],["width","29","height","20","viewBox","0 0 29 20","fill","none","xmlns","http://www.w3.org/2000/svg","alt","Youtube"],["fill-rule","evenodd","clip-rule","evenodd","d","M27.4896 1.52422C27.9301 1.96749 28.2463 2.51866 28.4068 3.12258C29.0004 5.35161 29.0004 10 29.0004 10C29.0004 10 29.0004 14.6484 28.4068 16.8774C28.2463 17.4813 27.9301 18.0325 27.4896 18.4758C27.0492 18.9191 26.5 19.2389 25.8972 19.4032C23.6778 20 14.8068 20 14.8068 20C14.8068 20 5.93586 20 3.71651 19.4032C3.11363 19.2389 2.56449 18.9191 2.12405 18.4758C1.68361 18.0325 1.36732 17.4813 1.20683 16.8774C0.613281 14.6484 0.613281 10 0.613281 10C0.613281 10 0.613281 5.35161 1.20683 3.12258C1.36732 2.51866 1.68361 1.96749 2.12405 1.52422C2.56449 1.08095 3.11363 0.76113 3.71651 0.596774C5.93586 0 14.8068 0 14.8068 0C14.8068 0 23.6778 0 25.8972 0.596774C26.5 0.76113 27.0492 1.08095 27.4896 1.52422ZM19.3229 10L11.9036 5.77905V14.221L19.3229 10Z"],[1,"text"],["alt","Girl in a jacket","width","200","height","200",3,"src"],["xmlns","http://www.w3.org/2000/svg","height","14","viewBox","0 -960 960 960","width","14","fill","currentColor"],["d","M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h560v-280h80v280q0 33-23.5 56.5T760-120H200Zm188-212-56-56 372-372H560v-80h280v280h-80v-144L388-332Z"]],template:function(i,s){i&1&&($e(0,"main",0)(1,"div",1)(2,"div",2),Ds(),$e(3,"svg",3)(4,"g",4),Kt(5,"path",5)(6,"path",6),Et(),$e(7,"defs")(8,"radialGradient",7),Kt(9,"stop",8)(10,"stop",9)(11,"stop",10),Et(),$e(12,"linearGradient",11),Kt(13,"stop",12)(14,"stop",13)(15,"stop",14)(16,"stop",15),Et(),$e(17,"clipPath",16),Kt(18,"path",17),Et()()(),Ca(),$e(19,"h1"),Pc(20),Et(),$e(21,"p"),Pc(22,"Congratulations! Your app is running. \u{1F389}"),Et(),$e(23,"ul"),jT(24,FU,2,1,"li",18),QT(25,"async"),Et()(),Kt(26,"div",19),$e(27,"div",20)(28,"div",21),GT(29,BU,5,2,"a",22,kU),Et(),$e(31,"div",23)(32,"a",24),Ds(),$e(33,"svg",25),Kt(34,"path",26),Et()(),Ca(),$e(35,"a",27),Ds(),$e(36,"svg",28),Kt(37,"path",29),Et()(),Ca(),$e(38,"a",30),Ds(),$e(39,"svg",31),Kt(40,"path",32),Et()()()()()(),Ca(),Kt(41,"router-outlet")),i&2&&(Ns(20),$T("Hello, ",s.title,""),Ns(4),Mc("ngForOf",YT(25,2,s.items$)),Ns(5),KT(WT(9,LU,Os(4,NU),Os(5,OU),Os(6,xU),Os(7,MU),Os(8,PU))))},dependencies:[ZT,iw,ew],styles:[`[_nghost-%COMP%] {
    --bright-blue: oklch(51.01% 0.274 263.83);
    --electric-violet: oklch(53.18% 0.28 296.97);
    --french-violet: oklch(47.66% 0.246 305.88);
    --vivid-pink: oklch(69.02% 0.277 332.77);
    --hot-red: oklch(61.42% 0.238 15.34);
    --orange-red: oklch(63.32% 0.24 31.68);

    --gray-900: oklch(19.37% 0.006 300.98);
    --gray-700: oklch(36.98% 0.014 302.71);
    --gray-400: oklch(70.9% 0.015 304.04);

    --red-to-pink-to-purple-vertical-gradient: linear-gradient(
      180deg,
      var(--orange-red) 0%,
      var(--vivid-pink) 50%,
      var(--electric-violet) 100%
    );

    --red-to-pink-to-purple-horizontal-gradient: linear-gradient(
      90deg,
      var(--orange-red) 0%,
      var(--vivid-pink) 50%,
      var(--electric-violet) 100%
    );

    --pill-accent: var(--bright-blue);

    font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
      Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
      "Segoe UI Symbol";
    box-sizing: border-box;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1[_ngcontent-%COMP%] {
    font-size: 3.125rem;
    color: var(--gray-900);
    font-weight: 500;
    line-height: 100%;
    letter-spacing: -0.125rem;
    margin: 0;
    font-family: "Inter Tight", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
      Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
      "Segoe UI Symbol";
  }

  p[_ngcontent-%COMP%] {
    margin: 0;
    color: var(--gray-700);
  }

  main[_ngcontent-%COMP%] {
    width: 100%;
    min-height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem;
    box-sizing: inherit;
    position: relative;
  }

  .angular-logo[_ngcontent-%COMP%] {
    max-width: 9.2rem;
  }

  .content[_ngcontent-%COMP%] {
    display: flex;
    justify-content: space-around;
    width: 100%;
    max-width: 700px;
    margin-bottom: 3rem;
  }

  .content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%] {
    margin-top: 1.75rem;
  }

  .content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {
    margin-top: 1.5rem;
  }

  .divider[_ngcontent-%COMP%] {
    width: 1px;
    background: var(--red-to-pink-to-purple-vertical-gradient);
    margin-inline: 0.5rem;
  }

  .pill-group[_ngcontent-%COMP%] {
    display: flex;
    flex-direction: column;
    align-items: start;
    flex-wrap: wrap;
    gap: 1.25rem;
  }

  .pill[_ngcontent-%COMP%] {
    display: flex;
    align-items: center;
    --pill-accent: var(--bright-blue);
    background: color-mix(in srgb, var(--pill-accent) 5%, transparent);
    color: var(--pill-accent);
    padding-inline: 0.75rem;
    padding-block: 0.375rem;
    border-radius: 2.75rem;
    border: 0;
    transition: background 0.3s ease;
    font-family: var(--inter-font);
    font-size: 0.875rem;
    font-style: normal;
    font-weight: 500;
    line-height: 1.4rem;
    letter-spacing: -0.00875rem;
    text-decoration: none;
  }

  .pill[_ngcontent-%COMP%]:hover {
    background: color-mix(in srgb, var(--pill-accent) 15%, transparent);
  }

  .pill-group[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]:nth-child(6n + 1) {
    --pill-accent: var(--bright-blue);
  }
  .pill-group[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]:nth-child(6n + 2) {
    --pill-accent: var(--french-violet);
  }
  .pill-group[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]:nth-child(6n + 3), .pill-group[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]:nth-child(6n + 4), .pill-group[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]:nth-child(6n + 5) {
    --pill-accent: var(--hot-red);
  }

  .pill-group[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%] {
    margin-inline-start: 0.25rem;
  }

  .social-links[_ngcontent-%COMP%] {
    display: flex;
    align-items: center;
    gap: 0.73rem;
    margin-top: 1.5rem;
  }

  .social-links[_ngcontent-%COMP%]   path[_ngcontent-%COMP%] {
    transition: fill 0.3s ease;
    fill: var(--gray-400);
  }

  .social-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover   svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%] {
    fill: var(--gray-900);
  }

  @media screen and (max-width: 650px) {
    .content[_ngcontent-%COMP%] {
      flex-direction: column;
      width: max-content;
    }

    .divider[_ngcontent-%COMP%] {
      height: 1px;
      width: 100%;
      background: var(--red-to-pink-to-purple-horizontal-gradient);
      margin-block: 1.5rem;
    }
  }`]});let n=e;return n})();var LD={production:!1,firebase:{apiKey:"AIzaSyAzqWqyJ7Lz_kpdpOrP9O3Ud_A-e8hdDUQ",authDomain:"fudencioland.firebaseapp.com",projectId:"fudencioland",storageBucket:"fudencioland.appspot.com",messagingSenderId:"724726627630",appId:"1:724726627630:web:03084dfdff99df5f8e4ebf"}};var FD=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=un({type:e,bootstrap:[qf]}),e.\u0275inj=cn({providers:[nw()],imports:[tw,hw,PD,Aw.initializeApp(LD.firebase)]});let n=e;return n})();var qU=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=un({type:e,bootstrap:[qf]}),e.\u0275inj=cn({imports:[FD,rw]});let n=e;return n})();export{qU as a};
